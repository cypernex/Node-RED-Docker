[{"id":"2f5cab58.57de34","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"14d67294.62b07d","type":"tab","label":"Aquaponics 2","disabled":true,"info":""},{"id":"a0243dff.2c28c","type":"tab","label":"Sensors Test","disabled":false,"info":""},{"id":"8e2a5447.6d4358","type":"tab","label":"InfluxDB Test","disabled":false,"info":""},{"id":"cd531b46.586a98","type":"tab","label":"Aquaponics InfluxDB","disabled":false,"info":""},{"id":"d809a3fb.a012","type":"tab","label":"InfluxDB 2.0","disabled":false,"info":""},{"id":"57e9e411.7eb0dc","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"11d09863.30e618","type":"tab","label":"Flow 4","disabled":false,"info":""},{"id":"76dfa12d.b4415","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"16e59e64.eccb62","type":"tab","label":"Flow 6","disabled":false,"info":""},{"id":"7de8d9bd.05bea8","type":"tab","label":"Lachlan Demo","disabled":false,"info":""},{"id":"164c3b5f.4e40a5","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"ce33d040.e9c808","type":"tab","label":"Timestamp Testing","disabled":false,"info":""},{"id":"ab9cf05b.4c787","type":"mqtt-broker","z":"","name":"myBrokerConfig","broker":"${MQTT_HOST}","port":"${MQTT_PORT}","tls":"45bcf826.1d4be","clientid":"${MQTT_CLIENT_ID}","usetls":true,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"45bcf826.1d4be","type":"tls-config","z":"","name":"myTLSconfig","cert":"","key":"","ca":"${MQTT_CA_CERT}","certname":"","keyname":"","caname":"","servername":"${MQTT_HOST}","verifyservercert":true},{"id":"b4236a6b.e5bf68","type":"mqtt-broker","z":"","name":"Homeassistant","broker":"10.0.0.228","port":"1883","clientid":"NodeRed_QNAP01","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"62648e84.65c68","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"c77a8e22.b2895","type":"ui_tab","z":"","name":"Aquaponics","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"9f621075.5922c","type":"ui_group","z":"","name":"Power utilization","tab":"c77a8e22.b2895","order":1,"disp":true,"width":"6","collapse":false},{"id":"cd52caa.8e68738","type":"ui_group","z":"","name":"Fish tank","tab":"c77a8e22.b2895","order":2,"disp":true,"width":"6","collapse":false},{"id":"39c44d55.acac52","type":"ui_group","z":"","name":"Garden bed","tab":"c77a8e22.b2895","order":4,"disp":true,"width":"6","collapse":false},{"id":"69728ab9.5e70f4","type":"ui_group","z":"","name":"Device","tab":"32e1d43d.69c7fc","order":5,"disp":true,"width":"6","collapse":false},{"id":"45dd1c2b.9209e4","type":"ui_group","z":"","name":"Environment","tab":"c77a8e22.b2895","order":5,"disp":true,"width":"6","collapse":false},{"id":"32e1d43d.69c7fc","type":"ui_tab","z":"","name":"Settings","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"d01c0f4e.71dd8","type":"ui_group","z":"","name":"Water quality","tab":"c77a8e22.b2895","order":3,"disp":true,"width":"6","collapse":false},{"id":"1a8f8df1.c9c002","type":"ui_group","z":"","name":"Fish tank","tab":"32e1d43d.69c7fc","order":1,"disp":true,"width":"6","collapse":false},{"id":"52c2f131.4f6a9","type":"ui_group","z":"","name":"Garden bed","tab":"32e1d43d.69c7fc","order":3,"disp":true,"width":"6","collapse":false},{"id":"ede08b4b.6dc6e8","type":"ui_group","z":"","name":"Pumps and water flow","tab":"32e1d43d.69c7fc","order":2,"disp":true,"width":"6","collapse":false},{"id":"6d1d45a5.11a39c","type":"ui_group","z":"","name":"Public area","tab":"32e1d43d.69c7fc","order":4,"disp":true,"width":"6","collapse":false},{"id":"2d30f75c.6dc2a8","type":"ui_group","z":"","name":"Default Group","tab":"19b0656a.8c522b","order":2,"disp":true,"width":"16","collapse":false},{"id":"dae26d35.c51d3","type":"ui_tab","z":"","name":"Home Tab","icon":"dashboard"},{"id":"c6a4c663.25aad8","type":"ui_group","z":"","name":"Linear Gauges","tab":"32e1d43d.69c7fc","order":1,"disp":true,"width":"12","collapse":false},{"id":"6bc7f4ef.96db5c","type":"mui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"m-base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"m-page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"m-page-backgroundColor":{"value":"#fafafa","edited":false},"m-page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"m-group-textColor":{"value":"#1bbfff","edited":false},"m-group-borderColor":{"value":"#ffffff","edited":false},"m-group-backgroundColor":{"value":"#ffffff","edited":false},"m-widget-textColor":{"value":"#111111","edited":false},"m-widget-backgroundColor":{"value":"#0094ce","edited":false},"m-widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"19b0656a.8c522b","type":"ui_tab","name":"Tab 4","icon":"dashboard","order":4},{"id":"683fda35.28a534","type":"mqtt-broker","z":"","broker":"iot","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"eda26f38.6e2f","type":"mqtt-broker","z":"","broker":"iot","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ba289e7f.b0aa6","type":"ui_group","z":"","name":"Testing","tab":"c77a8e22.b2895","order":6,"disp":true,"width":"6","collapse":false},{"id":"e390e368.50e2a","type":"ui_group","z":"","name":"Tweet Details","tab":"49d284df.de58ac","order":1,"disp":true,"width":"10"},{"id":"c5d66139.168b3","type":"ui_group","z":"","name":"Tweet Scoreboard","tab":"49d284df.de58ac","order":2,"disp":true,"width":"6"},{"id":"49d284df.de58ac","type":"ui_tab","z":"","name":"Tweet Scoreboard","icon":"dashboard","order":1},{"id":"6b652bcf.57ab44","type":"ui_group","z":"","name":"Display","tab":"79f192b7.12682c","order":1,"disp":true,"width":"6","collapse":false},{"id":"79f192b7.12682c","type":"ui_tab","z":"","name":"Shed","icon":"dashboard","disabled":false,"hidden":false},{"id":"cd172dbf.3a23f","type":"homie-convention-broker-config","z":"","mqtt-host":"10.0.0.228","mqtt-port":"1883","usetls":false,"name":"Homeassistant02","homieName":"ESPloader01","homieFriendlyName":"ESPloader01","homieRoot":"cyper","storeGlobal":true},{"id":"46cfa3e5.0bbdac","type":"ui_tab","z":"","name":"Activity","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"29eccd45.3e20f2","type":"ui_group","z":"","name":"Process tracking","tab":"46cfa3e5.0bbdac","order":1,"disp":true,"width":"24","collapse":false},{"id":"7cb40e27.b1fa2","type":"ui_group","z":"","name":"Masterswitches","tab":"84e154af.115e38","order":6,"disp":false,"width":"6","collapse":false},{"id":"a3d88ded.5cefe","type":"ui_group","z":"","name":"Condition","tab":"32105d9d.8c34c2","order":5,"disp":false,"width":"4","collapse":false},{"id":"2ec81be4.1b2744","type":"ui_group","z":"","name":"Wind","tab":"32105d9d.8c34c2","order":4,"disp":false,"width":"4","collapse":false},{"id":"2fd2320.d8e9fce","type":"ui_group","z":"","name":"Luftfeuchtigkeit","tab":"84e154af.115e38","order":4,"disp":false,"width":"6","collapse":false},{"id":"ab04770e.b7af58","type":"ui_group","z":"","name":"Condition","tab":"32105d9d.8c34c2","order":2,"disp":false,"width":"2","collapse":false},{"id":"78ae55a3.35fc6c","type":"ui_group","z":"","name":"Forecast","tab":"32105d9d.8c34c2","order":6,"disp":false,"width":"8","collapse":false},{"id":"84e154af.115e38","type":"ui_tab","z":"","name":"Home","icon":"home","order":1},{"id":"32105d9d.8c34c2","type":"ui_tab","z":"","name":"Wetterstation","icon":"fa-thermometer-half","order":5,"disabled":false,"hidden":false},{"id":"233b752c.71135a","type":"ui_group","z":"","name":"Elektra","tab":"7bd6fc6b.29cca4","order":8,"disp":true,"width":"6","collapse":false},{"id":"977f1d1f.c77a5","type":"ui_group","z":"","name":"Gas","tab":"7bd6fc6b.29cca4","order":9,"disp":true,"width":"6","collapse":false},{"id":"7bd6fc6b.29cca4","type":"ui_tab","z":"","name":"Energie","icon":"dashboard","order":1},{"id":"fb6d6a2f.8e8cb8","type":"ui_group","name":"Group 1","tab":"90b79e20.87d86","order":1,"disp":true,"width":6},{"id":"90b79e20.87d86","type":"ui_tab","name":"Tab 6","icon":"dashboard","order":7},{"id":"3a1cb6a4.52d20a","type":"ui_group","z":"","name":"Group 2","tab":"88d8a245.5ee69","order":2,"disp":true,"width":"11","collapse":false},{"id":"88d8a245.5ee69","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":4},{"id":"d6cfd8c8.405af8","type":"ui_group","z":"","name":"Default","tab":"2f46c8e3.73f3d8","order":1,"disp":true,"width":"12","collapse":false},{"id":"2f46c8e3.73f3d8","type":"ui_tab","z":"","name":"Home","icon":"home","order":1,"disabled":false,"hidden":false},{"id":"a0a384b2.b52d18","type":"mqtt-broker","z":"","name":"Homeassistant","broker":"10.0.0.228","port":"1883","clientid":"NodeRed_MTDEV","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c9722c8d.64dbd","type":"ui_group","z":"","name":"Power utilization","tab":"261e24eb.f7b19c","order":1,"disp":true,"width":"6","collapse":false},{"id":"c6a2ef5f.20448","type":"ui_group","z":"","name":"Water quality","tab":"261e24eb.f7b19c","order":3,"disp":true,"width":"6","collapse":false},{"id":"e1404fdd.3fd75","type":"ui_group","z":"","name":"Fish tank","tab":"261e24eb.f7b19c","order":2,"disp":true,"width":"6","collapse":false},{"id":"1089106f.c6bd3","type":"ui_group","z":"","name":"Garden bed","tab":"c008d91d.54ce78","order":1,"disp":true,"width":"6","collapse":false},{"id":"4fed397c.f84f18","type":"ui_group","z":"","name":"Display","tab":"9f382af2.be1048","order":2,"disp":true,"width":"6","collapse":false},{"id":"7875f04e.ab78","type":"ui_group","z":"","name":"Device","tab":"9f382af2.be1048","order":1,"disp":true,"width":"6","collapse":false},{"id":"29ab3c3d.3e3274","type":"ui_group","z":"","name":"Uptime","tab":"9f382af2.be1048","order":4,"disp":true,"width":"6","collapse":false},{"id":"22be3ee7.9ef6a2","type":"ui_group","z":"","name":"Schedulers","tab":"db9c2a6.04841d8","order":1,"disp":true,"width":"11","collapse":false},{"id":"e87e20c.1742be","type":"ui_group","z":"","name":"Activity","tab":"9f382af2.be1048","order":3,"disp":true,"width":"12","collapse":false},{"id":"b0dd753a.18a218","type":"ui_group","z":"","name":"Environment","tab":"c9ece6b7.10a258","order":5,"disp":true,"width":"6","collapse":false},{"id":"cf84b0e3.ed6cf","type":"ui_group","z":"","name":"Public area","tab":"6349014e.d5458","order":4,"disp":true,"width":"6","collapse":false},{"id":"7353ba18.a12cf4","type":"ui_group","z":"","name":"Garden bed","tab":"6349014e.d5458","order":3,"disp":true,"width":"6","collapse":false},{"id":"87597877.950078","type":"ui_group","z":"","name":"Fish tank","tab":"6349014e.d5458","order":1,"disp":true,"width":"6","collapse":false},{"id":"75b5a904.086ce8","type":"ui_group","z":"","name":"Pumps and water flow","tab":"6349014e.d5458","order":2,"disp":true,"width":"6","collapse":false},{"id":"5f8e275b.659058","type":"ui_group","z":"","name":"Device","tab":"c9ece6b7.10a258","order":2,"disp":true,"width":"6","collapse":false},{"id":"824f9551.65cc68","type":"ui_group","z":"","name":"Water management","tab":"c9903ec6.a188a","order":2,"disp":true,"width":"24","collapse":false},{"id":"486ddb3.897c124","type":"ui_group","z":"","name":"Notes","tab":"db9c2a6.04841d8","order":2,"disp":true,"width":"12","collapse":false},{"id":"db9c7eba.cf4df","type":"ui_group","z":"","name":"Light","tab":"c9ece6b7.10a258","order":3,"disp":true,"width":"6","collapse":false},{"id":"3b0c5bc8.f22294","type":"ui_group","z":"","name":"Processing","tab":"c9903ec6.a188a","order":1,"disp":true,"width":"24","collapse":false},{"id":"689cb110.b12b9","type":"ui_group","z":"","name":"Activity","tab":"6575d39f.f3fcbc","order":4,"disp":true,"width":"6","collapse":false},{"id":"261e24eb.f7b19c","type":"ui_tab","z":"","name":"Aquaponics","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"c008d91d.54ce78","type":"ui_tab","z":"","name":"Garden Beds","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"9f382af2.be1048","type":"ui_tab","z":"","name":"Setup","icon":"dashboard","order":8,"disabled":false,"hidden":false},{"id":"db9c2a6.04841d8","type":"ui_tab","z":"","name":"Services","icon":"dashboard","order":9,"disabled":false,"hidden":false},{"id":"c9ece6b7.10a258","type":"ui_tab","z":"","name":"Public Areas","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"6349014e.d5458","type":"ui_tab","z":"","name":"Sensors","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"c9903ec6.a188a","type":"ui_tab","z":"","name":"Activity","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"6575d39f.f3fcbc","type":"ui_tab","z":"","name":"Fish population","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"c4b578d0.dcd248","type":"mui_group","z":"","name":"Temp","tab":"","disp":true,"width":"6","collapse":false},{"id":"63760986.0a6e28","type":"ui_tab","z":"","name":"Michael Tests","icon":"dashboard","order":22,"disabled":false,"hidden":false},{"id":"5283946.d10f96c","type":"ui_group","z":"","name":"Button","tab":"63760986.0a6e28","order":1,"disp":true,"width":"6","collapse":false},{"id":"22379689.b0f32a","type":"mui_group","name":"Group","tab":"","order":null,"disp":true,"width":6},{"id":"67d89282.2684fc","type":"ui_group","z":"","name":"Gauge","tab":"63760986.0a6e28","order":2,"disp":true,"width":"6","collapse":false},{"id":"2f9236d5.ca8e2a","type":"ui_group","z":"","name":"JSON Weather","tab":"63760986.0a6e28","order":3,"disp":true,"width":"6","collapse":false},{"id":"1ef9a6ae.4753f9","type":"ui_tab","z":"","name":"Sensor Tests","icon":"dashboard","order":23,"disabled":false,"hidden":false},{"id":"3038b803.7628d8","type":"ui_group","z":"","name":"Sensors","tab":"1ef9a6ae.4753f9","order":1,"disp":true,"width":"6","collapse":false},{"id":"29e9380f.267a58","type":"ui_group","z":"","name":"Linear Gauges","tab":"a57b9179.aebf9","order":1,"disp":true,"width":"12","collapse":false},{"id":"a57b9179.aebf9","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"d835b4a9.7681b8","type":"ui_group","z":"","name":"Temp 00","tab":"a0a13bbc.3da0b8","order":1,"disp":true,"width":"6","collapse":false},{"id":"a0a13bbc.3da0b8","type":"ui_tab","z":"","name":"Tank Temperatures","icon":"dashboard","order":25,"disabled":false,"hidden":false},{"id":"c52a337b.b7d5e","type":"ui_group","z":"","name":"Temp 01","tab":"a0a13bbc.3da0b8","order":2,"disp":true,"width":"6","collapse":false},{"id":"be3051b7.b8a6b","type":"ui_group","z":"","name":"Temp 03","tab":"a0a13bbc.3da0b8","order":3,"disp":true,"width":"6","collapse":false},{"id":"c678a57a.ff7b78","type":"ui_tab","z":"","name":"Reboots","icon":"dashboard","order":26,"disabled":false,"hidden":false},{"id":"815b3bf2.a68b18","type":"ui_group","z":"","name":"Reboots","tab":"c678a57a.ff7b78","order":1,"disp":true,"width":"6","collapse":false},{"id":"d6fd5d23.e6c2d","type":"ui_group","z":"","name":"Email","tab":"c678a57a.ff7b78","order":2,"disp":true,"width":"6","collapse":false},{"id":"663db863.d1ace8","type":"influxdb","z":"d809a3fb.a012","hostname":"10.0.0.211","port":"31777","protocol":"http","database":"DB_MAIN","name":"","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://10.0.0.211:19086","rejectUnauthorized":false},{"id":"2654d12e.02834e","type":"websocket-listener","z":"","path":"https://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb","wholemsg":"false"},{"id":"2ed8d6de.34667a","type":"ui_tab","z":"","name":"Lachlan","icon":"dashboard","disabled":false,"hidden":false},{"id":"d93ac5a3.945168","type":"ui_group","z":"","name":"Demo","tab":"2ed8d6de.34667a","order":1,"disp":true,"width":"6","collapse":false},{"id":"78b47e1.cad368","type":"Stackhero-InfluxDB-v2-Server","z":"","name":"","host":"10.0.0.211","port":"19086","tls":false},{"id":"db032a0b.8a8af8","type":"influxdb","z":"","hostname":"10.0.0.211","port":"31777","protocol":"http","database":"DB_MAIN","name":"","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://10.0.0.211:19086","rejectUnauthorized":true},{"id":"ba6be8ce.0d6ab8","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"database","name":"","usetls":false,"tls":"691a7411.7bf21c","influxdbVersion":"2.0","url":"https://localhost:9999","rejectUnauthorized":false},{"id":"691a7411.7bf21c","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false},{"id":"52650902.d793e8","type":"mqtt-broker","z":"d809a3fb.a012","broker":"localhost","port":"1883","clientid":"node-red","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"d39b95d1.f64f38","type":"ui_group","z":"","name":"Influx 2.0 API Dashboard","tab":"c77a8e22.b2895","order":7,"disp":true,"width":"6","collapse":false},{"id":"5dccf103.3011e","type":"ui_group","z":"","name":"Col1","tab":"1a420024.c982b","order":1,"disp":false,"width":"6"},{"id":"c7a9a42a.106df8","type":"ui_group","z":"","name":"Actions","tab":"1a420024.c982b","order":4,"disp":true,"width":"6"},{"id":"97d7821b.cd5ce","type":"ui_group","z":"","name":"Col2","tab":"1a420024.c982b","order":2,"disp":false,"width":"6"},{"id":"9c646598.9872f8","type":"ui_group","z":"","name":"Col3","tab":"1a420024.c982b","order":3,"disp":false,"width":"6"},{"id":"1a420024.c982b","type":"ui_tab","z":"","name":"RPi Control","icon":"dashboard","order":1},{"id":"eeba44d1.4a0aa8","type":"inject","z":"2f5cab58.57de34","name":"ON","topic":"aa","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":262,"wires":[["e365538.70dc3b"]]},{"id":"5e9c9b55.6aaf24","type":"inject","z":"2f5cab58.57de34","name":"OFF","topic":"aa","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":342,"wires":[["e365538.70dc3b"]]},{"id":"282a7330.f1beec","type":"ui_gauge","z":"14d67294.62b07d","name":"pH","group":"c6a2ef5f.20448","order":2,"width":0,"height":0,"gtype":"gage","title":"pH","label":"units","format":"{{value}}","min":0,"max":"1000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":610,"y":220,"wires":[]},{"id":"c14d8170.35573","type":"ui_text","z":"14d67294.62b07d","group":"c6a2ef5f.20448","order":1,"width":0,"height":0,"name":"pH status","label":"pH status","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":260,"wires":[]},{"id":"6bebe705.acd7c8","type":"comment","z":"14d67294.62b07d","name":"Power Utilization","info":"","x":460,"y":20,"wires":[]},{"id":"eb41b483.e3cd88","type":"comment","z":"14d67294.62b07d","name":"Fish tank","info":"","x":620,"y":20,"wires":[]},{"id":"2109b944.264b96","type":"function","z":"14d67294.62b07d","name":"Water","func":"var topic=msg.topic;\nif (topic==\"waterquality/ph\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":22,"noerr":0,"x":130,"y":360,"wires":[["5a6b6e78.035c7","282a7330.f1beec"],["c14d8170.35573"],["534b7482.44d07c"],["328ec9f2.5ab366"],["a8d2115.1f104f","8c6109f7.1e29d8","d837859b.587d98","626e98a6.f31898","282846b8.a281ca"],["ef9a9e7f.da934"],["b4b830a3.ab42c"],[],[],[],[],["d981b4d8.ded4a8"],[],[],[],[],[],["9aa67eb2.005eb","b710316f.00fd1","5662c47c.8b02fc"],["9aa67eb2.005eb","b710316f.00fd1"],["9aa67eb2.005eb","b710316f.00fd1","5662c47c.8b02fc"],["9aa67eb2.005eb","b710316f.00fd1"],["9aa67eb2.005eb"]]},{"id":"328ec9f2.5ab366","type":"ui_text","z":"14d67294.62b07d","group":"c6a2ef5f.20448","order":5,"width":0,"height":0,"name":"Turb Temp","label":"Turbidity Temperature","format":"{{msg.payload}}","layout":"row-spread","x":630,"y":380,"wires":[]},{"id":"534b7482.44d07c","type":"ui_gauge","z":"14d67294.62b07d","name":"Turbidity","group":"c6a2ef5f.20448","order":4,"width":0,"height":0,"gtype":"gage","title":"Turbidity","label":"units","format":"{{value}}","min":0,"max":"1000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":620,"y":340,"wires":[]},{"id":"5a6b6e78.035c7","type":"ui_chart","z":"14d67294.62b07d","name":"pH 8Hrs","group":"c6a2ef5f.20448","order":3,"width":0,"height":0,"label":"pH tracking","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":620,"y":300,"wires":[[],[]]},{"id":"daf2c1a7.cacce","type":"comment","z":"14d67294.62b07d","name":"Garden","info":"","x":830,"y":20,"wires":[]},{"id":"a8d2115.1f104f","type":"ui_gauge","z":"14d67294.62b07d","name":"Water temp-Low","group":"e1404fdd.3fd75","order":3,"width":"2","height":"3","gtype":"gage","title":"Bottom","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":640,"y":500,"wires":[]},{"id":"ef9a9e7f.da934","type":"ui_gauge","z":"14d67294.62b07d","name":"Water temp-Mid","group":"e1404fdd.3fd75","order":4,"width":"2","height":"3","gtype":"gage","title":"Mid","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":640,"y":540,"wires":[]},{"id":"b4b830a3.ab42c","type":"ui_gauge","z":"14d67294.62b07d","name":"Water temp-Upper","group":"e1404fdd.3fd75","order":5,"width":"2","height":"3","gtype":"gage","title":"Surface","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":650,"y":580,"wires":[]},{"id":"3ae9b6c4.5b818a","type":"comment","z":"14d67294.62b07d","name":"Environment","info":"","x":1050,"y":20,"wires":[]},{"id":"fea2eee1.e7bc5","type":"sentiment","z":"14d67294.62b07d","name":"","property":"payload","x":1040,"y":140,"wires":[[]]},{"id":"3cc973f1.c7ca1c","type":"sunrise","z":"14d67294.62b07d","name":"Daytime","lat":"33.8396","lon":"151.2054","start":"sunrise","end":"sunset","x":100,"y":1280,"wires":[["63c052a9.c394dc"],["29bd05ff.7b271a"]]},{"id":"9aa67eb2.005eb","type":"ui_chart","z":"14d67294.62b07d","name":"Tank temperatures","group":"e1404fdd.3fd75","order":1,"width":0,"height":0,"label":"Tank Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":650,"y":620,"wires":[[]]},{"id":"ffe40eb3.16bdb","type":"function","z":"14d67294.62b07d","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":120,"y":620,"wires":[["7679f627.00ef78","aa9cab36.5771e8"],["7679f627.00ef78","a2fc31d6.283b6"],["7679f627.00ef78","4eda3a8e.266ea4"],["7679f627.00ef78"],["4309222c.6e26ac"],["f39c6ad2.35c678"],[],[],["208e7753.0707a8"],["208e7753.0707a8"],[],[]]},{"id":"7679f627.00ef78","type":"ui_statechart","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":8,"width":0,"height":0,"name":"Moisture","label":"Moisture","series":"A,B,C,D","showvalues":true,"colorON":"#009933","colorOFF":"#999999","colorFromTheme":true,"fontColorFromTheme":true,"textoptions":"default","colorText":"#eeeeee","fontLabel":"","fontValue":"","fontSeries":"","x":840,"y":140,"wires":[]},{"id":"208e7753.0707a8","type":"ui_chart","z":"14d67294.62b07d","name":"Soil temperatures","group":"1089106f.c6bd3","order":4,"width":0,"height":0,"label":"Soil Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":870,"y":220,"wires":[[],[]]},{"id":"3d89aab.5a88b56","type":"mqtt out","z":"14d67294.62b07d","name":"sendMQTT","topic":"","qos":"","retain":"","broker":"a0a384b2.b52d18","x":2170,"y":560,"wires":[]},{"id":"2cbc044.37ac5fc","type":"ui_switch","z":"14d67294.62b07d","name":"Screensaver","label":"Screensaver","tooltip":"","group":"4fed397c.f84f18","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"oledDisplay/screensaver/set","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1250,"y":100,"wires":[["7a740276.5e3aec","bf686cce.0550a","862199d9.d4cc78","24458328.6f670c","5c203918.02f408"]]},{"id":"64fff6cc.745958","type":"comment","z":"14d67294.62b07d","name":"Device","info":"","x":1230,"y":20,"wires":[]},{"id":"e911091e.610818","type":"function","z":"14d67294.62b07d","name":"MCU","func":"var topic=msg.topic;\nif (topic==\"mcu/heartbeat\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/vcc\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/chipsize\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/freespace\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/ntptime\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/uptime\") {\n    // msg=msg/1000/60;     // Doesnt work !!!\n    ////var payload;\n    ////var d = new Date();\n    ////var t = d.getTime();\n    ////payload={\"time\":t,\"payload\":msg.payload,\"topic\"}\n    ////  //msg.payload=JSON.stringify(payload);\n    ////  //msg.payload=payload;\n    flow.set(\"mcu_uptime\",\"testMsg\");\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule01\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule03\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule04\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule05\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/execlog\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"$state\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/startingup\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"$localip\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"$mac\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"$name\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"$implementation\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"$homie\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg],null;\n}\nif (topic==\"$homie\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":20,"noerr":0,"x":830,"y":680,"wires":[[],["9e257e27.f968f"],["c08429a5.c02ab8"],["ecdc9540.864a08"],["411d00db.4a375"],["e266009f.6d21e","55125375.6b183c","f178f391.d9d4b"],["bac6c833.c06d18"],["ef4ed36f.ed20a"],["f8162d5b.4423c"],["60f8f2ef.df159c"],["e22420f5.b3423"],["499ab463.0996fc"],["964bb6b2.cd0d98","517bbfcf.e5611","1eeee66f.7f7aca"],["c801faf1.ec4198","d78b9953.4755a8"],["9874ea38.185ec8"],["1af815e1.967e0a"],["d88cb1e.fb6245"],["3a8def62.16cf6"],["fcdc13d7.5cb11"],[]]},{"id":"9e257e27.f968f","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":5,"width":0,"height":0,"name":"VCC","label":"VCC","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":260,"wires":[]},{"id":"8c6109f7.1e29d8","type":"ui_gauge","z":"14d67294.62b07d","name":"Internal Temp","group":"7875f04e.ab78","order":14,"width":0,"height":0,"gtype":"gage","title":"Internal temperature","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":1260,"y":860,"wires":[]},{"id":"c08429a5.c02ab8","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":6,"width":0,"height":0,"name":"Chipsize","label":"Chipsize","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":300,"wires":[]},{"id":"ecdc9540.864a08","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":13,"width":0,"height":0,"name":"Freespace","label":"Freespace","format":"{{msg.payload}}","layout":"row-spread","x":1250,"y":340,"wires":[]},{"id":"411d00db.4a375","type":"ui_text","z":"14d67294.62b07d","group":"29ab3c3d.3e3274","order":1,"width":0,"height":0,"name":"NTP time","label":"NTP time","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":380,"wires":[]},{"id":"e266009f.6d21e","type":"ui_text","z":"14d67294.62b07d","group":"29ab3c3d.3e3274","order":2,"width":0,"height":0,"name":"Uptime","label":"Uptime (Sec)","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":420,"wires":[]},{"id":"bac6c833.c06d18","type":"ui_switch","z":"14d67294.62b07d","name":"TaskScheduler1","label":"TaskScheduler1","tooltip":"","group":"22be3ee7.9ef6a2","order":1,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule01/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":580,"wires":[["5c203918.02f408"]]},{"id":"ef4ed36f.ed20a","type":"ui_switch","z":"14d67294.62b07d","name":"TaskScheduler2","label":"TaskScheduler2","tooltip":"","group":"22be3ee7.9ef6a2","order":3,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule02/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":620,"wires":[["5c203918.02f408"]]},{"id":"f8162d5b.4423c","type":"ui_switch","z":"14d67294.62b07d","name":"TaskScheduler3","label":"TaskScheduler3","tooltip":"","group":"22be3ee7.9ef6a2","order":6,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule03/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":660,"wires":[["5c203918.02f408"]]},{"id":"60f8f2ef.df159c","type":"ui_switch","z":"14d67294.62b07d","name":"TaskScheduler4","label":"TaskScheduler4","tooltip":"","group":"22be3ee7.9ef6a2","order":9,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule04/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":700,"wires":[["5c203918.02f408"]]},{"id":"e22420f5.b3423","type":"ui_switch","z":"14d67294.62b07d","name":"TaskScheduler5","label":"TaskScheduler5","tooltip":"","group":"22be3ee7.9ef6a2","order":12,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule05/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":740,"wires":[["5c203918.02f408"]]},{"id":"9a973030.fcafc","type":"function","z":"14d67294.62b07d","name":"Environ","func":"var topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":11,"noerr":0,"x":120,"y":800,"wires":[["6ef5f17c.81438"],["ee4c4192.57e2"],["c8709091.ca4fa"],["5194ecef.fec894"],["636885f5.b6024c"],["1032e446.8cf58c"],["a50763ad.157"],["b5ab4801.877f68"],["d3189187.964c1"],["e2852508.8b1a98"],["de267436.8370b8"]]},{"id":"499ab463.0996fc","type":"ui_list","z":"14d67294.62b07d","group":"e87e20c.1742be","name":"ExecLog","order":2,"width":0,"height":0,"lineType":"one","actionType":"none","allowHTML":false,"outputs":0,"topic":"","x":1240,"y":780,"wires":[]},{"id":"6ef5f17c.81438","type":"ui_gauge","z":"14d67294.62b07d","name":"Noise","group":"b0dd753a.18a218","order":2,"width":0,"height":0,"gtype":"gage","title":"Noise levels","label":"units","format":"{{value}}","min":"49","max":"75","colors":["#3ce10e","#eec52f","#cb483a"],"seg1":"55","seg2":"65","x":1030,"y":180,"wires":[]},{"id":"ee4c4192.57e2","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":4,"width":0,"height":0,"name":"Temperature","label":"Temperature","format":"{{msg.payload}}","layout":"row-spread","x":1050,"y":220,"wires":[]},{"id":"c8709091.ca4fa","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":6,"width":0,"height":0,"name":"Ave Temp","label":"Average Temperature","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":260,"wires":[]},{"id":"5194ecef.fec894","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":8,"width":0,"height":0,"name":"Humidity","label":"Humidity","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":300,"wires":[]},{"id":"636885f5.b6024c","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":10,"width":0,"height":0,"name":"ABS Humid","label":"Absolute humidity","format":"{{msg.payload}}","layout":"row-spread","x":1050,"y":340,"wires":[]},{"id":"1032e446.8cf58c","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":11,"width":0,"height":0,"name":"Heat Idx","label":"Heat index","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":380,"wires":[]},{"id":"a50763ad.157","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":12,"width":0,"height":0,"name":"Pressure","label":"Air pressure","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":420,"wires":[]},{"id":"b5ab4801.877f68","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":13,"width":0,"height":0,"name":"Altitude","label":"Altitude","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":460,"wires":[]},{"id":"d3189187.964c1","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":3,"width":0,"height":0,"name":"UV index","label":"UV index","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":500,"wires":[]},{"id":"e2852508.8b1a98","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":5,"width":0,"height":0,"name":"UV rating","label":"UV rating","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":540,"wires":[]},{"id":"aa9cab36.5771e8","type":"ui_text","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":1,"width":0,"height":0,"name":"Soil 1","label":"Soil moisture 1","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":260,"wires":[]},{"id":"a2fc31d6.283b6","type":"ui_text","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":2,"width":0,"height":0,"name":"Soil 2","label":"Soil moisture 2","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":300,"wires":[]},{"id":"4eda3a8e.266ea4","type":"ui_text","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":3,"width":0,"height":0,"name":"Soil 3","label":"Soil moisture 3","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":340,"wires":[]},{"id":"33ecd3c0.6170ec","type":"ui_switch","z":"14d67294.62b07d","name":"Proximity","label":"Proximity sensors","tooltip":"","group":"cf84b0e3.ed6cf","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorproximity/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1340,"wires":[["5c203918.02f408"]]},{"id":"729e2e1f.df554","type":"ui_switch","z":"14d67294.62b07d","name":"Sound","label":"Loudness sensors","tooltip":"","group":"cf84b0e3.ed6cf","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorsound/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1260,"wires":[["5c203918.02f408"]]},{"id":"2d74ced8.deb2e2","type":"ui_switch","z":"14d67294.62b07d","name":"UV","label":"UV sensors","tooltip":"","group":"cf84b0e3.ed6cf","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensoruv/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1300,"wires":[["5c203918.02f408"]]},{"id":"31a6b2dd.67550e","type":"ui_switch","z":"14d67294.62b07d","name":"Moisture","label":"Soil moisture","tooltip":"","group":"7353ba18.a12cf4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensormoisture/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1380,"wires":[["5c203918.02f408"]]},{"id":"250ed274.94314e","type":"ui_switch","z":"14d67294.62b07d","name":"Rainfall","label":"Rainfall sensors","tooltip":"","group":"7353ba18.a12cf4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorrainfall/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1420,"wires":[["5c203918.02f408"]]},{"id":"fb97d1de.83de8","type":"ui_switch","z":"14d67294.62b07d","name":"Light","label":"Light sensors","tooltip":"","group":"7353ba18.a12cf4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorlight/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1460,"wires":[["5c203918.02f408"]]},{"id":"c12b7a3f.a30248","type":"ui_switch","z":"14d67294.62b07d","name":"Environ","label":"Environment sensors","tooltip":"","group":"7353ba18.a12cf4","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorenviron/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1500,"wires":[["5c203918.02f408"]]},{"id":"d9fb17c6.b54778","type":"ui_switch","z":"14d67294.62b07d","name":"Air","label":"Air quality","tooltip":"","group":"cf84b0e3.ed6cf","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorair/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1540,"wires":[["5c203918.02f408"]]},{"id":"8c0b1411.e9b808","type":"ui_switch","z":"14d67294.62b07d","name":"Vibrate","label":"Vibration sensors","tooltip":"","group":"cf84b0e3.ed6cf","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorvibrate/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1580,"wires":[["5c203918.02f408"]]},{"id":"93edf209.4f8b8","type":"ui_switch","z":"14d67294.62b07d","name":"Hydraphone","label":"Hydraphone sensors","tooltip":"","group":"87597877.950078","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorhydraphone/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1310,"y":1620,"wires":[["5c203918.02f408"]]},{"id":"8f833921.3c1e98","type":"ui_switch","z":"14d67294.62b07d","name":"Dooropen","label":"Door open sensors","tooltip":"","group":"87597877.950078","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensordooropen/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1260,"wires":[["5c203918.02f408"]]},{"id":"aeec0165.569cb","type":"ui_switch","z":"14d67294.62b07d","name":"Fishfeed","label":"Fishfeed control","tooltip":"","group":"87597877.950078","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorfishfeed/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1300,"wires":[["5c203918.02f408"]]},{"id":"3c598a3b.30ec36","type":"ui_switch","z":"14d67294.62b07d","name":"Power","label":"Power sensors","tooltip":"","group":"75b5a904.086ce8","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorpower/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1380,"wires":[["5c203918.02f408"]]},{"id":"3ab81750.e0f298","type":"ui_switch","z":"14d67294.62b07d","name":"Waterlevel","label":"Waterlevel sensors","tooltip":"","group":"87597877.950078","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlevel/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1420,"wires":[["5c203918.02f408"]]},{"id":"2793ee43.bd4cb2","type":"ui_switch","z":"14d67294.62b07d","name":"Waterflow","label":"Waterflow sensors","tooltip":"","group":"75b5a904.086ce8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlflow/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1460,"wires":[["5c203918.02f408"]]},{"id":"6440ccf3.723624","type":"ui_switch","z":"14d67294.62b07d","name":"Thermister","label":"Water temperature sensors","tooltip":"","group":"75b5a904.086ce8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorthermister/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1540,"wires":[["5c203918.02f408"]]},{"id":"adadc1dd.4fd77","type":"ui_switch","z":"14d67294.62b07d","name":"pH","label":"pH sensors","tooltip":"","group":"87597877.950078","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorph/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1580,"wires":[["5c203918.02f408"]]},{"id":"a36394d5.7a96a8","type":"ui_switch","z":"14d67294.62b07d","name":"Turbidity","label":"Turbidity sensors","tooltip":"","group":"87597877.950078","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlevel/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1620,"wires":[["5c203918.02f408"]]},{"id":"7ffbcee2.eb3d7","type":"ui_switch","z":"14d67294.62b07d","name":"Waterqual","label":"Water quality","tooltip":"","group":"87597877.950078","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterqual/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1500,"wires":[["5c203918.02f408"]]},{"id":"53fe751f.78847c","type":"function","z":"14d67294.62b07d","name":"Sensor2","func":"var topic=msg.topic;\nif (topic===\"mcu/setsensordooropen\") {\nreturn [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorfishfeed\") {\nreturn [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorrelay\") {\nreturn [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorpower\") {\nreturn [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterlevel\") {\nreturn [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterflow\") {\nreturn [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterqual\") {\nreturn [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic===\"mcu/setsensorthermister\") {\nreturn [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic===\"mcu/setsensorph\") {\nreturn [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic===\"mcu/setsensorturbidity\") {\nreturn [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":840,"y":1520,"wires":[["8f833921.3c1e98"],["aeec0165.569cb"],["36664435.916d6c"],["3c598a3b.30ec36"],["3ab81750.e0f298"],["2793ee43.bd4cb2"],["7ffbcee2.eb3d7"],["6440ccf3.723624"],["adadc1dd.4fd77"],["a36394d5.7a96a8"]]},{"id":"36664435.916d6c","type":"ui_switch","z":"14d67294.62b07d","name":"Relays","label":"Relays","tooltip":"","group":"75b5a904.086ce8","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorrelay/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1340,"wires":[["5c203918.02f408"]]},{"id":"f370992d.ddc4e8","type":"function","z":"14d67294.62b07d","name":"Sensor1","func":"var topic=msg.topic;\nif (topic===\"mcu/setsensorsound\"){\n    return [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensoruv\"){\n    return [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorproximity\"){\n    return [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensormoisture\"){\n    return [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorrainfall\"){\n    return [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorlight\"){\n    return [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic===\"mcu/setsensorenviron\"){\n    return [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic===\"mcu/setsensorair\"){\n    return [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic===\"mcu/setsensorvibrate\"){\n    return [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic===\"mcu/setsensorhydraphone\"){\n    return [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":840,"y":1320,"wires":[["729e2e1f.df554"],["2d74ced8.deb2e2"],["33ecd3c0.6170ec"],["31a6b2dd.67550e"],["250ed274.94314e"],["fb97d1de.83de8"],["c12b7a3f.a30248"],["d9fb17c6.b54778"],["8c0b1411.e9b808"],["93edf209.4f8b8"]]},{"id":"de267436.8370b8","type":"function","z":"14d67294.62b07d","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":900,"wires":[["ea56458e.1725c8"]]},{"id":"ea56458e.1725c8","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":9,"width":"0","height":"0","name":"Led","label":"Proximity detection","format":"{{msg.status}}<font color={{msg.color}} ><i class=\"fa fa-circle\" style=\"font-size:24px;\"></i></font>","layout":"row-spread","x":1030,"y":580,"wires":[]},{"id":"252c3823.92faf8","type":"ui_button","z":"14d67294.62b07d","name":"Restart","group":"29ab3c3d.3e3274","order":6,"width":0,"height":0,"passthru":false,"label":"Restart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"str","topic":"mcu/restart/set","x":1240,"y":540,"wires":[["e83ed8b1.6f5198","24458328.6f670c"]]},{"id":"964bb6b2.cd0d98","type":"ui_gauge","z":"14d67294.62b07d","name":"WiFiConnection","group":"5f8e275b.659058","order":2,"width":"6","height":"3","gtype":"compass","title":"Wifi","label":"","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1060,"y":620,"wires":[]},{"id":"16309f4b.985ff1","type":"inject","z":"14d67294.62b07d","name":"color","topic":"color","payload":"Fire","payloadType":"str","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":1320,"wires":[["f942aef2.7a4bb"]]},{"id":"f942aef2.7a4bb","type":"trigger","z":"14d67294.62b07d","op1":"lime","op2":"white","op1type":"str","op2type":"str","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","name":"color","x":110,"y":1360,"wires":[["55125375.6b183c","f178f391.d9d4b"]]},{"id":"55125375.6b183c","type":"join","z":"14d67294.62b07d","name":"join","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"","joinerType":"str","accumulate":false,"timeout":"2","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":290,"y":1360,"wires":[["e645d45.5b89928","59482488.79451c","76f8581d.c4c3b8"]]},{"id":"e645d45.5b89928","type":"ui_text","z":"14d67294.62b07d","group":"29ab3c3d.3e3274","order":5,"width":0,"height":0,"name":"Heartbeat","label":"Heartbeat","format":"{{global.get(\"mcu_uptime\")}}<font color={{msg.payload.color}} ><i class=\"fa fa-circle\" style=\"font-size:24px;\"></i></font>","layout":"row-spread","x":1240,"y":500,"wires":[]},{"id":"9550699c.b743b8","type":"ui_valuetrail","z":"14d67294.62b07d","group":"c9722c8d.64dbd","order":5,"width":0,"height":0,"name":"Ph2","label":"","unit":"","blur":true,"minmax":false,"showvalue":false,"decimals":0,"colorLine":"#ff9900","colorFromTheme":true,"stroke":2,"property":"payload","pointcount":8,"x":610,"y":160,"wires":[]},{"id":"2d3f116c.e990fe","type":"function","z":"14d67294.62b07d","name":"TrackEvents","func":"var max_duration = .1;\nvar colorArray = ['#FF6633','#4D4D4D','#5DA5DA','#FAA43A','#60BD68','#F17CB0','#B2912F','#B276B2','#DECF3F','#F15854'];\n\n// If cache was passed in, then assume it came from the perist node.\n// Set it in context to restore the chart state\nif(typeof(msg.cache) === \"object\"){\n    context.set('cache',msg.cache);\n}\n\nvar cache = context.get('cache');\nif(typeof(cache) === \"undefined\"){\n    // node.warn(\"Init cache\");\n    cache = {\n        labels: [],\n        datasets: [],\n        \n    }\n}\n\nif(typeof(msg.topic) === \"string\" && typeof(msg.payload) === \"boolean\"){\n    // Begin history tracking\n    // This topic is new so init the object and push it onto the labels and datasets arrays\n    if(cache.labels.indexOf(msg.topic) == -1){\n        // node.warn(\"create new label\");\n        cache.labels.push(msg.topic);\n        \n        cache.datasets.push({\n            label: msg.topic,\n            current: false,\n            timestamp: new Date(),\n            data: []\n        });\n    }\n\n    var thisIndex = cache.labels.indexOf(msg.topic);\n    \n    // The state has changed\n    if(msg.payload != cache.datasets[thisIndex].current){\n        cache.datasets[thisIndex].current = msg.payload;\n        cache.datasets[thisIndex].timestamp = new Date();\n        \n        // Only add a new event if the state switched from false to true\n        if(msg.payload === true){\n            // add a new start/stop event to the topics history\n            var event = [new Date(), new Date(), colorArray[thisIndex]];\n            cache.datasets[thisIndex].data.push(event);\n        }\n    }\n}\n\n\ncache.datasets.forEach(function(topic){\n    // The event is still active so\n    if(topic.current === true && topic.data.length){\n        // Update the event stop time to the current time\n        topic.data[topic.data.length - 1][1] = new Date();\n    }\n    \n\n    topic.data.forEach(function(event, index, object){\n        // cleanup old history (anything with an ending time more than max_duration hours old)\n        if(new Date() - event[1] > max_duration * 3600000){\n            // Delete the event\n            object.splice(index,1);\n        }\n    });\n});\n\n\ncontext.set('cache',cache);\n\nmsg.cache = cache;\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1200,"wires":[["578a17e0.72dc08"]]},{"id":"578a17e0.72dc08","type":"ui_template","z":"14d67294.62b07d","group":"e87e20c.1742be","name":"MCU Events","order":3,"width":"16","height":"9","format":"<script>\nvar ctx = document.getElementById(\"chartjs_timeline_1\").getContext(\"2d\");\n// console.log(scope);\n\n\nscope.chart = new Chart(ctx, {\n    type: 'timeLine',\n    options: {\n        animation: false,\n        responsive: true,\n        colorFunction: function(data){\n            // data is the dataset event point.\n            // The first and second entries are the start/stop date\n            //The third entry specifies the color to use\n            return (typeof data[2] === 'undefined' ? 'black' : data[2]);\n        }\n    },\n    data: {\n        labels: [],\n        datasets: []\n    }\n});\n\n    \n(function(scope){\n    scope.$watch('msg', function(msg) {\n        if(typeof(msg) !== \"object\") return;\n\n        if(typeof(msg.cache) === \"object\"){\n            scope.chart.config.data.labels = msg.cache.labels;\n            scope.chart.config.data.datasets = msg.cache.datasets;\n        }\n\n        //redraw\n        scope.chart.update();\n    });\n})(scope);\n\n</script>\n\n<div style=\"width: 100%;\">\n    <canvas id=\"chartjs_timeline_1\"></canvas>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1310,"y":1200,"wires":[[]]},{"id":"e16a9d37.dde2f","type":"ui_template","z":"14d67294.62b07d","group":"e87e20c.1742be","name":"ChartJS Timeline library(Non Display)","order":1,"width":0,"height":0,"format":"<script>\nconst helpers = Chart.helpers;\nconst isArray = helpers.isArray;\n\nvar time = {\n\t\tunits: [{\n\t\t\tname: 'millisecond',\n\t\t\tsteps: [1, 2, 5, 10, 20, 50, 100, 250, 500]\n\t\t}, {\n\t\t\tname: 'second',\n\t\t\tsteps: [1, 2, 5, 10, 30]\n\t\t}, {\n\t\t\tname: 'minute',\n\t\t\tsteps: [1, 2, 5, 10, 30]\n\t\t}, {\n\t\t\tname: 'hour',\n\t\t\tsteps: [1, 2, 3, 6, 12]\n\t\t}, {\n\t\t\tname: 'day',\n\t\t\tsteps: [1, 2, 3, 5]\n\t\t}, {\n\t\t\tname: 'week',\n\t\t\tmaxStep: 4\n\t\t}, {\n\t\t\tname: 'month',\n\t\t\tmaxStep: 3\n\t\t}, {\n\t\t\tname: 'quarter',\n\t\t\tmaxStep: 4\n\t\t}, {\n\t\t\tname: 'year',\n\t\t\tmaxStep: false\n\t\t}]\n};\n\nvar myConfig = {\n    myTime : {\n        redoLabels: false\n    },\n    position: 'bottom',\n\n    time: {\n        parser: false, // false == a pattern string from http://momentjs.com/docs/#/parsing/string-format/ or a custom callback that converts its argument to a moment\n        format: false, // DEPRECATED false == date objects, moment object, callback or a pattern string from http://momentjs.com/docs/#/parsing/string-format/\n        unit: false, // false == automatic or override with week, month, year, etc.\n        round: false, // none, or override with week, month, year, etc.\n        displayFormat: false, // DEPRECATED\n        isoWeekday: false, // override week start day - see http://momentjs.com/docs/#/get-set/iso-weekday/\n        minUnit: 'millisecond',\n\n        // defaults to unit's corresponding unitFormat below or override using pattern string from http://momentjs.com/docs/#/displaying/format/\n        displayFormats: {\n            millisecond: 'h:mm:ss.SSS a', // 11:20:01.123 AM,\n            second: 'h:mm:ss a', // 11:20:01 AM\n            minute: 'h:mm:ss a', // 11:20:01 AM\n            quarter: '[Q]Q - YYYY', // Q3\n            year: 'YYYY', // 2015        \n            hour: 'MMM D, hA', // Sept 4, 5PM\n            day: 'll', // Sep 4 2015\n            week: 'll', // Week 46, or maybe \"[W]WW - YYYY\" ?\n            month: 'MMM YYYY', // Sept 2015\n            }\n    },\n    ticks: {\n        autoSkip: false\n    }\n};\n\n\nvar myTimeScale = Chart.scaleService.getScaleConstructor('time').extend({\n\n    determineDataLimits: function() {\n        var me = this;\n        me.labelMoments = [];\n\n        // We parse all date labels here, for each entry we parse its initial and end date\n        var scaleLabelMoments = [];\n        if (me.chart.data.datasets && me.chart.data.datasets.length > 0) {\n            helpers.each(me.chart.data.datasets, function(datasets) {\n                var data = datasets.data;\n                var length = data.length;\n                for (var i = 0; i < length; i++) {\n                    // We consider 0 to have initial date\n                    var initialLabelMoment = me.parseTime(data[i][0]);\n                    // we consider 1 to have end date\n                    // TODO maybe add a check to see which one is bigger, but right now i don't know the\n                    // TODO implications off that check\n                    var finalLabelMoment = me.parseTime(data[i][1]);\n                    if (initialLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            initialLabelMoment.startOf(me.options.time.round);\n                        }\n                        scaleLabelMoments.push(initialLabelMoment);\n                    }\n                    if (finalLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            finalLabelMoment.startOf(me.options.time.round);\n                        }\n                        scaleLabelMoments.push(finalLabelMoment);\n                    }\n                }\n            }, me);\n\n            me.firstTick = moment.min.call(me, scaleLabelMoments);\n            me.lastTick = moment.max.call(me, scaleLabelMoments);\n        } else {\n            me.firstTick = null;\n            me.lastTick = null;\n        }\n\n        // In this case label moments are the same as scale moments because this chart only supports\n        // dates as data and not labels like normal time scale. We are doing this to keep\n        // coordination between parent(TimeScale) calls\n        me.labelMoments.push(scaleLabelMoments);\n\n        // Set these after we've done all the data\n        if (me.options.time.min) {\n            me.firstTick = me.parseTime(me.options.time.min);\n        }\n\n        if (me.options.time.max) {\n            me.lastTick = me.parseTime(me.options.time.max);\n        }\n\n        // We will modify these, so clone for later\n        me.firstTick = (me.firstTick || moment()).clone();\n        me.lastTick = (me.lastTick || moment()).clone();\n    },\n    buildLabelDiffs: function() {\n        var me = this;\n        me.labelDiffs = [];\n        var scaleLabelDiffs = [];\n        // Parse common labels once\n        if (me.chart.data.datasets && me.chart.data.datasets.length > 0) {\n            helpers.each(me.chart.data.datasets, function(datasets, datasetIndex) {\n                var data = datasets.data;\n                var length = data.length;\n                for (var i = 0; i < length; i++) {\n                    // We consider 0 to have initial date\n                    var initialLabelMoment = me.parseTime(data[i][0]);\n                    // we consider 1 to have end date\n                    // TODO maybe add a check to see which one is bigger, but right now i don't know the\n                    // TODO implications off that check\n                    var finalLabelMoment = me.parseTime(data[i][1]);\n                    var diff;\n                    if (initialLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                        }\n                        else {\n                            if (me.isInTicks(initialLabelMoment, me.tickUnit))\n                            // No floor needed since we are one of the ticks\n                                diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                            else\n                                diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, true);\n                        }\n                        scaleLabelDiffs.push(diff);\n                    }\n                    if (finalLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            // Moment doesn't round on diff anymore\n                            diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                        }\n                        else\n                        {\n                            if (me.isInTicks(finalLabelMoment, me.tickUnit))\n                            // No floor needed since we are one of the ticks\n                                diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                            else\n                                diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, true);\n                        }\n                        scaleLabelDiffs.push(diff);\n                    }\n                }\n                me.labelDiffs[datasetIndex] = scaleLabelDiffs;\n                scaleLabelDiffs = [];\n            }, me);\n        }\n\n\n    },\n\n    // This function is different from parent because the second argument of the index inside the array of dates\n    // e.g [initialDate, endDate]. Since we built the diffs in date order, which means that every 2 entries in\n    // me.labelDiffs represent one set of date with initial and end dates by order.\n    getLabelDiff: function (datasetIndex, dateIndex) {\n        var me = this;\n        if (datasetIndex === null || dateIndex === null)\n            return null;\n\n        if (me.labelDiffs === undefined)\n            me.buildLabelDiffs();\n\n        if (me.labelDiffs[datasetIndex] != undefined)\n            return me.labelDiffs[datasetIndex][dateIndex];\n\n        return null;\n    },\n\n    getPixelForValue: function(value, index, datasetIndex) {\n        var me = this;\n        var offset = null;\n        if (index !== undefined && datasetIndex !== undefined) {\n            offset = me.getLabelDiff(datasetIndex, index);\n        }\n\n        if (offset === null) {\n            if (!value || !value.isValid) {\n                // not already a moment object\n                value = me.parseTime(me.getRightValue(value));\n            }\n            if (value && value.isValid && value.isValid()) {\n                offset = value.diff(me.firstTick, me.tickUnit, false);\n            }\n        }\n\n        if (offset !== null) {\n            var decimal = offset !== 0 ? offset / me.scaleSizeInUnits : offset;\n\n            if (me.isHorizontal()) {\n                var valueOffset = (me.width * decimal);\n                return me.left + Math.round(valueOffset);\n            }\n\n            var heightOffset = (me.height * decimal);\n            return me.top + Math.round(heightOffset);\n        }\n    },\n\n    // Checks if some date object is a tickMoment\n    isInTicks: function (date, unit) {\n        var result = false;\n        var length = this.tickMoments.length;\n        var ticks = this.tickMoments;\n        for(var i = 0; i < length; i++)\n        {\n            var tick = ticks[i];\n            if (date.isSame(tick, unit))\n            {\n                result = true;\n                break;\n            }\n        }\n        return result;\n    }\n});\n\n\nChart.scaleService.registerScaleType('myTime', myTimeScale, myConfig);\n\n\n\nChart.controllers.timeLine = Chart.controllers.bar.extend({\n\n    getBarBounds : function (bar) {\n        var vm =   bar._view;\n        var x1, x2, y1, y2;\n\n        x1 = vm.x;\n        x2 = vm.x + vm.width;\n        y1 = vm.y;\n        y2 = vm.y + vm.height;\n\n        return {\n            left : x1,\n            top: y1,\n            right: x2,\n            bottom: y2\n        };\n\n    },\n\n    update: function(reset) {\n        var me = this;\n        var meta = me.getMeta();\n        helpers.each(meta.data, function(rectangle, index) {\n            me.updateElement(rectangle, index, reset);\n        }, me);\n    },\n\n    updateElement: function(rectangle, index, reset) {\n        var me = this;\n        var meta = me.getMeta();\n        var xScale = me.getScaleForId(meta.xAxisID);\n        var yScale = me.getScaleForId(meta.yAxisID);\n        var dataset = me.getDataset();\n        var data = dataset.data[index];\n        var custom = rectangle.custom || {};\n        var datasetIndex = me.index;\n        var rectangleElementOptions = me.chart.options.elements.rectangle;\n\n        rectangle._xScale = xScale;\n        rectangle._yScale = yScale;\n        rectangle._datasetIndex = me.index;\n        rectangle._index = index;\n\n        var ruler = me.getRuler(index);\n\n        if (index !== 0)\n            index = index * 2;\n\n        var x = xScale.getPixelForValue(data, index , datasetIndex);\n        index++;\n        var end = xScale.getPixelForValue(data, index, datasetIndex);\n\n        var y = yScale.getPixelForValue(data, datasetIndex, datasetIndex);\n        var width = end - x;\n        var height = me.calculateBarHeight(ruler);\n        var color = me.chart.options.colorFunction(data);\n\n        // This one has in account the size of the tick and the height of the bar, so we just\n        // divide both of them by two and subtract the height part and add the tick part\n        // to the real position of the element y. The purpose here is to place the bar\n        // in the middle of the tick.\n        var boxY = y + (ruler.tickHeight / 2) - (height / 2);\n\n        // console.log(me.chart.data.labels[index] + ' box x ' + index + ' : ' + x);\n        // console.log(me.chart.data.labels[index] + ' box y ' + index + ' : ' + boxY);\n        rectangle._model = {\n            x: reset ?  x - width : x,   // Top left of rectangle\n            y: boxY , // Top left of rectangle\n            width: width,\n            height: height,\n            base: x + width,\n            backgroundColor: color,\n            borderSkipped: custom.borderSkipped ? custom.borderSkipped : rectangleElementOptions.borderSkipped,\n            borderColor: custom.borderColor ? custom.borderColor : helpers.getValueAtIndexOrDefault(dataset.borderColor, index, rectangleElementOptions.borderColor),\n            borderWidth: custom.borderWidth ? custom.borderWidth : helpers.getValueAtIndexOrDefault(dataset.borderWidth, index, rectangleElementOptions.borderWidth),\n            // Tooltip\n            label: me.chart.data.labels[index],\n            datasetLabel: dataset.label\n        };\n\n\n\n        rectangle.draw = function() {\n            var ctx = this._chart.ctx;\n            var vm = this._view;\n            ctx.fillStyle = vm.backgroundColor;\n            ctx.lineWidth = vm.borderWidth;\n            helpers.drawRoundedRectangle(ctx, vm.x, vm.y, vm.width, vm.height, 1);\n            ctx.fill();\n        };\n\n        rectangle.inXRange = function (mouseX) {\n            var bounds = me.getBarBounds(this);\n            return mouseX >= bounds.left && mouseX <= bounds.right;\n        };\n        rectangle.tooltipPosition = function () {\n            var vm = this.getCenterPoint();\n            return {\n                x: vm.x ,\n                y: vm.y\n            };\n        };\n\n        rectangle.getCenterPoint = function () {\n            var vm = this._view;\n            var x, y;\n            x = vm.x + (vm.width / 2);\n            y = vm.y + (vm.height / 2);\n\n            return {\n                x : x,\n                y : y\n            };\n        };\n\n        rectangle.inRange = function (mouseX, mouseY) {\n            var inRange = false;\n\n            if(this._view)\n            {\n                var bounds = me.getBarBounds(this);\n                inRange = mouseX >= bounds.left && mouseX <= bounds.right &&\n                    mouseY >= bounds.top && mouseY <= bounds.bottom;\n            }\n            return inRange;\n        };\n\n        rectangle.pivot();\n    },\n\n    // From controller.bar\n    getRuler: function(index) {\n        var me = this;\n        var meta = me.getMeta();\n        var yScale = me.getScaleForId(meta.yAxisID);\n        var datasetCount = me.getBarCount();\n\n        var tickHeight;\n        if (yScale.options.type === 'category') {\n            tickHeight = yScale.getPixelForTick(index + 1) - yScale.getPixelForTick(index);\n        } else {\n            // Average width\n            tickHeight = yScale.width / yScale.ticks.length;\n        }\n        var categoryHeight = tickHeight * yScale.options.categoryPercentage;\n        var categorySpacing = (tickHeight - (tickHeight * yScale.options.categoryPercentage)) / 2;\n        var fullBarHeight = categoryHeight / datasetCount;\n\n        if (yScale.ticks.length !== me.chart.data.labels.length) {\n            var perc = yScale.ticks.length / me.chart.data.labels.length;\n            fullBarHeight = fullBarHeight * perc;\n        }\n\n        var barHeight = fullBarHeight * yScale.options.barPercentage;\n        var barSpacing = fullBarHeight - (fullBarHeight * yScale.options.barPercentage);\n\n        return {\n            datasetCount: datasetCount,\n            tickHeight: tickHeight,\n            categoryHeight: categoryHeight,\n            categorySpacing: categorySpacing,\n            fullBarHeight: fullBarHeight,\n            barHeight: barHeight,\n            barSpacing: barSpacing\n        };\n    },\n\n    // From controller.bar\n    getBarCount: function() {\n        var me = this;\n        var barCount = 0;\n        helpers.each(me.chart.data.datasets, function(dataset, datasetIndex) {\n            var meta = me.chart.getDatasetMeta(datasetIndex);\n            if (meta.bar && me.chart.isDatasetVisible(datasetIndex)) {\n                ++barCount;\n            }\n        }, me);\n        return barCount;\n    },\n\n\n    // draw\n    draw: function (ease) {\n        var easingDecimal = ease || 1;\n        var i, len;\n        var metaData = this.getMeta().data;\n        for (i = 0, len = metaData.length; i < len; i++)\n        {\n            metaData[i].transition(easingDecimal).draw();\n        }\n    },\n\n    // From controller.bar\n    calculateBarHeight: function(ruler) {\n        var me = this;\n        var yScale = me.getScaleForId(me.getMeta().yAxisID);\n        if (yScale.options.barThickness) {\n            return yScale.options.barThickness;\n        }\n        return yScale.options.stacked ? ruler.categoryHeight : ruler.barHeight;\n    },\n\n    removeHoverStyle: function(e) {\n        // TODO\n    },\n\n    setHoverStyle: function(e) {\n        // TODO: Implement this\n    }\n\n});\n\n\nChart.defaults.timeLine = {\n\n    colorFunction: function() {\n        return 'black';\n    },\n\n    layout: {\n        padding: {\n            left: 5,\n            right: 5,\n            top: 0\n        }\n    },\n\n    legend: {\n        display: false\n    },\n\n    scales: {\n        xAxes: [{\n            type: 'myTime',\n            position: 'bottom',\n            gridLines: {\n                display: true,\n                offsetGridLines: true,\n                drawBorder: true,\n                drawTicks: true\n            },\n            ticks: {\n                maxRotation: 0\n            },\n            unit: 'day'\n        }],\n        yAxes: [{\n            type: 'category',\n            position: 'left',\n            barThickness : 20,\n            gridLines: {\n                display: true,\n                offsetGridLines: true,\n                drawBorder: true,\n                drawTicks: true\n            }\n        }]\n    },\n    tooltips: {\n        mode: 'single',\n        callbacks: {\n            title: function(tooltipItems, data) {\n                return data.labels[tooltipItems[0].datasetIndex];\n            },\n            label: function(tooltipItem, data) {\n                \n                return [\"Started: \" + moment(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][0]).fromNow(),\n                    \"Duration: \" + moment(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][1]).from(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][0], true)\n                    ]\n            }\n        }\n    }\n};\n\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":930,"y":1160,"wires":[[]]},{"id":"517bbfcf.e5611","type":"change","z":"14d67294.62b07d","name":"WiFi-Uptime","rules":[{"t":"change","p":"payload","pt":"msg","from":"ready","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"lost","fromt":"str","to":"false","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"idle","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"WiFi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1420,"wires":[["2d3f116c.e990fe"]]},{"id":"e1a03ca3.80ec4","type":"inject","z":"14d67294.62b07d","name":"Redraw","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":1320,"wires":[["2d3f116c.e990fe"]]},{"id":"c801faf1.ec4198","type":"change","z":"14d67294.62b07d","name":"MCU-Startup","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"Startingup","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1460,"wires":[["2d3f116c.e990fe","6c35b99a.760fa8","d13df2f9.2d82b","f517877c.e49be8","9a881e3b.bbd39","2bb8ccf1.f7c144","831d7a65.ab6b38"]]},{"id":"1eeee66f.7f7aca","type":"ui_text","z":"14d67294.62b07d","group":"29ab3c3d.3e3274","order":4,"width":"0","height":"0","name":"WiFi","label":"WiFi status","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":820,"wires":[]},{"id":"29bd05ff.7b271a","type":"ui_text","z":"14d67294.62b07d","group":"b0dd753a.18a218","order":7,"width":0,"height":0,"name":"","label":"Daytime","format":"{{msg.payload}}","layout":"row-spread","x":280,"y":1280,"wires":[]},{"id":"63c052a9.c394dc","type":"debug","z":"14d67294.62b07d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":1240,"wires":[]},{"id":"24d9fcde.244354","type":"ui_text","z":"14d67294.62b07d","group":"29ab3c3d.3e3274","order":3,"width":0,"height":0,"name":"Laststartup","label":"Last startup","format":"{{msg.payload.Datetime}}","layout":"row-spread","x":850,"y":1420,"wires":[]},{"id":"5add2a3c.2e7264","type":"inject","z":"14d67294.62b07d","name":"Timestamp","topic":"Datetime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1460,"wires":[["fe39f5a9.c4c9a8"]]},{"id":"d78b9953.4755a8","type":"join","z":"14d67294.62b07d","name":"Join","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":290,"y":1500,"wires":[["9713ec34.f31f9"]]},{"id":"9713ec34.f31f9","type":"switch","z":"14d67294.62b07d","name":"Is Startup?","property":"payload.cyper/ESPloader01/mcu/startingup","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":1500,"wires":[["24d9fcde.244354","b88e9460.9ba268"]]},{"id":"7a740276.5e3aec","type":"change","z":"14d67294.62b07d","name":"Screensaver","rules":[{"t":"set","p":"topic","pt":"msg","to":"Screensaver","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1260,"wires":[["2d3f116c.e990fe"]]},{"id":"60d56d1c.051674","type":"change","z":"14d67294.62b07d","name":"Heartbeat","rules":[{"t":"change","p":"payload.color","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload.color","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"Heartbeat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1580,"wires":[["72d431b6.5690d"]]},{"id":"59482488.79451c","type":"change","z":"14d67294.62b07d","name":"chg","rules":[{"t":"change","p":"payload","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1540,"wires":[[]]},{"id":"f178f391.d9d4b","type":"switch","z":"14d67294.62b07d","name":"UpPing","property":"payload.cyper/ESPl12S006/mcu/uptime","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":1540,"wires":[["60d56d1c.051674"]]},{"id":"72d431b6.5690d","type":"change","z":"14d67294.62b07d","name":"Swap2Bool","rules":[{"t":"change","p":"payload","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":1580,"wires":[["2d3f116c.e990fe"]]},{"id":"9874ea38.185ec8","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":9,"width":0,"height":0,"name":"IP","label":"Local IP","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":660,"wires":[]},{"id":"1af815e1.967e0a","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":10,"width":0,"height":0,"name":"Mac","label":"MAC","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":700,"wires":[]},{"id":"d88cb1e.fb6245","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":7,"width":0,"height":0,"name":"Name","label":"Name","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":740,"wires":[]},{"id":"fcdc13d7.5cb11","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":12,"width":0,"height":0,"name":"HomieStd","label":"MQTT Standard","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":780,"wires":[]},{"id":"e973c630.655908","type":"e-mail","z":"14d67294.62b07d","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"mhannah@cypernet.com","dname":"MH-gmail","x":2020,"y":780,"wires":[]},{"id":"d837859b.587d98","type":"sum-bars","z":"14d67294.62b07d","name":"sum-bars","title":"Sum: Water temperature - Lower","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showSumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":1,"x":1460,"y":140,"wires":[["9b0ec843.1401c8"]]},{"id":"626e98a6.f31898","type":"average-bars","z":"14d67294.62b07d","name":"average-bars","title":"Average: Water temperature - Mid tank","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":1,"x":1470,"y":200,"wires":[["e8c3e223.5ed8c"]]},{"id":"9b0ec843.1401c8","type":"ui_template","z":"14d67294.62b07d","group":"824f9551.65cc68","name":"TankTemp-Lower","order":6,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1650,"y":140,"wires":[[]]},{"id":"e8c3e223.5ed8c","type":"ui_template","z":"14d67294.62b07d","group":"824f9551.65cc68","name":"TankTemp-Mid1","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":200,"wires":[[]]},{"id":"282846b8.a281ca","type":"average-bars","z":"14d67294.62b07d","name":"average-bars","title":"Average: Water temperature - Mid tank2","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Equalizer","decimal":1,"x":1470,"y":240,"wires":[["1f766dc0.1bdc32"]]},{"id":"1f766dc0.1bdc32","type":"ui_template","z":"14d67294.62b07d","group":"824f9551.65cc68","name":"TankTemp-Mid2","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":240,"wires":[[]]},{"id":"95536944.856058","type":"comment","z":"14d67294.62b07d","name":"Analytics","info":"","x":1460,"y":20,"wires":[]},{"id":"3a8def62.16cf6","type":"ui_text","z":"14d67294.62b07d","group":"7875f04e.ab78","order":8,"width":0,"height":0,"name":"MCU","label":"MCU","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":460,"wires":[]},{"id":"8f502a41.8ea6d8","type":"ui_template","z":"14d67294.62b07d","group":"1089106f.c6bd3","name":"TankTemp-Mid2","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":300,"wires":[[]]},{"id":"d981b4d8.ded4a8","type":"ui_gauge","z":"14d67294.62b07d","name":"","group":"e1404fdd.3fd75","order":2,"width":0,"height":0,"gtype":"wave","title":"Fish tank","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":620,"y":660,"wires":[]},{"id":"4309222c.6e26ac","type":"ui_text","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":5,"width":0,"height":0,"name":"Rainresidual1","label":"RainResidual1","format":"{{msg.payload}}","layout":"row-spread","x":860,"y":380,"wires":[]},{"id":"f39c6ad2.35c678","type":"ui_text","z":"14d67294.62b07d","group":"1089106f.c6bd3","order":6,"width":0,"height":0,"name":"Rainresidual2","label":"RainResidual2","format":"{{msg.payload}}","layout":"row-spread","x":860,"y":420,"wires":[]},{"id":"e83ed8b1.6f5198","type":"twitter out","z":"14d67294.62b07d","twitter":"","name":"Tweet","x":2010,"y":740,"wires":[]},{"id":"f4e73fde.96196","type":"queue","z":"14d67294.62b07d","name":"","connected":"^connected","connectedType":"re","disconnected":"","disconnectedType":"str","sqlite":"queue00.sqlite","x":2010,"y":560,"wires":[["3d89aab.5a88b56","c1777da6.95167"]]},{"id":"8803092a.2dbd18","type":"status","z":"14d67294.62b07d","name":"","scope":["3d89aab.5a88b56"],"x":1860,"y":560,"wires":[["f4e73fde.96196"]]},{"id":"7a28a00e.1f28b","type":"delay","z":"14d67294.62b07d","name":"process","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2020,"y":480,"wires":[["52034740.ff2b88","f4e73fde.96196"]]},{"id":"52034740.ff2b88","type":"function","z":"14d67294.62b07d","name":"get next","func":"node.send({topic: \"control\", payload: \"drop\"})\nmsg.topic = \"control\"\nmsg.payload = \"peek\"\nreturn msg;","outputs":1,"noerr":0,"x":2180,"y":480,"wires":[["8a96654.a4ab098"]]},{"id":"8e89374d.b6fec8","type":"link in","z":"14d67294.62b07d","name":"","links":["8a96654.a4ab098"],"x":2055,"y":440,"wires":[["8466cb30.98c028"]]},{"id":"8466cb30.98c028","type":"q-gate","z":"14d67294.62b07d","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":1850,"y":420,"wires":[["7a28a00e.1f28b"]]},{"id":"8a96654.a4ab098","type":"link out","z":"14d67294.62b07d","name":"","links":["8e89374d.b6fec8"],"x":1975,"y":440,"wires":[]},{"id":"7457f18.0de2a1","type":"status","z":"14d67294.62b07d","name":"","scope":null,"x":1040,"y":860,"wires":[[]]},{"id":"decf23a2.67ab","type":"ui_switch","z":"14d67294.62b07d","name":"","label":"Enable Dimmer","tooltip":"","group":"4fed397c.f84f18","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"oledDisplay/dim/set","style":"","onvalue":"50","onvalueType":"str","onicon":"","oncolor":"","offvalue":"false","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":180,"wires":[["d5e4b768.b1ad38","24458328.6f670c"]]},{"id":"bf686cce.0550a","type":"function","z":"14d67294.62b07d","name":"","func":"\nif(typeof(msg.payload) === \"boolean\"){\n    if (msg.payload === true){\n        msg.payload = false;\n    }\n    else {\n        //msg.payload = true;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":100,"wires":[[]]},{"id":"d5e4b768.b1ad38","type":"ui_slider","z":"14d67294.62b07d","name":"LCD Dim level","label":"Dimmer","tooltip":"LCD automatic dimmer level","group":"4fed397c.f84f18","order":4,"width":0,"height":0,"passthru":true,"outs":"end","topic":"oledDisplay/dim/set","min":"25","max":"75","step":"25","x":1260,"y":220,"wires":[["24458328.6f670c"]]},{"id":"862199d9.d4cc78","type":"ui_dropdown","z":"14d67294.62b07d","name":"Screensaver delay","label":"Delay","tooltip":"Screen saver delay","place":"Select option","group":"4fed397c.f84f18","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"2 Seconds","value":"2","type":"str"},{"label":"10 seconds","value":10,"type":"num"},{"label":"120 seconds","value":120,"type":"num"},{"label":"5 minutes","value":"300","type":"str"},{"label":"20 minutes","value":"1200","type":"str"},{"label":"1 hour","value":"3600","type":"str"}],"payload":"","topic":"oledDisplay/screensaverdelay/set","x":1270,"y":140,"wires":[["24458328.6f670c"]]},{"id":"d7d45708.4acc98","type":"function","z":"14d67294.62b07d","name":"EmailContent","func":"var Devicepath = flow.get(\"Devicepath\");\nmsg = {\n    payload: \"The email body here at Date: \" + Date().toString() + \", my explanation e.g. water level now at  \" + msg.payload + \"%\",\n    topic: \"RESTARTING: The email subject line - Devicepath: \" + Devicepath,\n    to: \"producteval@cypernet.com\",\n    cc: \"producteval@cypernet.com\",\n    bcc: \"\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":880,"wires":[["7e698bf7.efa1a4"]]},{"id":"5b738c15.b16084","type":"inject","z":"14d67294.62b07d","name":"TestEmail","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1700,"y":920,"wires":[["d7d45708.4acc98"]]},{"id":"dead40a4.370eb","type":"gate","z":"14d67294.62b07d","name":"MQTTGate","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","persist":false,"x":1870,"y":480,"wires":[["8466cb30.98c028"]]},{"id":"7e698bf7.efa1a4","type":"e-mail","z":"14d67294.62b07d","server":"mail.cypernet.com","port":"25","secure":false,"tls":false,"name":"","dname":"MH","x":2010,"y":880,"wires":[]},{"id":"6c35b99a.760fa8","type":"change","z":"14d67294.62b07d","name":"EnableGate","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"close","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"open","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"close","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"open","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":1120,"wires":[["dead40a4.370eb"]]},{"id":"c1777da6.95167","type":"debug","z":"14d67294.62b07d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2170,"y":640,"wires":[]},{"id":"d13df2f9.2d82b","type":"trigger","z":"14d67294.62b07d","op1":"false","op2":"0","op1type":"bool","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","name":"Set low","x":1040,"y":100,"wires":[["2cbc044.37ac5fc"]]},{"id":"394f8c52.d0c6a4","type":"comment","z":"14d67294.62b07d","name":"Disable Commands till after Startup","info":"","x":1940,"y":520,"wires":[]},{"id":"7234f735.1bc658","type":"function","z":"14d67294.62b07d","name":"Light","func":"var topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n}","outputs":4,"noerr":0,"x":110,"y":960,"wires":[["3a9005e9.024a5a"],["86b83b84.2f5ca8","69b95d9a.5ecf24"],[],[]]},{"id":"f517877c.e49be8","type":"function","z":"14d67294.62b07d","name":"ui-disable","func":"if (typeof(msg.payload) === \"boolean\"){\n    msg.enabled = !msg.payload;\n   // if (msg.payload === true){\n    //    msg.payload.enable = false;\n   // }\n    //else {\n    //    msg.enabled = true;\n    //}\n}\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":940,"wires":[["d5e4b768.b1ad38","252c3823.92faf8","bac6c833.c06d18","ef4ed36f.ed20a","f8162d5b.4423c","60f8f2ef.df159c","e22420f5.b3423","decf23a2.67ab","862199d9.d4cc78","9a881e3b.bbd39","729e2e1f.df554","2d74ced8.deb2e2","33ecd3c0.6170ec","31a6b2dd.67550e","250ed274.94314e","fb97d1de.83de8","c12b7a3f.a30248","d9fb17c6.b54778","8c0b1411.e9b808","93edf209.4f8b8","8f833921.3c1e98","aeec0165.569cb","36664435.916d6c","3c598a3b.30ec36","3ab81750.e0f298","2793ee43.bd4cb2","7ffbcee2.eb3d7","6440ccf3.723624","adadc1dd.4fd77","a36394d5.7a96a8","3651b2b4.65e67e","26028716.90f968","943fad09.44e16","93946243.be8e6","da612fbb.bb64d","8714339e.3ba12","4f52a224.ffce8c","12da09b6.271e66","ceb3ca3.ba88a38","beb65b41.500c38"]]},{"id":"9a881e3b.bbd39","type":"debug","z":"14d67294.62b07d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1200,"y":1000,"wires":[]},{"id":"3651b2b4.65e67e","type":"ui_numeric","z":"14d67294.62b07d","name":"Period_Sched1","label":"cycles every","tooltip":"Scheduler starts every","group":"22be3ee7.9ef6a2","order":2,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule01/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":580,"wires":[["5c203918.02f408"]]},{"id":"26028716.90f968","type":"ui_dropdown","z":"14d67294.62b07d","name":"Slice1","label":":","tooltip":"","place":"Select option","group":"22be3ee7.9ef6a2","order":15,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule01/timeslice/set","x":1710,"y":580,"wires":[["5c203918.02f408"]]},{"id":"943fad09.44e16","type":"ui_numeric","z":"14d67294.62b07d","name":"Period_Sched2","label":"cycles every","tooltip":"Scheduler starts every","group":"22be3ee7.9ef6a2","order":4,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule02/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":620,"wires":[["5c203918.02f408"]]},{"id":"93946243.be8e6","type":"ui_dropdown","z":"14d67294.62b07d","name":"Slice2","label":":","tooltip":"","place":"Select option","group":"22be3ee7.9ef6a2","order":5,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule02/timeslice/set","x":1710,"y":620,"wires":[["5c203918.02f408"]]},{"id":"da612fbb.bb64d","type":"ui_dropdown","z":"14d67294.62b07d","name":"Slice3","label":":","tooltip":"","place":"Select option","group":"22be3ee7.9ef6a2","order":8,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule03/timeslice/set","x":1710,"y":660,"wires":[["5c203918.02f408"]]},{"id":"8714339e.3ba12","type":"ui_dropdown","z":"14d67294.62b07d","name":"Slice4","label":":","tooltip":"","place":"Select option","group":"22be3ee7.9ef6a2","order":11,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule04/timeslice/set","x":1710,"y":700,"wires":[["5c203918.02f408"]]},{"id":"4f52a224.ffce8c","type":"ui_dropdown","z":"14d67294.62b07d","name":"Slice5","label":":","tooltip":"","place":"Select option","group":"22be3ee7.9ef6a2","order":14,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule05/timeslice/set","x":1710,"y":740,"wires":[["5c203918.02f408"]]},{"id":"12da09b6.271e66","type":"ui_numeric","z":"14d67294.62b07d","name":"Period_Sched3","label":"cycles every","tooltip":"Scheduler starts every","group":"22be3ee7.9ef6a2","order":7,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule03/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":660,"wires":[["5c203918.02f408"]]},{"id":"ceb3ca3.ba88a38","type":"ui_numeric","z":"14d67294.62b07d","name":"Period_Sched4","label":"cycles every","tooltip":"Scheduler starts every","group":"22be3ee7.9ef6a2","order":10,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule04/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":700,"wires":[["5c203918.02f408"]]},{"id":"beb65b41.500c38","type":"ui_numeric","z":"14d67294.62b07d","name":"Period_Sched5","label":"cycles every","tooltip":"Scheduler starts every","group":"22be3ee7.9ef6a2","order":13,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule05/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":740,"wires":[["5c203918.02f408"]]},{"id":"7753958a.a6033c","type":"function","z":"14d67294.62b07d","name":"Schedules","func":"var topic=msg.topic;\nif (topic==\"mcu/taskschedule01/period\") {\nreturn [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02/period\") {\nreturn [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule03/period\") {\nreturn [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule04/period\") {\nreturn [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule05/period\") {\nreturn [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule01/timeslice\") {\nreturn [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02/timeslice\") {\nreturn [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"mcu/taskschedule03/timeslice\") {\nreturn [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"mcu/taskschedule04/timeslice\") {\nreturn [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/taskschedule05/timeslice\") {\nreturn [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":630,"y":780,"wires":[["3651b2b4.65e67e"],["943fad09.44e16"],["12da09b6.271e66"],["ceb3ca3.ba88a38"],["beb65b41.500c38"],["26028716.90f968"],["93946243.be8e6"],["da612fbb.bb64d"],["8714339e.3ba12"],["4f52a224.ffce8c"]]},{"id":"13d9dbb5.650944","type":"ui_text","z":"14d67294.62b07d","group":"486ddb3.897c124","order":16,"width":"11","height":"1","name":"Note 1)","label":"1)","format":"Default settings are those most suited to this MCUs speed and available flash memory","layout":"row-left","x":1700,"y":520,"wires":[]},{"id":"69e2c21b.6799fc","type":"ui_text","z":"14d67294.62b07d","group":"486ddb3.897c124","order":16,"width":"11","height":"1","name":"Note 2)","label":"2)","format":"This ESP8266 MCU is a single threaded device, when adding additional task schedulers ensure tasks in a scheduler wil complete before the end of each cycle to ensure schedules dont overlap.","layout":"row-left","x":1700,"y":540,"wires":[]},{"id":"ddd3d94f.f427e8","type":"ui_text","z":"14d67294.62b07d","group":"486ddb3.897c124","order":16,"width":"11","height":"1","name":"Note 3)","label":"3)","format":"After restart or updating NodeRed the MCU will take a few minutes to refresh with current operational settings.","layout":"row-left","x":1700,"y":560,"wires":[]},{"id":"6c8a766.ed03888","type":"ui_chart","z":"14d67294.62b07d","name":"Illuminance","group":"db9c7eba.cf4df","order":2,"width":0,"height":0,"label":"Illuminance","chartType":"polar-area","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":590,"y":980,"wires":[[],[]]},{"id":"41abb536.1fa16c","type":"ui_chart","z":"14d67294.62b07d","name":"AmbientLight","group":"db9c7eba.cf4df","order":1,"width":0,"height":0,"label":"Ambient light","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":590,"y":940,"wires":[[]]},{"id":"86b83b84.2f5ca8","type":"delay","z":"14d67294.62b07d","name":"Diz","pauseType":"random","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"100","randomLast":"1200","randomUnits":"milliseconds","drop":false,"x":150,"y":1060,"wires":[["5143412d.50152"]]},{"id":"5143412d.50152","type":"change","z":"14d67294.62b07d","name":"Diz","rules":[{"t":"set","p":"topic","pt":"msg","to":"Dizolvation","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":980,"wires":[["6c8a766.ed03888","9fcd4e90.ccf25"]]},{"id":"9fcd4e90.ccf25","type":"ui_chart","z":"14d67294.62b07d","name":"Comparison","group":"db9c7eba.cf4df","order":2,"width":0,"height":0,"label":"Comparison","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":590,"y":1020,"wires":[[],[]]},{"id":"3a9005e9.024a5a","type":"change","z":"14d67294.62b07d","name":"A","rules":[{"t":"change","p":"topic","pt":"msg","from":"cyper/ESPloader01/light/ambientlight","fromt":"str","to":"Ambient","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":940,"wires":[["9fcd4e90.ccf25","41abb536.1fa16c","6c8a766.ed03888"]]},{"id":"69b95d9a.5ecf24","type":"change","z":"14d67294.62b07d","name":"Illum","rules":[{"t":"change","p":"topic","pt":"msg","from":"cyper/ESPloader01/light/illuminance","fromt":"str","to":"Illuminance","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1020,"wires":[["6c8a766.ed03888","9fcd4e90.ccf25"]]},{"id":"2bb8ccf1.f7c144","type":"trigger","z":"14d67294.62b07d","op1":"true","op2":"true","op1type":"bool","op2type":"bool","duration":"0","extend":false,"units":"ms","reset":"false","bytopic":"all","name":"Notify","x":1690,"y":880,"wires":[["d7d45708.4acc98","831d7a65.ab6b38","f4024704.d6d2c8"]]},{"id":"401b8804.f45538","type":"ui_template","z":"14d67294.62b07d","group":"3b0c5bc8.f22294","name":"Processes","order":6,"width":"24","height":"4","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1630,"y":340,"wires":[[]]},{"id":"50eec877.4a83b8","type":"sum-bars","z":"14d67294.62b07d","name":"sum-bars","title":"Activity by process","period":"topic","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showSumValue":true,"maxBar":30,"topColor":"#ffea05","bottomColor":"#0008ff","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":"0","x":1460,"y":340,"wires":[["401b8804.f45538"]]},{"id":"8dfe973a.89bfa8","type":"change","z":"14d67294.62b07d","name":"MoveTopics","rules":[{"t":"move","p":"payload","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1140,"wires":[["50eec877.4a83b8"]]},{"id":"923d7c9e.c85d7","type":"split","z":"14d67294.62b07d","name":"splitExeclog","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":290,"y":1140,"wires":[["8dfe973a.89bfa8"]]},{"id":"ef7c01e1.904f","type":"function","z":"14d67294.62b07d","name":"Misc","func":"var topic=msg.topic;\nif (topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n        msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n        //msg.payload = msg.payload.replace(\",\",'\\n');\n        msg.payload = msg.payload.replace(\"zzStart,\",'');\n        msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n        msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n        msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n        msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n        msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n        msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n        msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n        msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n        msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n        msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n        msg.payload = msg.payload.replace(\"BME\",'BMP280');\n        msg.payload = msg.payload.replace(/read/g,'');\nreturn [msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":110,"y":1180,"wires":[["923d7c9e.c85d7","83514daf.70ec9","e60445d4.dd1538"],[],[],[],["95f8243e.ad0418"],["3122ab25.964224"],["cc65a010.fd658"],[]]},{"id":"66f05237.fb334c","type":"ui_template","z":"14d67294.62b07d","group":"3b0c5bc8.f22294","name":"AveProcesses","order":6,"width":"24","height":"4","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":380,"wires":[[]]},{"id":"32db2b77.7b9dc4","type":"average-bars","z":"14d67294.62b07d","name":"average-bars","title":"","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":"12","topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":"0","x":1470,"y":380,"wires":[["66f05237.fb334c"]]},{"id":"83514daf.70ec9","type":"function","z":"14d67294.62b07d","name":"Qty","func":"var count = msg.payload.length;\nmsg.topic = \"TaskCount\";\nmsg.payload = count;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1180,"wires":[["32db2b77.7b9dc4","e60445d4.dd1538"]]},{"id":"831d7a65.ab6b38","type":"debug","z":"14d67294.62b07d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1870,"y":980,"wires":[]},{"id":"b710316f.00fd1","type":"ui_chart","z":"14d67294.62b07d","name":"Water temp","group":"824f9551.65cc68","order":3,"width":"24","height":"4","label":"Tank temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"7","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1470,"y":420,"wires":[[],[]]},{"id":"d0581dc8.da41b","type":"ui_chart","z":"14d67294.62b07d","name":"Restarts","group":"3b0c5bc8.f22294","order":3,"width":"24","height":"4","label":"Restarts","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"No restarts recorded at this time","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1460,"y":460,"wires":[[],[]]},{"id":"c4515b46.6e3788","type":"change","z":"14d67294.62b07d","name":"AddResetCount","rules":[{"t":"set","p":"restart_count","pt":"flow","to":"$flowContext(\"restart_count\")+1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1860,"y":820,"wires":[[]]},{"id":"d4888181.2f11f","type":"inject","z":"14d67294.62b07d","name":"15Min","topic":"Timeslot","payload":"","payloadType":"date","repeat":"900","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":1100,"wires":[["3df36c5b.178a14"]]},{"id":"3df36c5b.178a14","type":"change","z":"14d67294.62b07d","name":"SendCount","rules":[{"t":"set","p":"payload","pt":"msg","to":"restart_count","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1100,"wires":[["5bbfdd66.2cc834","d0581dc8.da41b"]]},{"id":"5bbfdd66.2cc834","type":"change","z":"14d67294.62b07d","name":"ResetCount","rules":[{"t":"set","p":"restart_count","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":1100,"wires":[[]]},{"id":"3dad80b8.8457f","type":"inject","z":"14d67294.62b07d","name":"dd","topic":"dd","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1830,"y":1260,"wires":[["dfda6d73.b02cd","2bb8ccf1.f7c144"]]},{"id":"dfda6d73.b02cd","type":"trigger","z":"14d67294.62b07d","op1":"true","op2":"true","op1type":"bool","op2type":"bool","duration":"0","extend":false,"units":"ms","reset":"false","bytopic":"all","name":"Notify","x":1890,"y":1100,"wires":[[]]},{"id":"d3bfa263.bcbdb","type":"inject","z":"14d67294.62b07d","name":"dd","topic":"dd","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1830,"y":1320,"wires":[["dfda6d73.b02cd","9063534c.20f8e","2bb8ccf1.f7c144"]]},{"id":"e60445d4.dd1538","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1750,"y":1400,"wires":[]},{"id":"9063534c.20f8e","type":"change","z":"14d67294.62b07d","name":"SendCount","rules":[{"t":"set","p":"payload","pt":"msg","to":"restart_count","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2050,"y":1180,"wires":[[]]},{"id":"f4024704.d6d2c8","type":"switch","z":"14d67294.62b07d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1710,"y":820,"wires":[["c4515b46.6e3788"]]},{"id":"220b3a8d.b22e56","type":"comment","z":"14d67294.62b07d","name":"Camera","info":"","x":1990,"y":20,"wires":[]},{"id":"9f26a692.c03978","type":"ui_template","z":"14d67294.62b07d","group":"689cb110.b12b9","name":"Fish Cam-1","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8081\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2010,"y":140,"wires":[[]]},{"id":"1b97114e.5a10af","type":"ui_template","z":"14d67294.62b07d","group":"689cb110.b12b9","name":"Fish Cam-2","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8083\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2010,"y":200,"wires":[[]]},{"id":"5842213b.6fe74","type":"comment","z":"14d67294.62b07d","name":"Light","info":"","x":570,"y":900,"wires":[]},{"id":"44465549.33092c","type":"ui_chart","z":"14d67294.62b07d","name":"Hydraphone","group":"689cb110.b12b9","order":1,"width":0,"height":0,"label":"Hydraphonic activity","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":2010,"y":240,"wires":[[],[]]},{"id":"f3ca5bdf.a87918","type":"comment","z":"14d67294.62b07d","name":"cyper/ESP12S007#","info":"","x":270,"y":20,"wires":[]},{"id":"24458328.6f670c","type":"function","z":"14d67294.62b07d","name":"AddPath","func":"var Devicepath = flow.get(\"Devicepath\");\n//msg.devicepath = Devicepath;\nmsg.topic = Devicepath + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":1700,"y":420,"wires":[["8466cb30.98c028"]]},{"id":"5c203918.02f408","type":"function","z":"14d67294.62b07d","name":"AddPath","func":"var Devicepath = flow.get(\"Devicepath\");\n//msg.devicepath = Devicepath;\nmsg.topic = Devicepath + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":1700,"y":480,"wires":[["dead40a4.370eb"]]},{"id":"76f8581d.c4c3b8","type":"bar-chart-data","z":"14d67294.62b07d","name":"Smpl","x_interval":"minutes","x_size":24,"unit":"","precision":2,"is_meter_reading":"False","agg_by":"sum","x":1450,"y":300,"wires":[["8f502a41.8ea6d8"]]},{"id":"fe39f5a9.c4c9a8","type":"moment","z":"14d67294.62b07d","name":"Datetime","topic":"Datetime","input":"payload","format":"DD/MM/YYYY kk:mm:ss","locale":"au","output":"payload","x":120,"y":1500,"wires":[["d78b9953.4755a8"]]},{"id":"bad5f264.6d612","type":"comment","z":"2f5cab58.57de34","name":"Michael - DblClick here 4 Tips","info":"When going through these videos\n-------------------------------\n- Use a new Flow for each lesson/experiment\n- When start another lesson turn of Debug message \n  from prior lesson so you dont get confused\n- As I showed you , if you change the payload to see \n  entire message you see other variables that are available\n- A JSON object is really just a collection of values\n- You can add new values to this JSON object programatically\n- The best way to get started is to understand the Function\n  Node, its the key to many things\n- ","x":240,"y":120,"wires":[]},{"id":"2f5c64d8.31261c","type":"comment","z":"2f5cab58.57de34","name":"1st Lesson","info":"This is an INSERT node, when deployed it sends a payload to a Debug node to display in debug console \n(on your right-->)","x":160,"y":200,"wires":[]},{"id":"e365538.70dc3b","type":"debug","z":"2f5cab58.57de34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":520,"y":302,"wires":[]},{"id":"d98365a.d695d98","type":"comment","z":"2f5cab58.57de34","name":"Exercise","info":"Now change On/Off inject to send a number of String of characters","x":160,"y":440,"wires":[]},{"id":"40ef9487.42fcdc","type":"inject","z":"2f5cab58.57de34","name":"INTEGER","topic":"aa","payload":"123","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":480,"wires":[["35078af1.ab1576"]]},{"id":"35078af1.ab1576","type":"debug","z":"2f5cab58.57de34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":520,"wires":[]},{"id":"276c4ea5.e16802","type":"inject","z":"2f5cab58.57de34","name":"STRING","topic":"aa","payload":"Campos Coffee","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":560,"wires":[["35078af1.ab1576"]]},{"id":"215f7a67.480e96","type":"inject","z":"57e9e411.7eb0dc","name":"Temperature","topic":"Temperature","payload":"9","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":260,"wires":[["8e70b110.f89cd"]]},{"id":"8e70b110.f89cd","type":"function","z":"57e9e411.7eb0dc","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":260,"wires":[["938c98e8.0297f8"]]},{"id":"6e374b82.c37734","type":"debug","z":"57e9e411.7eb0dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":120,"wires":[]},{"id":"938c98e8.0297f8","type":"mui_gauge","z":"57e9e411.7eb0dc","name":"","group":"c4b578d0.dcd248","order":0,"width":0,"height":0,"gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"75","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":510,"y":240,"wires":[]},{"id":"a9355ca9.74ad","type":"http in","z":"57e9e411.7eb0dc","name":"","url":"/test1","method":"get","upload":false,"swaggerDoc":"","x":160,"y":360,"wires":[["20cb6fd.6b0a89"]]},{"id":"d50f5fdf.97fe6","type":"http response","z":"57e9e411.7eb0dc","name":"","statusCode":"","headers":{},"x":580,"y":380,"wires":[]},{"id":"20cb6fd.6b0a89","type":"template","z":"57e9e411.7eb0dc","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Hello World!","output":"str","x":340,"y":360,"wires":[["d50f5fdf.97fe6"]]},{"id":"32b71a9.4eba9e6","type":"ui_button","z":"11d09863.30e618","name":"","group":"5283946.d10f96c","order":1,"width":0,"height":0,"passthru":false,"label":"button","tooltip":"","color":"","bgcolor":"","icon":"","payload":"click!","payloadType":"str","topic":"","x":230,"y":220,"wires":[["30b914fb.238d0c"]]},{"id":"4eb8609f.f0965","type":"ui_text","z":"11d09863.30e618","group":"5283946.d10f96c","order":1,"width":0,"height":0,"name":"","label":"You Have Clicked:","format":"{{msg.count}}","layout":"row-spread","x":834,"y":365,"wires":[]},{"id":"30b914fb.238d0c","type":"function","z":"11d09863.30e618","name":"Count","func":"var count = context.get('count')||0;\ncount += 1;\n// store the value back\ncontext.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":220,"wires":[["4eb8609f.f0965","239df985.981656"]]},{"id":"9ed9b7c2.131f98","type":"ui_gauge","z":"76dfa12d.b4415","name":"","group":"67d89282.2684fc","order":3,"width":0,"height":0,"gtype":"gage","title":"Happy Meter","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":730,"y":340,"wires":[]},{"id":"9ef89661.91cbf8","type":"ui_numeric","z":"76dfa12d.b4415","name":"","label":"numeric","tooltip":"","group":"67d89282.2684fc","order":2,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":320,"y":360,"wires":[["9ed9b7c2.131f98"]]},{"id":"2abb8856.0a97f8","type":"ui_text","z":"76dfa12d.b4415","group":"67d89282.2684fc","order":2,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":240,"wires":[]},{"id":"187a3959.5a8047","type":"json","z":"16e59e64.eccb62","name":"","property":"payload","action":"obj","pretty":false,"x":430,"y":620,"wires":[["535590a3.3aa39","9a3a10d5.c2ae2","f63fbc91.7a89e","61b2ea99.046794"]]},{"id":"a1d2e126.84bfb","type":"ui_gauge","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"degrees celsius","format":"{{msg.temp}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":970,"y":520,"wires":[]},{"id":"a3c18c35.2e4fd","type":"http request","z":"16e59e64.eccb62","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=London&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":250,"y":640,"wires":[["187a3959.5a8047"]]},{"id":"535590a3.3aa39","type":"change","z":"16e59e64.eccb62","name":"","rules":[{"t":"set","p":"temp","pt":"msg","to":"msg.payload.main.temp","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":520,"wires":[["a1d2e126.84bfb"]]},{"id":"9a3a10d5.c2ae2","type":"change","z":"16e59e64.eccb62","name":"","rules":[{"t":"set","p":"humidity","pt":"msg","to":"msg.payload.main.humidity","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":580,"wires":[["24bd97dc.8028d8"]]},{"id":"24bd97dc.8028d8","type":"ui_gauge","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":3,"width":0,"height":0,"gtype":"gage","title":"Humidity","label":"%","format":"{{msg.humidity}}","min":0,"max":"100","colors":["#ffa200","#00ff59","#ff7b00"],"seg1":"","seg2":"","x":980,"y":580,"wires":[]},{"id":"f63fbc91.7a89e","type":"change","z":"16e59e64.eccb62","name":"","rules":[{"t":"set","p":"city","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":460,"wires":[["3bd22fd3.65099"]]},{"id":"3bd22fd3.65099","type":"ui_text","z":"16e59e64.eccb62","group":"2f9236d5.ca8e2a","order":1,"width":0,"height":0,"name":"City Name","label":"","format":"{{msg.city}}","layout":"col-center","x":970,"y":460,"wires":[]},{"id":"e289788.7c9bd88","type":"debug","z":"16e59e64.eccb62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"city","targetType":"msg","x":780,"y":820,"wires":[]},{"id":"8a101580.4b5f88","type":"ui_button","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":6,"width":0,"height":0,"passthru":false,"label":"Get Weather for Sydney","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":210,"y":420,"wires":[["93d9a630.2ef428"]]},{"id":"93d9a630.2ef428","type":"http request","z":"16e59e64.eccb62","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=Sydney&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":300,"y":500,"wires":[["187a3959.5a8047"]]},{"id":"2a447e67.f13f62","type":"ui_button","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":7,"width":0,"height":0,"passthru":false,"label":"Get Weather for Melbourne","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":400,"y":320,"wires":[["7c58f7d.a852508"]]},{"id":"7c58f7d.a852508","type":"http request","z":"16e59e64.eccb62","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=Melbourne&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":480,"y":400,"wires":[["187a3959.5a8047"]]},{"id":"61b2ea99.046794","type":"function","z":"16e59e64.eccb62","name":"Set Comfort","func":"msg.comfort = 0;\n\n\nif (msg.payload.main.humidity <= 60 && msg.payload.main.humidity >= 30)\n    msg.comfort += 50;\nif (msg.payload.main.temp <= 27 && msg.payload.main.temp >= 20)\n    msg.comfort += 50;     \n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":640,"wires":[["1739fce3.861a43"]]},{"id":"1739fce3.861a43","type":"ui_gauge","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":4,"width":0,"height":0,"gtype":"gage","title":"Comfort","label":"units","format":"{{msg.comfort}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb5e"],"seg1":"","seg2":"","x":980,"y":640,"wires":[]},{"id":"c2277b69.968528","type":"ui_text_input","z":"16e59e64.eccb62","name":"","label":"","tooltip":"","group":"2f9236d5.ca8e2a","order":0,"width":0,"height":0,"passthru":false,"mode":"text","delay":"0","topic":"","x":120,"y":800,"wires":[["45fa7322.8341ac"]]},{"id":"45fa7322.8341ac","type":"change","z":"16e59e64.eccb62","name":"","rules":[{"t":"set","p":"city","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":760,"wires":[["e289788.7c9bd88"]]},{"id":"a43a2048.2a9dc","type":"ui_button","z":"16e59e64.eccb62","name":"","group":"2f9236d5.ca8e2a","order":6,"width":0,"height":0,"passthru":false,"label":"Get Weather for London","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":110,"y":560,"wires":[["a3c18c35.2e4fd"]]},{"id":"239df985.981656","type":"ui_chart","z":"11d09863.30e618","name":"","group":"5283946.d10f96c","order":2,"width":"3","height":"3","label":"clicks","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":860,"y":200,"wires":[[]]},{"id":"f5b212e4.355fe","type":"function","z":"a0243dff.2c28c","name":"","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":500,"wires":[["5cb468b0.e04078","f118024e.7dec","a51917c6.c45ae8"]]},{"id":"f118024e.7dec","type":"function","z":"a0243dff.2c28c","name":"Power","func":"var topic=msg.topic\n/*\nvar nullArray = [null,null,null,null,null,null,null,null]\nvar topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"]\n\nif (topic in topicArray) {\n    nullArray[topicArray.findIndex(topic)] = msg\n    return nullArray\n}\n*/   \n  \n    \n\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n} \n","outputs":8,"noerr":0,"x":630,"y":620,"wires":[["eeb34686.504228","972653f2.0c30f","45ede546.286fac"],[],[],[],["52e9408e.0137c"],["bf2f5a2e.ad74f8"],[],["faf01c91.f3e71"]]},{"id":"5cb468b0.e04078","type":"debug","z":"a0243dff.2c28c","name":"All topics","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":860,"y":420,"wires":[]},{"id":"eeb34686.504228","type":"ui_gauge","z":"a0243dff.2c28c","name":"Voltage","group":"3038b803.7628d8","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":880,"y":560,"wires":[]},{"id":"faf01c91.f3e71","type":"ui_chart","z":"a0243dff.2c28c","name":"CurrentMa","group":"3038b803.7628d8","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":600,"wires":[[]]},{"id":"52e9408e.0137c","type":"ui_chart","z":"a0243dff.2c28c","name":"Power","group":"3038b803.7628d8","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":640,"wires":[[]]},{"id":"bf2f5a2e.ad74f8","type":"ui_chart","z":"a0243dff.2c28c","name":"Power(mW)","group":"3038b803.7628d8","order":5,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":680,"wires":[[]]},{"id":"d7d29e74.52119","type":"function","z":"14d67294.62b07d","name":"","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["a271bb86.6bb3f8","3552fa43.d94576","ffe40eb3.16bdb","7234f735.1bc658","ef7c01e1.904f"]]},{"id":"b6a407bc.fd4b48","type":"mqtt in","z":"14d67294.62b07d","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":70,"y":20,"wires":[["d7d29e74.52119","9a973030.fcafc","9713ec34.f31f9"]]},{"id":"a271bb86.6bb3f8","type":"debug","z":"14d67294.62b07d","name":"All topics","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":560,"y":120,"wires":[]},{"id":"3552fa43.d94576","type":"function","z":"14d67294.62b07d","name":"Power","func":"var topic=msg.topic;\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":130,"y":120,"wires":[["54105d87.129f54","ff5ccf6a.2e9ae"],[],[],[],["d765db6c.773258"],["c4097e8f.356a5"],[],["8e436f3a.d1434"]]},{"id":"54105d87.129f54","type":"ui_gauge","z":"14d67294.62b07d","name":"Voltage","group":"9f621075.5922c","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":440,"y":80,"wires":[]},{"id":"d765db6c.773258","type":"ui_chart","z":"14d67294.62b07d","name":"Power","group":"c9722c8d.64dbd","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":430,"y":160,"wires":[[],[]]},{"id":"c4097e8f.356a5","type":"ui_chart","z":"14d67294.62b07d","name":"Power(mW)","group":"c9722c8d.64dbd","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":450,"y":200,"wires":[[],[]]},{"id":"8e436f3a.d1434","type":"ui_chart","z":"14d67294.62b07d","name":"CurrentMa","group":"c9722c8d.64dbd","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":450,"y":120,"wires":[[]]},{"id":"ff5ccf6a.2e9ae","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":740,"y":100,"wires":[]},{"id":"b9714191.2441a","type":"mqtt in","z":"a0243dff.2c28c","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":390,"y":460,"wires":[["f5b212e4.355fe"]]},{"id":"a51917c6.c45ae8","type":"function","z":"a0243dff.2c28c","name":"Water","func":"var topic=msg.topic;\n\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"]\n\n\nif (topic in topicArray) \n    return nullArray[topicArray.findIndex(topic)] = msg;\n/*\nif (topic==\"waterquality/ph\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}*/","outputs":22,"noerr":0,"x":630,"y":880,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],["6ec9f774.1d7b48"],["6ec9f774.1d7b48"],["6ec9f774.1d7b48"],["6ec9f774.1d7b48"],["6ec9f774.1d7b48"]]},{"id":"6ec9f774.1d7b48","type":"ui_chart","z":"a0243dff.2c28c","name":"Tank temperatures","group":"3038b803.7628d8","order":4,"width":0,"height":0,"label":"Tank Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1270,"y":980,"wires":[[]]},{"id":"6c6d87aa.deb268","type":"ui_template","z":"a0243dff.2c28c","group":"3038b803.7628d8","name":"Fish Cam-2","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8083\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1310,"y":360,"wires":[[]]},{"id":"39a4803.78d8d8","type":"ui_template","z":"a0243dff.2c28c","group":"3038b803.7628d8","name":"Fish Cam-1","order":7,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8081\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1310,"y":320,"wires":[[]]},{"id":"972653f2.0c30f","type":"debug","z":"a0243dff.2c28c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1090,"y":420,"wires":[]},{"id":"707cebca.10f794","type":"ui_level","z":"a0243dff.2c28c","group":"9f621075.5922c","order":1,"width":0,"height":0,"name":"","label":"","colorHi":"#e60000","colorWarn":"#ff9900","colorNormal":"#00b33c","colorOff":"#595959","min":0,"max":100,"segWarn":"","segHigh":"","unit":"","layout":"sh","channelA":"","channelB":"","decimals":0,"animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#eeeeee","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"textAnimations":false,"hideValue":false,"tickmode":"off","peakmode":false,"peaktime":3000,"x":1190,"y":880,"wires":[]},{"id":"45ede546.286fac","type":"debug","z":"a0243dff.2c28c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":700,"wires":[]},{"id":"ae436937.f6b758","type":"comment","z":"a0243dff.2c28c","name":"Reboot & Email","info":"","x":1540,"y":420,"wires":[]},{"id":"ac56a490.446358","type":"ui_numeric","z":"a0243dff.2c28c","name":"","label":"Reboots before Email Sent","tooltip":"","group":"815b3bf2.a68b18","order":3,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":1820,"y":340,"wires":[["37bde03.d8a952"]]},{"id":"37bde03.d8a952","type":"change","z":"a0243dff.2c28c","name":"","rules":[{"t":"set","p":"emailCount","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1940,"y":420,"wires":[[]]},{"id":"6378df99.486c2","type":"inject","z":"a0243dff.2c28c","name":"TestEmail","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1960,"y":960,"wires":[["326daaa5.aac896"]]},{"id":"326daaa5.aac896","type":"function","z":"a0243dff.2c28c","name":"EmailContent","func":"var Devicepath = flow.get(\"Devicepath\");\nmsg = {\n    payload: \"The email body here at Date: \" + Date().toString() + \", my explanation e.g. water level now at  \" + msg.payload + \"%\",\n    topic: \"RESTARTING: The email subject line - Devicepath: \" + Devicepath,\n    to: \"michaelthompson@mail.com\",\n    cc: \"\",\n    bcc: \"\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":2120,"y":921,"wires":[["bc042fda.66e09"]]},{"id":"bc042fda.66e09","type":"e-mail","z":"a0243dff.2c28c","server":"mail.cypernet.com","port":"25","secure":false,"tls":false,"name":"michaelthompson@mail.com","dname":"MH","x":2270,"y":920,"wires":[]},{"id":"417fb79e.eb6c38","type":"inject","z":"a0243dff.2c28c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1160,"y":600,"wires":[["9b3edea.866212"]]},{"id":"9b3edea.866212","type":"random","z":"a0243dff.2c28c","name":"","low":"0","high":"3","inte":"true","property":"payload","x":1340,"y":600,"wires":[[]]},{"id":"9fc3f9ae.7f4b78","type":"switch","z":"a0243dff.2c28c","name":"Is Startup?","property":"payload.cyper/ESPloader01/mcu/startingup","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1350,"y":480,"wires":[[]]},{"id":"f451bac4.4f7978","type":"inject","z":"a0243dff.2c28c","name":"Timestamp","topic":"Datetime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":460,"wires":[["9fc3f9ae.7f4b78"]]},{"id":"5662c47c.8b02fc","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":280,"y":560,"wires":[]},{"id":"f5238cae.2c22a","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":300,"y":260,"wires":[]},{"id":"3122ab25.964224","type":"ui_lineargauge","z":"14d67294.62b07d","group":"c52a337b.b7d5e","order":1,"width":0,"height":0,"name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"°C","x":2530,"y":1200,"wires":[]},{"id":"cc65a010.fd658","type":"ui_lineargauge","z":"14d67294.62b07d","group":"be3051b7.b8a6b","order":1,"width":0,"height":0,"name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"°C","x":2530,"y":1240,"wires":[]},{"id":"46bcbf78.b0d8e","type":"ui_lineargauge","z":"14d67294.62b07d","group":"d835b4a9.7681b8","order":1,"width":"0","height":"0","name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"°C","x":2530,"y":1160,"wires":[]},{"id":"95f8243e.ad0418","type":"change","z":"14d67294.62b07d","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1160,"wires":[["46bcbf78.b0d8e"]]},{"id":"5a2b3113.855c8","type":"change","z":"14d67294.62b07d","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1240,"wires":[[]]},{"id":"3efb9de3.12e2c2","type":"change","z":"14d67294.62b07d","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1200,"wires":[[]]},{"id":"687da419.f1f76c","type":"comment","z":"14d67294.62b07d","name":"Tank Temperatures","info":"","x":2550,"y":20,"wires":[]},{"id":"da425b19.ae5118","type":"ui_chart","z":"14d67294.62b07d","name":"","group":"815b3bf2.a68b18","order":3,"width":0,"height":0,"label":"Today's Reboots","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":3450,"y":1580,"wires":[[]]},{"id":"bf9b541b.8a4908","type":"change","z":"14d67294.62b07d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"rebootCount","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3240,"y":1520,"wires":[["da425b19.ae5118"]]},{"id":"373f9ca6.960324","type":"function","z":"14d67294.62b07d","name":"Count Reboots","func":"var rebootCount = global.get('rebootCount')||0;\n\n// reset rebootCount at midnight\nif (msg.time == \"0:0:0\" || global.rebootCount === 0)\n    rebootCount = 0;\nelse\n    rebootCount += 1;\n// store the value back\nglobal.set('rebootCount',rebootCount);\n// make it part of the outgoing msg object\nmsg.rebootCount = rebootCount;\nreturn msg;","outputs":1,"noerr":0,"x":2700,"y":1360,"wires":[["c105e89d.a84968","78254003.e3dad","6b0effa4.f1086","bf9b541b.8a4908"]]},{"id":"b88e9460.9ba268","type":"function","z":"14d67294.62b07d","name":"Get Datetime","func":"var today = new Date();\n\nvar hours = today.getHours() + 11\nmsg.time = hours + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2690,"y":1300,"wires":[["373f9ca6.960324","21b8a866.0483e8"]]},{"id":"c105e89d.a84968","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"rebootCount","targetType":"msg","x":2860,"y":1460,"wires":[]},{"id":"78254003.e3dad","type":"function","z":"14d67294.62b07d","name":"Check Count","func":"var emailCount = global.get('emailCount')||1;\n\nif (msg.rebootCount == emailCount)\n    return msg;","outputs":1,"noerr":0,"x":2970,"y":1360,"wires":[["3cc9d6ed.c27f1a","bf02bf45.289c3"]]},{"id":"6b0effa4.f1086","type":"ui_text","z":"14d67294.62b07d","group":"815b3bf2.a68b18","order":1,"width":0,"height":0,"name":"","label":"Today","format":"{{msg.rebootCount}}","layout":"col-center","x":3090,"y":1580,"wires":[]},{"id":"21b8a866.0483e8","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"time","targetType":"msg","x":2860,"y":1300,"wires":[]},{"id":"3cc9d6ed.c27f1a","type":"e-mail","z":"14d67294.62b07d","server":"{{msg.server}}","port":"{{msg.port}}","secure":true,"tls":true,"name":"{{msg.recipient}}","dname":"Send Email","x":3350,"y":1420,"wires":[]},{"id":"bf02bf45.289c3","type":"debug","z":"14d67294.62b07d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"\"out\"","targetType":"jsonata","x":3140,"y":1300,"wires":[]},{"id":"8d190c1e.172fe","type":"change","z":"14d67294.62b07d","name":"Reset rebootCount","rules":[{"t":"set","p":"rebootCount","pt":"global","to":"0","tot":"num"},{"t":"set","p":"rebootCount","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2810,"y":1560,"wires":[["6b0effa4.f1086"]]},{"id":"b0923d05.629ca","type":"ui_button","z":"14d67294.62b07d","name":"","group":"815b3bf2.a68b18","order":3,"width":0,"height":0,"passthru":false,"label":"Reset for the day","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":2570,"y":1540,"wires":[["8d190c1e.172fe"]]},{"id":"b34fe71d.d641e8","type":"mqtt in","z":"cd531b46.586a98","name":"ESP12S007","topic":"cyper/ESP12S007/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":90,"y":100,"wires":[["4e54e0f.6c4652"]]},{"id":"4e54e0f.6c4652","type":"function","z":"cd531b46.586a98","name":"Split Topic","func":"// Authored by Martin Hannah\n\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":100,"wires":[["47c81f97.00bf8"]]},{"id":"5facf7d0.ac5d28","type":"function","z":"cd531b46.586a98","name":"Power","func":"// Authored by Michael Thompson on 30/12/2020\nconst topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\n    flow.set(\"power/voltage\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\n    flow.set(\"power/amp\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\n    flow.set(\"power/mA\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\n    flow.set(\"power/loadvoltage\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\n    flow.set(\"power/loadpower\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\n    flow.set(\"power/loadpowermw\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\n    flow.set(\"power/loadamps\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\n    flow.set(\"power/loadmA\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg];\n} \n*/\n","outputs":8,"noerr":0,"x":270,"y":3980,"wires":[[],[],[],[],[],[],[],[]]},{"id":"dad28103.5b585","type":"influxdb out","z":"8e2a5447.6d4358","influxdb":null,"name":"","measurement":"TANK_MEASURE","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1240,"y":280,"wires":[]},{"id":"d67de2a6.31301","type":"function","z":"8e2a5447.6d4358","name":"condition","func":"var sensor = msg.sensor;\nif (sensor >= 5) {\n    msg.payload =\n    {\n        numValue:  sensor,\n        strValue:  \"high\",\n        valveCond: 0\n    }\n}\n\nelse {\n    msg.payload =\n    {\n        numValue:  sensor,\n        strValue:  \"low\",\n        valveCond: 1\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":340,"wires":[["dad28103.5b585","626be6b7.edfa28"]]},{"id":"efbe2bc6.32ddd8","type":"random","z":"8e2a5447.6d4358","name":"","low":"1","high":"10","inte":"true","property":"sensor","x":660,"y":340,"wires":[["d67de2a6.31301"]]},{"id":"626be6b7.edfa28","type":"debug","z":"8e2a5447.6d4358","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":340,"wires":[]},{"id":"c4a96a93.3518b8","type":"inject","z":"8e2a5447.6d4358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":340,"wires":[["efbe2bc6.32ddd8"]]},{"id":"6c1fd40.ff8262c","type":"inject","z":"cd531b46.586a98","name":"Inject every second","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"0.1","x":800,"y":100,"wires":[["c6ca9a9.409ae68"]]},{"id":"117cb3a7.170dcc","type":"function","z":"cd531b46.586a98","name":"Water","func":"// Authored by Michael Thompson on 30/12/2020\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n\n\n\n\n/*\n// Martin Hannah Code\nif (topic==\"waterquality/ph\") {\n    flow.set(\"waterquality/ph\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\n    flow.set(\"waterquality/phrating\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\n    flow.set(\"waterquality/turbidity\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\n    flow.set(\"waterquality/turbidityvolts\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\n    flow.set(\"waterflow/tankwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\n    flow.set(\"watertemp00/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\n    flow.set(\"waterflow/gardenwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\n    flow.set(\"watertemp01/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\n    flow.set(\"waterlevel/fishtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\n    flow.set(\"waterlevel/2ndtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\n    flow.set(\"waterlevel/3rdtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\n    flow.set(\"waterlevel/fishtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\n    flow.set(\"waterlevel/2ndtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\n    flow.set(\"waterlevel/3rdtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\n    flow.set(\"waterlevel/fishtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\n    flow.set(\"waterlevel/2ndtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\n    flow.set(\"waterlevel/3rdtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\n    flow.set(\"temperature00/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\n    flow.set(\"temperature01/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\n    flow.set(\"temperature02/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\n    flow.set(\"temperature03/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\n    flow.set(\"temperature04/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":22,"noerr":0,"x":270,"y":4220,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"93a2fb08.abd968","type":"comment","z":"cd531b46.586a98","name":"Get Sensor Data","info":"","x":100,"y":40,"wires":[]},{"id":"c52f5490.1d8b78","type":"comment","z":"cd531b46.586a98","name":"Interpret Sensor Data","info":"https://run.mocky.io/v3/b4b2d93d-896c-4d37-b019-5228a61e2338\n\n\nhttps://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb\n\n\nhttps://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","x":440,"y":40,"wires":[]},{"id":"c3ae712a.843d4","type":"comment","z":"cd531b46.586a98","name":"Send to InfluxDB","info":"","x":780,"y":40,"wires":[]},{"id":"9d7a3538.58ad88","type":"function","z":"cd531b46.586a98","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":280,"y":4480,"wires":[[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"a2875ff9.03e1f","type":"function","z":"cd531b46.586a98","name":"Environ","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null,null,null,null,null,null,null,null];\nconst topicArray = \n[\"sound/loadness\",\n\"environment/temperature\",\n\"environment/avetemperature\",\n\"environment/humidity\",\n\"environment/abshumidity\",\n\"environment/heatindex\",\n\"environment/pressure\",\n\"environment/altitude\",\n\"uvindex/uvindex\",\n\"uvindex/uvrating\",\n\"proximity/movement\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\nvar topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":11,"noerr":0,"x":280,"y":4660,"wires":[[],[],[],[],[],[],[],[],[],[],["c09bbfff.0cfa"]]},{"id":"c09bbfff.0cfa","type":"function","z":"cd531b46.586a98","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":4760,"wires":[[]]},{"id":"22ae1682.42e15a","type":"function","z":"cd531b46.586a98","name":"Light","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null];\nconst topicArray = [\"light/ambientlight\",\"light/illuminance\",\"light/illuminance/01\",\"light/illuminance/02\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null]\nreturn nullArray;\n\n\n/*\nvar topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n} */","outputs":4,"noerr":0,"x":270,"y":4820,"wires":[[],[],[],[]]},{"id":"ae420c99.4167d","type":"function","z":"cd531b46.586a98","name":"Misc","func":"// ASK ABOUT DUPLICATE TOPICS\n\n// Authored by Michael Thompson on 30/12/2020\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\n/*\"waterquality/phrating\"\n\"waterquality/turbidity\"\n\"waterquality/voltage\"\n\"temperature00/degrees\"\n\"temperature01/degrees\"\n\"temperature03/degrees\"\n\"mcu/heartbeat\"*/\nif (msg.topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n    msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n    //msg.payload = msg.payload.replace(\",\",'\\n');\n    msg.payload = msg.payload.replace(\"zzStart,\",'');\n    msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n    msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n    msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n    msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n    msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n    msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n    msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n    msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n    msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n    msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n    msg.payload = msg.payload.replace(\"BME\",'BMP280');\n    msg.payload = msg.payload.replace(/read/g,'');\n    return [msg,null,null,null,null,null,null,null];\n}\n\nelse {\n    // Get index of topic in array\n    var index = topicArray.findIndex(topic => topic === msg.topic);\n    \n    // If the topic is in the topicArray, assign it to the same index in nullArray and create\n    // a flow variable\n    if (index != -1) {\n        nullArray[index] = msg;\n        flow.set(msg.topic,parseFloat(msg.payload));\n    }\n    \n    // eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\n    return nullArray;    \n    \n    \n}\n\n\n\n\n\n\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":270,"y":4920,"wires":[[],[],[],[],[],[],[],[]]},{"id":"47c81f97.00bf8","type":"function","z":"cd531b46.586a98","name":"Update Topic Flow Variable ","func":"// Authored by Michael Thompson on 30/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\n// Updates flow array containing all topics\n// May or may not be necessary // \nconst topicArray = flow.get(\"topicArray\") || [];\nif ((topicArray.includes(msg.topic))===false)\n    topicArray.push(msg.topic);\nflow.set(\"topicArray\", topicArray);\n\n\nvar group = flow.get('Devicepath');\n\n// Updates flow containing for groups\nconst groups = flow.get(\"groups\") || [];\nif (!(groups.includes(group)))\n    groups.push(group);\nflow.set(\"groups\", groups);\n\n// Updates flow containing for topics within current group\nconst groupArray = flow.get(group+\"Array\") || [];\nif (!(groupArray.includes(msg.topic)) && !msg.topic.includes(\"$\"))\n    groupArray.push(msg.topic);\nflow.set(group+\"Array\",groupArray);\n\n// Updates flow variable for current group and topic\nflow.set(group+msg.topic,\n        // WILL NEED TO PARSE OTHER DATATYPES\n        // PARSING FLOAT BECAUSE FIRMWARE SENDS ALL DATA AS STRINGS\n        // WHICH CAUSES ERRORS WITH INFLUXDB TYPES\n        {\"value\":parseFloat(msg.payload),\n        // Bool for if data is new\n         \"new\":true\n        });\n\n","outputs":1,"noerr":0,"x":460,"y":160,"wires":[["572d2071.16543"]]},{"id":"22bb0597.40098a","type":"ui_gauge","z":"cd531b46.586a98","name":"Voltage","group":"9f621075.5922c","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":960,"y":320,"wires":[]},{"id":"89ba05da.08a0c8","type":"ui_chart","z":"cd531b46.586a98","name":"CurrentMa","group":"c9722c8d.64dbd","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":970,"y":360,"wires":[[]]},{"id":"34dc6140.858d3e","type":"ui_chart","z":"cd531b46.586a98","name":"Power","group":"c9722c8d.64dbd","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":950,"y":400,"wires":[[],[]]},{"id":"5fda79c6.18acb8","type":"ui_chart","z":"cd531b46.586a98","name":"Power(mW)","group":"c9722c8d.64dbd","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":970,"y":440,"wires":[[],[]]},{"id":"23e20e92.a465e2","type":"function","z":"cd531b46.586a98","name":"Output","func":"\nreturn msg;","outputs":8,"noerr":0,"x":750,"y":380,"wires":[["22bb0597.40098a"],["89ba05da.08a0c8"],["34dc6140.858d3e"],["5fda79c6.18acb8"],[],[],[],[]]},{"id":"9c6f8ec.f39c57","type":"comment","z":"cd531b46.586a98","name":"Node-Red Dashboard","info":"","x":800,"y":280,"wires":[]},{"id":"7d19f4ae.fd158c","type":"function","z":"cd531b46.586a98","name":"Set topicArrays","func":"// Authored by Michael Thompson on 4/1/21\n\nvar topics = msg.payload['topics'];\nvar topicArray = [];\n\nfor (var key in topics) {\n    topicArray.push(topics[key]);\n}\n\n// Instead of this, each array will contain a list of sensors associated with a \"group\" \n// and a MQTT device\nflow.set(\"topicArray\",topicArray);\n\nflow.set(\"powerArray\",topics['power']);\nflow.set(\"waterArray\",topics['water']);\n\n\nreturn msg;\n\n/*\nconst topicArray = [\n    // POWER\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\",\n    // WATER\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"]; \n\nconst powerArray = [\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\"];\n    \nconst waterArray = [\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"];\n\nconst miscArray = [];\n\n\n\nflow.set(\"powerArray\",powerArray);\nflow.set(\"waterArray\",waterArray);\nflow.set(\"miscArray\",miscArray); */","outputs":1,"noerr":0,"x":520,"y":3800,"wires":[[]]},{"id":"b83fa39a.08ebb","type":"http request","z":"cd531b46.586a98","name":"GET topicArrays","method":"GET","ret":"obj","paytoqs":false,"url":"https://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","tls":"","proxy":"","authType":"","x":280,"y":3800,"wires":[["7d19f4ae.fd158c"]]},{"id":"914761b8.7a5df","type":"mqtt in","z":"cd531b46.586a98","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":90,"y":160,"wires":[["4e54e0f.6c4652"]]},{"id":"8339f3a9.bb7f1","type":"mqtt in","z":"cd531b46.586a98","name":"ESP12S009","topic":"cyper/ESP12S009/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":90,"y":220,"wires":[["4e54e0f.6c4652"]]},{"id":"6e21e8f9.50c5f8","type":"mqtt in","z":"cd531b46.586a98","name":"ESP12S010","topic":"cyper/ESP12S010/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":90,"y":280,"wires":[["4e54e0f.6c4652"]]},{"id":"fcfe8e23.d0c93","type":"function","z":"cd531b46.586a98","name":"Send New Group Data","func":"// Authored by Michael Thompson on 29/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\nvar group = flow.get(\"groups\")[msg.index];\n\n// Array of Sensor Values\nvalueArr = flow.get(group+\"Array\");\n\njsonData = {};\n\n// InfluxDB measurement set to group name as defined by loop over groups array\nmsg.measurement = group;\n\n// For each sensor value, if the value is not set to \"undefined\" and contains new data, it is updated\n// in the JSON object\nvar value;\nvar send = false;\nfor (value of valueArr) \n    if (flow.get(group+value) !== undefined && !(isNaN(flow.get(group+value)[\"value\"])) && flow.get(group+value)[\"new\"] === true) {\n        // NOTICE how field for influxDB (jsonData[value]) does not need to contain group\n        jsonData[value] = flow.get(group+value)[\"value\"];\n        flow.set(group+value,{\"value\":flow.get(group+value)[\"value\"],\"new\":false});\n        send = true;\n    }\n// JSON object of most up-to-date sensor values returned\nif (send === true) {\n    msg.payload = jsonData;\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":220,"wires":[["5b33bcc1.5113d4","c6ca9a9.409ae68"]]},{"id":"c79b0caa.c0ab3","type":"influxdb out","z":"cd531b46.586a98","influxdb":"db032a0b.8a8af8","name":"Update Measurement","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1100,"y":100,"wires":[]},{"id":"5b33bcc1.5113d4","type":"debug","z":"cd531b46.586a98","name":"Debug InfluxDB","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1080,"y":200,"wires":[]},{"id":"23df437f.cb9b5c","type":"comment","z":"cd531b46.586a98","name":"OLD API implementation","info":"","x":310,"y":3700,"wires":[]},{"id":"fb950506.f7f878","type":"comment","z":"cd531b46.586a98","name":"Add more devices here as necessary","info":"","x":160,"y":340,"wires":[]},{"id":"c6ca9a9.409ae68","type":"array-loop","z":"cd531b46.586a98","name":"Loop over Groups","key":"index","keyType":"msg","reset":true,"resetValue":"value-null","array":"groups","arrayType":"flow","x":790,"y":160,"wires":[[],["fcfe8e23.d0c93"]]},{"id":"6ad8933a.d7b03c","type":"mqtt in","z":"7de8d9bd.05bea8","name":"ESP12S007","topic":"cyper/ESP12S007/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":190,"y":300,"wires":[["3bb068ba.cd1268","6718e2c2.b5475c"]]},{"id":"3bb068ba.cd1268","type":"function","z":"7de8d9bd.05bea8","name":"Topic Splitter","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":300,"wires":[["9f8ab59e.254288"]]},{"id":"9f8ab59e.254288","type":"function","z":"7de8d9bd.05bea8","name":"Power","func":"var topic=msg.topic;\nvar array = [\"power/voltage\", \"power/amp\", \"power/mA\", \"power/loadvoltage\", \"power/loadpower\", \"power/loadpowermw\", \"power/loadamps\", \"power/loadmA\" ];\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nvar nullArray = [null,null,null,null,null,null,null,null];\n\n\nfor (var [i, element] of array.entries()) { \n    if (topic == element) {\n        nullArray[i] = msg;\n        return nullArray;\n    }\n}\n/*\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n}\n*/","outputs":8,"noerr":0,"x":590,"y":300,"wires":[["39a8993b.ea83a6"],["e7dffaa2.8f75d8"],[],[],["9fb6fa73.09cdd8"],["6a448ed6.06c88"],[],["9f4af273.31d0a"]]},{"id":"39a8993b.ea83a6","type":"ui_gauge","z":"7de8d9bd.05bea8","name":"Voltage","group":"d93ac5a3.945168","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"V","format":"{{value}}","min":0,"max":"5","colors":["#00b500","#e6e600","#ca3838"],"seg1":"1.7","seg2":"3.4","x":920,"y":260,"wires":[]},{"id":"9f4af273.31d0a","type":"ui_chart","z":"7de8d9bd.05bea8","name":"CurrentMa","group":"d93ac5a3.945168","order":5,"width":0,"height":0,"label":"Current","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#88b9c7","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":440,"wires":[[]]},{"id":"9fb6fa73.09cdd8","type":"ui_chart","z":"7de8d9bd.05bea8","name":"Power","group":"d93ac5a3.945168","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#51b43d","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":360,"wires":[[]]},{"id":"6a448ed6.06c88","type":"ui_chart","z":"7de8d9bd.05bea8","name":"PowerMW","group":"d93ac5a3.945168","order":4,"width":0,"height":0,"label":"Power","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#e7af19","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":400,"wires":[[]]},{"id":"c3ea4a6c.6c9e08","type":"comment","z":"7de8d9bd.05bea8","name":"1) ","info":"Have a look through the nodes and ask\nquestions if you have any\n\nUse a debug node on the mqtt node to observe incoming data\nWhat is its topic is? Topic is a string describing what is being measured\nWhat is its payload? Payload is a string. A quantitative measure.\nWhat is the datatype? (Are they all the same?)","x":450,"y":60,"wires":[]},{"id":"ac3c0c0b.78fc9","type":"comment","z":"7de8d9bd.05bea8","name":"2) ","info":"Go to 10.0.0.211:32783/ui/ and click on Lachlan tab\nLook at the gauges\nSet the units for each gauge and adjust the gradient and range","x":450,"y":100,"wires":[]},{"id":"a66d0193.d0736","type":"comment","z":"7de8d9bd.05bea8","name":"3)","info":"Add a node to display power/amp as a linear gauge","x":450,"y":140,"wires":[]},{"id":"469be29a.4f381c","type":"comment","z":"7de8d9bd.05bea8","name":"4) HARD","info":"4) Create a function to store each incoming \n   topic as a flow variable with attributes: value\n   and category.\n\n   Example: \"power/amp\"\n            flow.get(\"power/amp\") should return:\n            {\n                \"value\": 3.14,\n                \"category\": \"power\"\n            }\n   \n   NOTE:\n        You may need to research JSON objects\n        https://www.w3schools.com/js/js_json_objects.asp\n        \n        Use a debug node with msg.payload set to a flow variable\n        to test\n   ","x":460,"y":180,"wires":[]},{"id":"62a0ad05.49dc14","type":"comment","z":"7de8d9bd.05bea8","name":"5) ","info":"Optimise the Power function","x":450,"y":220,"wires":[]},{"id":"dbb7a53.f294158","type":"debug","z":"cd531b46.586a98","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":560,"wires":[]},{"id":"572d2071.16543","type":"function","z":"cd531b46.586a98","name":"","func":"msg.payload = flow.get(\"cyper/ESP12S007/Array\")\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":360,"wires":[["dbb7a53.f294158"]]},{"id":"e1c92b76.dceee8","type":"inject","z":"cd531b46.586a98","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":460,"wires":[["572d2071.16543"]]},{"id":"e7dffaa2.8f75d8","type":"ui_gauge","z":"7de8d9bd.05bea8","name":"PowerAmp","group":"d93ac5a3.945168","order":2,"width":0,"height":0,"gtype":"gage","title":"PowerAmp","label":"A","format":"{{value}}","min":"-20","max":"0","colors":["#00b500","#e6e600","#ca3838"],"seg1":"-3.4","seg2":"-1.7","x":920,"y":320,"wires":[]},{"id":"6718e2c2.b5475c","type":"function","z":"7de8d9bd.05bea8","name":"New Variable","func":"// Creates new variable with value as message payload and category as\n// the device path variable from the topic splitter.\nvar newV;\nnewV = {\"value\":msg.payload, \"category\":flow.get(\"Devicepath\")};\n// Sets msg.topic as recently created ariable newV.\nflow.set(msg.topic, newV);\n// Accesses message topic variable.\nmsg.payload = flow.get(msg.topic);\nreturn msg;\n","outputs":1,"noerr":0,"x":410,"y":440,"wires":[["849c9809.32e388"]]},{"id":"849c9809.32e388","type":"debug","z":"7de8d9bd.05bea8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":520,"wires":[]},{"id":"dd9f627c.59334","type":"function","z":"d809a3fb.a012","name":"Power","func":"// Authored by Michael Thompson on 30/12/2020\nconst topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\n    flow.set(\"power/voltage\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\n    flow.set(\"power/amp\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\n    flow.set(\"power/mA\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\n    flow.set(\"power/loadvoltage\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\n    flow.set(\"power/loadpower\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\n    flow.set(\"power/loadpowermw\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\n    flow.set(\"power/loadamps\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\n    flow.set(\"power/loadmA\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg];\n} \n*/\n","outputs":8,"noerr":0,"x":270,"y":3980,"wires":[[],[],[],[],[],[],[],[]]},{"id":"fdffa349.faeb7","type":"inject","z":"d809a3fb.a012","name":"Inject every second","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"0.1","x":660,"y":80,"wires":[["7e4d3c9b.e90054"]]},{"id":"bd9f373c.422cc8","type":"function","z":"d809a3fb.a012","name":"Water","func":"// Authored by Michael Thompson on 30/12/2020\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n\n\n\n\n/*\n// Martin Hannah Code\nif (topic==\"waterquality/ph\") {\n    flow.set(\"waterquality/ph\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\n    flow.set(\"waterquality/phrating\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\n    flow.set(\"waterquality/turbidity\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\n    flow.set(\"waterquality/turbidityvolts\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\n    flow.set(\"waterflow/tankwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\n    flow.set(\"watertemp00/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\n    flow.set(\"waterflow/gardenwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\n    flow.set(\"watertemp01/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\n    flow.set(\"waterlevel/fishtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\n    flow.set(\"waterlevel/2ndtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\n    flow.set(\"waterlevel/3rdtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\n    flow.set(\"waterlevel/fishtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\n    flow.set(\"waterlevel/2ndtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\n    flow.set(\"waterlevel/3rdtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\n    flow.set(\"waterlevel/fishtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\n    flow.set(\"waterlevel/2ndtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\n    flow.set(\"waterlevel/3rdtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\n    flow.set(\"temperature00/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\n    flow.set(\"temperature01/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\n    flow.set(\"temperature02/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\n    flow.set(\"temperature03/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\n    flow.set(\"temperature04/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":22,"noerr":0,"x":270,"y":4220,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"67705a4e.ba6be4","type":"comment","z":"d809a3fb.a012","name":"Get Sensor Data","info":"","x":100,"y":40,"wires":[]},{"id":"12938591.e6778a","type":"comment","z":"d809a3fb.a012","name":"Interpret Sensor Data","info":"https://run.mocky.io/v3/b4b2d93d-896c-4d37-b019-5228a61e2338\n\n\nhttps://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb\n\n\nhttps://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","x":340,"y":40,"wires":[]},{"id":"1ccf74d3.3c547b","type":"comment","z":"d809a3fb.a012","name":"Send to InfluxDB 2.0","info":"","x":650,"y":40,"wires":[]},{"id":"32c3567a.0c7cca","type":"function","z":"d809a3fb.a012","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":280,"y":4480,"wires":[[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"557506f7.9cf198","type":"function","z":"d809a3fb.a012","name":"Environ","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null,null,null,null,null,null,null,null];\nconst topicArray = \n[\"sound/loadness\",\n\"environment/temperature\",\n\"environment/avetemperature\",\n\"environment/humidity\",\n\"environment/abshumidity\",\n\"environment/heatindex\",\n\"environment/pressure\",\n\"environment/altitude\",\n\"uvindex/uvindex\",\n\"uvindex/uvrating\",\n\"proximity/movement\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\nvar topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":11,"noerr":0,"x":280,"y":4660,"wires":[[],[],[],[],[],[],[],[],[],[],["3ec580b3.a9026"]]},{"id":"3ec580b3.a9026","type":"function","z":"d809a3fb.a012","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":4760,"wires":[[]]},{"id":"84fd77df.168b18","type":"function","z":"d809a3fb.a012","name":"Light","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null];\nconst topicArray = [\"light/ambientlight\",\"light/illuminance\",\"light/illuminance/01\",\"light/illuminance/02\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null]\nreturn nullArray;\n\n\n/*\nvar topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n} */","outputs":4,"noerr":0,"x":270,"y":4820,"wires":[[],[],[],[]]},{"id":"128d3752.58acc9","type":"function","z":"d809a3fb.a012","name":"Misc","func":"// ASK ABOUT DUPLICATE TOPICS\n\n// Authored by Michael Thompson on 30/12/2020\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\n/*\"waterquality/phrating\"\n\"waterquality/turbidity\"\n\"waterquality/voltage\"\n\"temperature00/degrees\"\n\"temperature01/degrees\"\n\"temperature03/degrees\"\n\"mcu/heartbeat\"*/\nif (msg.topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n    msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n    //msg.payload = msg.payload.replace(\",\",'\\n');\n    msg.payload = msg.payload.replace(\"zzStart,\",'');\n    msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n    msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n    msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n    msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n    msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n    msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n    msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n    msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n    msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n    msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n    msg.payload = msg.payload.replace(\"BME\",'BMP280');\n    msg.payload = msg.payload.replace(/read/g,'');\n    return [msg,null,null,null,null,null,null,null];\n}\n\nelse {\n    // Get index of topic in array\n    var index = topicArray.findIndex(topic => topic === msg.topic);\n    \n    // If the topic is in the topicArray, assign it to the same index in nullArray and create\n    // a flow variable\n    if (index != -1) {\n        nullArray[index] = msg;\n        flow.set(msg.topic,parseFloat(msg.payload));\n    }\n    \n    // eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\n    return nullArray;    \n    \n    \n}\n\n\n\n\n\n\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":270,"y":4920,"wires":[[],[],[],[],[],[],[],[]]},{"id":"f68498c1.f2a248","type":"ui_gauge","z":"d809a3fb.a012","name":"Voltage","group":"9f621075.5922c","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":820,"y":320,"wires":[]},{"id":"bc2d6ab0.8d40c8","type":"ui_chart","z":"d809a3fb.a012","name":"CurrentMa","group":"c9722c8d.64dbd","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":830,"y":360,"wires":[[]]},{"id":"19021ca8.3e9533","type":"ui_chart","z":"d809a3fb.a012","name":"Power","group":"c9722c8d.64dbd","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":810,"y":400,"wires":[[],[]]},{"id":"aff23a16.0a4ae8","type":"ui_chart","z":"d809a3fb.a012","name":"Power(mW)","group":"c9722c8d.64dbd","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":830,"y":440,"wires":[[],[]]},{"id":"5df617d6.aede48","type":"function","z":"d809a3fb.a012","name":"Output","func":"\nreturn msg;","outputs":8,"noerr":0,"x":610,"y":380,"wires":[["f68498c1.f2a248"],["bc2d6ab0.8d40c8"],["19021ca8.3e9533"],["aff23a16.0a4ae8"],[],[],[],[]]},{"id":"6a1e5730.c9e968","type":"comment","z":"d809a3fb.a012","name":"Node-Red Dashboard","info":"","x":660,"y":280,"wires":[]},{"id":"3a013a1c.98c0e6","type":"function","z":"d809a3fb.a012","name":"Set topicArrays","func":"// Authored by Michael Thompson on 4/1/21\n\nvar topics = msg.payload['topics'];\nvar topicArray = [];\n\nfor (var key in topics) {\n    topicArray.push(topics[key]);\n}\n\n// Instead of this, each array will contain a list of sensors associated with a \"group\" \n// and a MQTT device\nflow.set(\"topicArray\",topicArray);\n\nflow.set(\"powerArray\",topics['power']);\nflow.set(\"waterArray\",topics['water']);\n\n\nreturn msg;\n\n/*\nconst topicArray = [\n    // POWER\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\",\n    // WATER\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"]; \n\nconst powerArray = [\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\"];\n    \nconst waterArray = [\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"];\n\nconst miscArray = [];\n\n\n\nflow.set(\"powerArray\",powerArray);\nflow.set(\"waterArray\",waterArray);\nflow.set(\"miscArray\",miscArray); */","outputs":1,"noerr":0,"x":520,"y":3800,"wires":[[]]},{"id":"46890a2d.e614f4","type":"http request","z":"d809a3fb.a012","name":"GET topicArrays","method":"GET","ret":"obj","paytoqs":false,"url":"https://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","tls":"","proxy":"","authType":"","x":280,"y":3800,"wires":[["3a013a1c.98c0e6"]]},{"id":"8ec6d9e5.0ee828","type":"function","z":"d809a3fb.a012","name":"Send New Device Data","func":"// Authored by Michael Thompson on 29/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n// Last updated by Lachlan Magrath on 4/2/2021\n\nvar device = msg.payload;//flow.get(\"groups\")[msg.index];\nvar GDpairs = flow.get(\"GDpairs\");\n\n// Get group from device in GDpairs\nvar group = Object.keys(GDpairs).find(key => GDpairs[key] === device) || \"Ungrouped\";\n\nmsg.payload = [];\n\n// Array of Sensor Values\ndeviceArr = flow.get(device+\"Array\");\n\ndata = \"\";\n\n// InfluxDB measurement set to group name as defined by loop over groups array\nmsg.measurement = group;\n\n// For each sensor value, if the value is not set to \"undefined\" and contains new data, it is updated\n// in the JSON object\nvar send = false;\n\n\n//var host = flow.get(\"GDpairs\")[group];\n\n// 11/2/21 Lachlan: Prototype ( +\" \"+Date.now()/1000 )\n// Code sourced from \n// https://www.toptal.com/software/definitive-guide-to-datetime-manipulation Punit Jajodia\nconst currentDate = new Date();\nconst timestamp = currentDate.getTime();\n\n//var value = flow.get(group+value)[\"value\"];\n\nfor (var topic of deviceArr) \n    if (flow.get(device+topic) !== undefined && !(isNaN(flow.get(device+topic)['value'])) && flow.get(device+topic)[\"new\"] === true) {\n        data += \"\\n\"+group+\",host=\"+device+\" \"+topic+\"=\"+flow.get(device+topic)[\"value\"]+\" \"+timestamp;\n        flow.set(device+topic,{\"value\":flow.get(device+topic)[\"value\"],\"new\":false});\n        //send = true;\n    }\n// String of most up-to-date sensor values seperated by new lines returned\nmsg.payload = data;\n/*\nif (send === true) {\n    msg.payload = data;\n    return msg;\n} */\n\n\n\n\n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":670,"y":200,"wires":[["4b90c708.7350c8","7e4d3c9b.e90054","6696f7e3.0878c8"]]},{"id":"4b90c708.7350c8","type":"debug","z":"d809a3fb.a012","name":"Debug InfluxDB","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":900,"y":220,"wires":[]},{"id":"61aad54a.97a74c","type":"comment","z":"d809a3fb.a012","name":"OLD API implementation","info":"","x":310,"y":3700,"wires":[]},{"id":"525456f1.8a4f18","type":"comment","z":"d809a3fb.a012","name":"Add more devices here as necessary","info":"","x":160,"y":340,"wires":[]},{"id":"7e4d3c9b.e90054","type":"array-loop","z":"d809a3fb.a012","name":"Loop over Devices","key":"index","keyType":"msg","reset":true,"resetValue":"value-null","array":"devices","arrayType":"flow","x":650,"y":140,"wires":[[],["8ec6d9e5.0ee828"]]},{"id":"7203b2bc.c399cc","type":"inject","z":"164c3b5f.4e40a5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":200,"wires":[["bd9c5163.e816a"]]},{"id":"bd9c5163.e816a","type":"function","z":"164c3b5f.4e40a5","name":"Fields and Tags","func":"msg.payload = [{\n    intValue: '10i',\n    numValue: 12,\n    randomValue: Math.random()*10,\n    strValue: \"message2\"\n},\n{\n    tag1:\"sensor1\",\n    tag2:\"device2\"\n}];\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":200,"wires":[["fd539665.9ad118"]]},{"id":"fd539665.9ad118","type":"influxdb out","z":"164c3b5f.4e40a5","influxdb":"ba6be8ce.0d6ab8","name":"","measurement":"test","precision":"ms","retentionPolicy":"","database":"test","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"my-org","bucket":"test","x":550,"y":200,"wires":[]},{"id":"c84fc911.380cc8","type":"http request","z":"d809a3fb.a012","name":"","method":"use","ret":"txt","paytoqs":true,"url":"","tls":"","proxy":"","authType":"","x":910,"y":160,"wires":[["5feef2d6.857f3c"]]},{"id":"5feef2d6.857f3c","type":"debug","z":"d809a3fb.a012","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":160,"wires":[]},{"id":"6696f7e3.0878c8","type":"function","z":"d809a3fb.a012","name":"API Setup (QNAP00)","func":"// Last updated by Lachlan Magrath on 4/2/2021\n\ntoken = \"rdl4HoV3jPUHdmHmNkM90QCyoolUGs-RSzRTDlxYLoP1g2-h5EiSe0rHJJhkI7-68SGJTlMNDekXldUvhXMrAA==\"; \naddress = \"http://10.0.0.211:19086/api/v2/write\";\norganisation = \"cypernex\";\nbucket = \"hi-res-24h\";\nprecision = \"ms\";\n\nmsg.headers = {};\nmsg.method = \"POST\";\nmsg.url = address+\"?org=\"+organisation+\"&bucket=\"+bucket+\"&precision=\"+precision;\nmsg.headers = {\"Authorization\" : \"Token \" + token}\n\n// 4/3/21. Suggested addition of timestamp. Remove timestamp field.\n// delete msg.timestamp;\n//msg.payload = \"cyper/ESP12S008/,host=host1 mcu/taskschedule05/period=60\";\n//msg.payload = \"testhead,host=host1 meat_percent=64.43234543 1556896326\";\n\nif (msg.payload != [])\n    return msg;\n\nreturn;","outputs":1,"noerr":0,"x":940,"y":80,"wires":[["c84fc911.380cc8"]]},{"id":"b46f131a.79a6","type":"debug","z":"57e9e411.7eb0dc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":970,"y":320,"wires":[]},{"id":"b0f648c4.6e9488","type":"http request","z":"57e9e411.7eb0dc","name":"","method":"use","ret":"txt","paytoqs":true,"url":"","tls":"","proxy":"","authType":"","x":931,"y":260,"wires":[["b46f131a.79a6"]]},{"id":"7155f0ec.27fcb","type":"function","z":"57e9e411.7eb0dc","name":"","func":"\ntoken = \"9JU8UymVL1iZVv2RSclumX8nqk8J85xurNL4_SFzJ00DaNfHItwOlZNyquV4J9yTuUKM-zpDeUAdfsmAulD5oA==\"; \n\nmsg.headers = {};\nmsg.method = \"POST\";\nmsg.url = \"http://10.0.0.211:19086/api/v2/write?org=cypernet&bucket=cyperbucket&precision=s\";\nmsg.headers = {\"Authorization\" : \"Token \" + token}\n\n\nmsg.payload = \"testhead,host=host1 meat_percent=64.43234543 1556896326\";\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":750,"y":280,"wires":[["b0f648c4.6e9488"]]},{"id":"e5a23248.1e332","type":"inject","z":"57e9e411.7eb0dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":790,"y":140,"wires":[["7155f0ec.27fcb"]]},{"id":"19a1351b.93dabb","type":"function","z":"d809a3fb.a012","name":"Split Topic","func":"// Authored by Martin Hannah\n\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\n\n// Update Group-Device Pairs\nconst GDpairs = flow.get(\"GDpairs\") || {};\nif (msg.topic.indexOf('SensorGroup') != -1 && msg.payload != \"undefined\") \n    GDpairs[msg.payload] = flow.get(\"Devicepath\");\n\nelse GDpairs[\"Ungrouped\"] = flow.get(\"Devicepath\");\n\n\nflow.set(\"GDpairs\", GDpairs);\n\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":100,"wires":[["8e1dfa.1a3b3208"]]},{"id":"8e1dfa.1a3b3208","type":"function","z":"d809a3fb.a012","name":"Update Topic Flow Variable ","func":"// Authored by Michael Thompson on 30/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\n// Updates flow array containing all topics\n// May or may not be necessary // \nconst topicArray = flow.get(\"topicArray\") || [];\nif ((topicArray.includes(msg.topic))===false)\n    topicArray.push(msg.topic);\nflow.set(\"topicArray\", topicArray);\n\n// Find group that matches the device, or if none is found it is ungrouped\nGDpairs = flow.get(\"GDpairs\");\ndevice = flow.get(\"Devicepath\");\n\ngroup = Object.keys(GDpairs).find(key => GDpairs[key] === device);\n\n//|| \"Ungrouped\";\n\n// Updates flow variable containing for groups\nconst devices = flow.get(\"devices\") || [];\nif (!(devices.includes(device)))\n    devices.push(device);\nflow.set(\"devices\", devices);\n\n\n// Updates flow variable containing for topics within current group\nconst deviceArray = flow.get(device+\"Array\") || [];\nif (!(deviceArray.includes(msg.topic)) && !msg.topic.includes(\"$\"))\n    deviceArray.push(msg.topic);\nflow.set(device+\"Array\",deviceArray);\n\nconst typeDict = flow.get(\"typeDict\") || {};\nif (typeDict[msg.topic] === undefined && msg.topic.includes(\"$datatype\"))\n    // Assigns datatype to dict entry of topic name (ie without \"/$datatype\" suffix)\n    typeDict[msg.topic.substring(0, msg.topic.indexOf(\"/$datatype\"))] = msg.payload;\nflow.set(\"typeDict\", typeDict);\n\n// Updates flow variable for current group and topic\nif (!(msg.topic.includes(\"$datatype\") && msg.topic.includes(\"SensorGroup\"))) { \n    type = typeDict[msg.topic];\n    if (type == \"float\")\n        value = parseFloat(msg.payload);\n    else if (type == \"integer\" || type == \"boolean\")\n        value = Number(msg.payload);\n    // Quotes added to specify string in line protocol\n    else value = '\"' +String(msg.payload)+ '\"';\n    \n    flow.set(device+msg.topic,\n            {\"value\":value,\n            // Bool for if data is new\n             \"new\":true\n            });\n}","outputs":1,"noerr":0,"x":340,"y":160,"wires":[["c1517fde.bbdba"]]},{"id":"d781a39d.858e3","type":"mqtt in","z":"d809a3fb.a012","name":"ESP","topic":"cyper/#","qos":"2","datatype":"auto","broker":"a0a384b2.b52d18","x":70,"y":100,"wires":[["19a1351b.93dabb","dccad022.4e87d"]]},{"id":"f42cb54f.ddfaf8","type":"debug","z":"d809a3fb.a012","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":200,"wires":[]},{"id":"9065e5c4.7c8528","type":"comment","z":"d809a3fb.a012","name":"Diagnostic: Check for Invalid Code","info":"","x":1340,"y":180,"wires":[]},{"id":"3a155abd.7e5b06","type":"comment","z":"d809a3fb.a012","name":"Diagnostic: Check for Invalid Code","info":"","x":1340,"y":220,"wires":[]},{"id":"32f51f31.d8f5d","type":"comment","z":"d809a3fb.a012","name":"Lachlan Suggestions","info":"","x":1320,"y":120,"wires":[]},{"id":"a87fa168.62a8","type":"change","z":"d809a3fb.a012","name":"Get Timestamp","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":320,"wires":[[]]},{"id":"df21a72d.10664","type":"comment","z":"d809a3fb.a012","name":"Get a Timestamp Change Prototype","info":"","x":1340,"y":280,"wires":[]},{"id":"8e3030ec.747ab","type":"inject","z":"ce33d040.e9c808","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":160,"wires":[["8e44aca.07b545"]]},{"id":"8e44aca.07b545","type":"change","z":"ce33d040.e9c808","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":160,"wires":[["9a518985.cf799"]]},{"id":"9a518985.cf799","type":"debug","z":"ce33d040.e9c808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":160,"wires":[]},{"id":"c1517fde.bbdba","type":"function","z":"d809a3fb.a012","name":"","func":"msg.payload = flow.get(\"typeDict\");\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":280,"wires":[["8b339b6e.aa1d08"]]},{"id":"8b339b6e.aa1d08","type":"debug","z":"d809a3fb.a012","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":350,"y":440,"wires":[]},{"id":"dccad022.4e87d","type":"function","z":"d809a3fb.a012","name":"","func":"if (msg.topic.includes(\"SensorGroup\")) {\n    return msg;\n    \n}\n\nelse return \"\";","outputs":1,"noerr":0,"x":110,"y":160,"wires":[["f42cb54f.ddfaf8"]]},{"id":"769857d2.de85b8","type":"inject","z":"d809a3fb.a012","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":260,"wires":[["c1517fde.bbdba"]]}]