[{"id":"591dd9ab.7a59d8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"3573bb24.cde0e4","type":"tab","label":"Aquaponics 2","disabled":false,"info":""},{"id":"b21b19bd.f3c808","type":"tab","label":"Sensors Test","disabled":false,"info":""},{"id":"5a8764a8.7ffba4","type":"tab","label":"InfluxDB Test","disabled":false,"info":""},{"id":"7cea9793.8d27e8","type":"tab","label":"Aquaponics InfluxDB","disabled":false,"info":""},{"id":"44490660.8eedd8","type":"tab","label":"InfluxDB 2.0","disabled":false,"info":""},{"id":"4436fe60.38ba","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"5756a5d8.353204","type":"tab","label":"Flow 4","disabled":false,"info":""},{"id":"5edcaa92.ff5b64","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"32dcba41.94bc56","type":"tab","label":"Flow 6","disabled":false,"info":""},{"id":"25e1fd8d.6907c2","type":"tab","label":"Lachlan Demo","disabled":false,"info":""},{"id":"cd6480e9.36b42","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"3f65b512.7c0dca","type":"mqtt-broker","z":"","name":"Homeassistant","broker":"10.0.0.228","port":"1883","clientid":"NodeRed_QNAP01","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"991a3fc3.6cf11","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"f9a7ae29.300ab","type":"ui_tab","z":"","name":"Aquaponics","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"cd57739c.7b72b","type":"ui_group","z":"","name":"Power utilization","tab":"f9a7ae29.300ab","order":1,"disp":true,"width":"6","collapse":false},{"id":"d38aadc8.2684a","type":"ui_group","z":"","name":"Fish tank","tab":"f9a7ae29.300ab","order":2,"disp":true,"width":"6","collapse":false},{"id":"2957f818.40e0e8","type":"ui_group","z":"","name":"Garden bed","tab":"f9a7ae29.300ab","order":4,"disp":true,"width":"6","collapse":false},{"id":"6a2b954e.9403cc","type":"ui_group","z":"","name":"Device","tab":"1e0e6b5c.777595","order":5,"disp":true,"width":"6","collapse":false},{"id":"f3a26089.695bf","type":"ui_group","z":"","name":"Environment","tab":"f9a7ae29.300ab","order":5,"disp":true,"width":"6","collapse":false},{"id":"1e0e6b5c.777595","type":"ui_tab","z":"","name":"Settings","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"586cb681.c6da58","type":"ui_group","z":"","name":"Water quality","tab":"f9a7ae29.300ab","order":3,"disp":true,"width":"6","collapse":false},{"id":"388f498e.47cc66","type":"ui_group","z":"","name":"Fish tank","tab":"1e0e6b5c.777595","order":1,"disp":true,"width":"6","collapse":false},{"id":"93c6ee40.12d8e","type":"ui_group","z":"","name":"Garden bed","tab":"1e0e6b5c.777595","order":3,"disp":true,"width":"6","collapse":false},{"id":"f4929820.df1a68","type":"ui_group","z":"","name":"Pumps and water flow","tab":"1e0e6b5c.777595","order":2,"disp":true,"width":"6","collapse":false},{"id":"4d5d785a.b8b5c8","type":"ui_group","z":"","name":"Public area","tab":"1e0e6b5c.777595","order":4,"disp":true,"width":"6","collapse":false},{"id":"59400cbc.ad9914","type":"ui_group","z":"","name":"Default Group","tab":"f785303c.bdca3","order":2,"disp":true,"width":"16","collapse":false},{"id":"e32a32de.81f3c","type":"ui_tab","z":"","name":"Home Tab","icon":"dashboard"},{"id":"95ba7433.526c48","type":"ui_group","z":"","name":"Linear Gauges","tab":"1e0e6b5c.777595","order":1,"disp":true,"width":"12","collapse":false},{"id":"6d55fed0.99c4d","type":"mui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"m-base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"m-page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"m-page-backgroundColor":{"value":"#fafafa","edited":false},"m-page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"m-group-textColor":{"value":"#1bbfff","edited":false},"m-group-borderColor":{"value":"#ffffff","edited":false},"m-group-backgroundColor":{"value":"#ffffff","edited":false},"m-widget-textColor":{"value":"#111111","edited":false},"m-widget-backgroundColor":{"value":"#0094ce","edited":false},"m-widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"f785303c.bdca3","type":"ui_tab","name":"Tab 4","icon":"dashboard","order":4},{"id":"c6ec3727.7b4e88","type":"mqtt-broker","z":"","broker":"iot","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"117b4bcf.df83a4","type":"mqtt-broker","z":"","broker":"iot","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cb4d53be.1a049","type":"ui_group","z":"","name":"Testing","tab":"f9a7ae29.300ab","order":6,"disp":true,"width":"6","collapse":false},{"id":"6ad46b50.f48444","type":"ui_group","z":"","name":"Tweet Details","tab":"cc8cb7a6.eb36b8","order":1,"disp":true,"width":"10"},{"id":"750332bb.86d60c","type":"ui_group","z":"","name":"Tweet Scoreboard","tab":"cc8cb7a6.eb36b8","order":2,"disp":true,"width":"6"},{"id":"cc8cb7a6.eb36b8","type":"ui_tab","z":"","name":"Tweet Scoreboard","icon":"dashboard","order":1},{"id":"d5f42458.8d92e8","type":"ui_group","z":"","name":"Display","tab":"cfac5599.d4e908","order":1,"disp":true,"width":"6","collapse":false},{"id":"cfac5599.d4e908","type":"ui_tab","z":"","name":"Shed","icon":"dashboard","disabled":false,"hidden":false},{"id":"c3a3fadb.8be858","type":"homie-convention-broker-config","z":"","mqtt-host":"10.0.0.228","mqtt-port":"1883","usetls":false,"name":"Homeassistant02","homieName":"ESPloader01","homieFriendlyName":"ESPloader01","homieRoot":"cyper","storeGlobal":true},{"id":"ed8df9d3.fa86c8","type":"ui_tab","z":"","name":"Activity","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"fa02a49c.5f9b78","type":"ui_group","z":"","name":"Process tracking","tab":"ed8df9d3.fa86c8","order":1,"disp":true,"width":"24","collapse":false},{"id":"bce5343f.6ce0e8","type":"ui_group","z":"","name":"Masterswitches","tab":"63525373.bc84ec","order":6,"disp":false,"width":"6","collapse":false},{"id":"b6c00110.14ef3","type":"ui_group","z":"","name":"Condition","tab":"9503250e.b314f8","order":5,"disp":false,"width":"4","collapse":false},{"id":"a3388752.983628","type":"ui_group","z":"","name":"Wind","tab":"9503250e.b314f8","order":4,"disp":false,"width":"4","collapse":false},{"id":"683f9efc.25e54","type":"ui_group","z":"","name":"Luftfeuchtigkeit","tab":"63525373.bc84ec","order":4,"disp":false,"width":"6","collapse":false},{"id":"aba8a6c1.b40d38","type":"ui_group","z":"","name":"Condition","tab":"9503250e.b314f8","order":2,"disp":false,"width":"2","collapse":false},{"id":"71757366.52dffc","type":"ui_group","z":"","name":"Forecast","tab":"9503250e.b314f8","order":6,"disp":false,"width":"8","collapse":false},{"id":"63525373.bc84ec","type":"ui_tab","z":"","name":"Home","icon":"home","order":1},{"id":"9503250e.b314f8","type":"ui_tab","z":"","name":"Wetterstation","icon":"fa-thermometer-half","order":5,"disabled":false,"hidden":false},{"id":"ad5d5bc3.924618","type":"ui_group","z":"","name":"Elektra","tab":"b196b485.eca478","order":8,"disp":true,"width":"6","collapse":false},{"id":"5e048b62.9331c4","type":"ui_group","z":"","name":"Gas","tab":"b196b485.eca478","order":9,"disp":true,"width":"6","collapse":false},{"id":"b196b485.eca478","type":"ui_tab","z":"","name":"Energie","icon":"dashboard","order":1},{"id":"5956881c.ca2098","type":"ui_group","name":"Group 1","tab":"550e4793.62b878","order":1,"disp":true,"width":6},{"id":"550e4793.62b878","type":"ui_tab","name":"Tab 6","icon":"dashboard","order":7},{"id":"82053b62.d688f8","type":"ui_group","z":"","name":"Group 2","tab":"d6835778.ed3218","order":2,"disp":true,"width":"11","collapse":false},{"id":"d6835778.ed3218","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":4},{"id":"b8d8776e.9154d8","type":"ui_group","z":"","name":"Default","tab":"15353a33.dbdcd6","order":1,"disp":true,"width":"12","collapse":false},{"id":"15353a33.dbdcd6","type":"ui_tab","z":"","name":"Home","icon":"home","order":1,"disabled":false,"hidden":false},{"id":"9a25da91.8b5fe8","type":"mqtt-broker","z":"","name":"Homeassistant","broker":"10.0.0.228","port":"1883","clientid":"NodeRed_MTDEV","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"4e8a2667.8785f8","type":"ui_group","z":"","name":"Power utilization","tab":"185af2c8.cc312d","order":1,"disp":true,"width":"6","collapse":false},{"id":"e31c746f.84a938","type":"ui_group","z":"","name":"Water quality","tab":"185af2c8.cc312d","order":3,"disp":true,"width":"6","collapse":false},{"id":"bd5f5e21.d5565","type":"ui_group","z":"","name":"Fish tank","tab":"185af2c8.cc312d","order":2,"disp":true,"width":"6","collapse":false},{"id":"1bc7068b.ec4089","type":"ui_group","z":"","name":"Garden bed","tab":"1de1c0c.b4cea3f","order":1,"disp":true,"width":"6","collapse":false},{"id":"bba88a3a.a55b28","type":"ui_group","z":"","name":"Display","tab":"2f30f26e.38efce","order":2,"disp":true,"width":"6","collapse":false},{"id":"52c2e5e6.07afac","type":"ui_group","z":"","name":"Device","tab":"2f30f26e.38efce","order":1,"disp":true,"width":"6","collapse":false},{"id":"932e20f4.f548f","type":"ui_group","z":"","name":"Uptime","tab":"2f30f26e.38efce","order":4,"disp":true,"width":"6","collapse":false},{"id":"25f093c9.127b7c","type":"ui_group","z":"","name":"Schedulers","tab":"c82e67cd.b90f38","order":1,"disp":true,"width":"11","collapse":false},{"id":"30bda10d.95d4fe","type":"ui_group","z":"","name":"Activity","tab":"2f30f26e.38efce","order":3,"disp":true,"width":"12","collapse":false},{"id":"55956882.5b0c68","type":"ui_group","z":"","name":"Environment","tab":"7d56a335.1333ac","order":5,"disp":true,"width":"6","collapse":false},{"id":"3a188cbf.26d6d4","type":"ui_group","z":"","name":"Public area","tab":"15254741.a68ce9","order":4,"disp":true,"width":"6","collapse":false},{"id":"6bf58d3.5e56e74","type":"ui_group","z":"","name":"Garden bed","tab":"15254741.a68ce9","order":3,"disp":true,"width":"6","collapse":false},{"id":"2caa5220.ee85de","type":"ui_group","z":"","name":"Fish tank","tab":"15254741.a68ce9","order":1,"disp":true,"width":"6","collapse":false},{"id":"35ed29a2.298046","type":"ui_group","z":"","name":"Pumps and water flow","tab":"15254741.a68ce9","order":2,"disp":true,"width":"6","collapse":false},{"id":"b7dae8f3.461b28","type":"ui_group","z":"","name":"Device","tab":"7d56a335.1333ac","order":2,"disp":true,"width":"6","collapse":false},{"id":"54c089ae.995308","type":"ui_group","z":"","name":"Water management","tab":"30ac36b2.8f21ba","order":2,"disp":true,"width":"24","collapse":false},{"id":"9cc28300.1461f","type":"ui_group","z":"","name":"Notes","tab":"c82e67cd.b90f38","order":2,"disp":true,"width":"12","collapse":false},{"id":"2ea0b9ce.170cb6","type":"ui_group","z":"","name":"Light","tab":"7d56a335.1333ac","order":3,"disp":true,"width":"6","collapse":false},{"id":"67f733ab.c2ac0c","type":"ui_group","z":"","name":"Processing","tab":"30ac36b2.8f21ba","order":1,"disp":true,"width":"24","collapse":false},{"id":"1c5fbaaa.f3c935","type":"ui_group","z":"","name":"Activity","tab":"1042946c.87ac0c","order":4,"disp":true,"width":"6","collapse":false},{"id":"185af2c8.cc312d","type":"ui_tab","z":"","name":"Aquaponics","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"1de1c0c.b4cea3f","type":"ui_tab","z":"","name":"Garden Beds","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"2f30f26e.38efce","type":"ui_tab","z":"","name":"Setup","icon":"dashboard","order":8,"disabled":false,"hidden":false},{"id":"c82e67cd.b90f38","type":"ui_tab","z":"","name":"Services","icon":"dashboard","order":9,"disabled":false,"hidden":false},{"id":"7d56a335.1333ac","type":"ui_tab","z":"","name":"Public Areas","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"15254741.a68ce9","type":"ui_tab","z":"","name":"Sensors","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"30ac36b2.8f21ba","type":"ui_tab","z":"","name":"Activity","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"1042946c.87ac0c","type":"ui_tab","z":"","name":"Fish population","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"5ebc675b.e2f8f8","type":"mui_group","z":"","name":"Temp","tab":"","disp":true,"width":"6","collapse":false},{"id":"dbd59a34.7a6fe","type":"ui_tab","z":"","name":"Michael Tests","icon":"dashboard","order":22,"disabled":false,"hidden":false},{"id":"f58bced2.4eda2","type":"ui_group","z":"","name":"Button","tab":"dbd59a34.7a6fe","order":1,"disp":true,"width":"6","collapse":false},{"id":"f4ff1fb3.e42b7","type":"mui_group","name":"Group","tab":"","order":null,"disp":true,"width":6},{"id":"a6595861.690f48","type":"ui_group","z":"","name":"Gauge","tab":"dbd59a34.7a6fe","order":2,"disp":true,"width":"6","collapse":false},{"id":"d2957505.af9a78","type":"ui_group","z":"","name":"JSON Weather","tab":"dbd59a34.7a6fe","order":3,"disp":true,"width":"6","collapse":false},{"id":"af21ad79.8f2e3","type":"ui_tab","z":"","name":"Sensor Tests","icon":"dashboard","order":23,"disabled":false,"hidden":false},{"id":"cf797beb.e118e8","type":"ui_group","z":"","name":"Sensors","tab":"af21ad79.8f2e3","order":1,"disp":true,"width":"6","collapse":false},{"id":"63f8ef6d.31f6f","type":"ui_group","z":"","name":"Linear Gauges","tab":"857704f0.ce3b28","order":1,"disp":true,"width":"12","collapse":false},{"id":"857704f0.ce3b28","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"f676e381.0c13b","type":"ui_group","z":"","name":"Temp 00","tab":"81b768d7.d36c38","order":1,"disp":true,"width":"6","collapse":false},{"id":"81b768d7.d36c38","type":"ui_tab","z":"","name":"Tank Temperatures","icon":"dashboard","order":25,"disabled":false,"hidden":false},{"id":"f81c0809.59ef18","type":"ui_group","z":"","name":"Temp 01","tab":"81b768d7.d36c38","order":2,"disp":true,"width":"6","collapse":false},{"id":"6285c1ce.77a89","type":"ui_group","z":"","name":"Temp 03","tab":"81b768d7.d36c38","order":3,"disp":true,"width":"6","collapse":false},{"id":"f88791ae.770fc","type":"ui_tab","z":"","name":"Reboots","icon":"dashboard","order":26,"disabled":false,"hidden":false},{"id":"d408e358.dd5f7","type":"ui_group","z":"","name":"Reboots","tab":"f88791ae.770fc","order":1,"disp":true,"width":"6","collapse":false},{"id":"e8f7c2ba.f242c","type":"ui_group","z":"","name":"Email","tab":"f88791ae.770fc","order":2,"disp":true,"width":"6","collapse":false},{"id":"550e333f.f59bcc","type":"influxdb","z":"44490660.8eedd8","hostname":"10.0.0.211","port":"31777","protocol":"http","database":"DB_MAIN","name":"","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://10.0.0.211:19086","rejectUnauthorized":false},{"id":"f1f5963d.0fe478","type":"websocket-listener","z":"","path":"https://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb","wholemsg":"false"},{"id":"c0feee47.51da2","type":"ui_tab","z":"","name":"Lachlan","icon":"dashboard","disabled":false,"hidden":false},{"id":"9f6e013a.cea21","type":"ui_group","z":"","name":"Demo","tab":"c0feee47.51da2","order":1,"disp":true,"width":"6","collapse":false},{"id":"3aefa950.5f3f76","type":"Stackhero-InfluxDB-v2-Server","z":"","name":"","host":"10.0.0.211","port":"19086","tls":false},{"id":"e6905514.164d48","type":"influxdb","z":"","hostname":"10.0.0.211","port":"31777","protocol":"http","database":"DB_MAIN","name":"","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://10.0.0.211:19086","rejectUnauthorized":true},{"id":"9e2bcdf4.5d27c","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"database","name":"","usetls":false,"tls":"27cd1db5.4605a2","influxdbVersion":"2.0","url":"https://localhost:9999","rejectUnauthorized":false},{"id":"27cd1db5.4605a2","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false},{"id":"170668fc.b09c67","type":"mqtt-broker","z":"44490660.8eedd8","broker":"localhost","port":"1883","clientid":"node-red","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"76cd9017.cd665","type":"ui_group","z":"","name":"Influx 2.0 API Dashboard","tab":"f9a7ae29.300ab","order":7,"disp":true,"width":"6","collapse":false},{"id":"dd96a9cb.5ecfb8","type":"ui_group","z":"","name":"Col1","tab":"fc56a958.097c68","order":1,"disp":false,"width":"6"},{"id":"ee3641c3.0ca55","type":"ui_group","z":"","name":"Actions","tab":"fc56a958.097c68","order":4,"disp":true,"width":"6"},{"id":"e77c9fa9.d15ff","type":"ui_group","z":"","name":"Col2","tab":"fc56a958.097c68","order":2,"disp":false,"width":"6"},{"id":"b728f77d.0d3218","type":"ui_group","z":"","name":"Col3","tab":"fc56a958.097c68","order":3,"disp":false,"width":"6"},{"id":"fc56a958.097c68","type":"ui_tab","z":"","name":"RPi Control","icon":"dashboard","order":1},{"id":"9721e312.4bc54","type":"inject","z":"591dd9ab.7a59d8","name":"ON","topic":"aa","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":262,"wires":[["ce0bbed5.bfa63"]]},{"id":"73ccca31.10f094","type":"inject","z":"591dd9ab.7a59d8","name":"OFF","topic":"aa","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":342,"wires":[["ce0bbed5.bfa63"]]},{"id":"e9c3fefe.5f03b","type":"ui_gauge","z":"3573bb24.cde0e4","name":"pH","group":"e31c746f.84a938","order":2,"width":0,"height":0,"gtype":"gage","title":"pH","label":"units","format":"{{value}}","min":0,"max":"1000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":610,"y":220,"wires":[]},{"id":"c077922c.0e21a","type":"ui_text","z":"3573bb24.cde0e4","group":"e31c746f.84a938","order":1,"width":0,"height":0,"name":"pH status","label":"pH status","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":260,"wires":[]},{"id":"fc57d4fe.820368","type":"comment","z":"3573bb24.cde0e4","name":"Power Utilization","info":"","x":460,"y":20,"wires":[]},{"id":"8275c87a.f85dc8","type":"comment","z":"3573bb24.cde0e4","name":"Fish tank","info":"","x":620,"y":20,"wires":[]},{"id":"a560b3b6.dfbf5","type":"function","z":"3573bb24.cde0e4","name":"Water","func":"var topic=msg.topic;\nif (topic==\"waterquality/ph\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":22,"noerr":0,"x":130,"y":360,"wires":[["fdaa542c.747458","e9c3fefe.5f03b"],["c077922c.0e21a"],["c697f29e.211a1"],["2d04dc14.f66414"],["893c7db1.cee1b","5a64d9cc.844258","1e0bb082.158fbf","fb495d03.68e64","b5b1617c.2f326"],["7b7ae00b.8f4c9"],["1dacf5e0.b675ba"],[],[],[],[],["df762a63.414cd8"],[],[],[],[],[],["9daca87f.e85cc8","c6ef94e6.595358","fc21544b.d0bbd8"],["9daca87f.e85cc8","c6ef94e6.595358"],["9daca87f.e85cc8","c6ef94e6.595358","fc21544b.d0bbd8"],["9daca87f.e85cc8","c6ef94e6.595358"],["9daca87f.e85cc8"]]},{"id":"2d04dc14.f66414","type":"ui_text","z":"3573bb24.cde0e4","group":"e31c746f.84a938","order":5,"width":0,"height":0,"name":"Turb Temp","label":"Turbidity Temperature","format":"{{msg.payload}}","layout":"row-spread","x":630,"y":380,"wires":[]},{"id":"c697f29e.211a1","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Turbidity","group":"e31c746f.84a938","order":4,"width":0,"height":0,"gtype":"gage","title":"Turbidity","label":"units","format":"{{value}}","min":0,"max":"1000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":620,"y":340,"wires":[]},{"id":"fdaa542c.747458","type":"ui_chart","z":"3573bb24.cde0e4","name":"pH 8Hrs","group":"e31c746f.84a938","order":3,"width":0,"height":0,"label":"pH tracking","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":620,"y":300,"wires":[[],[]]},{"id":"f7c3c15a.e1d96","type":"comment","z":"3573bb24.cde0e4","name":"Garden","info":"","x":830,"y":20,"wires":[]},{"id":"893c7db1.cee1b","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Water temp-Low","group":"bd5f5e21.d5565","order":3,"width":"2","height":"3","gtype":"gage","title":"Bottom","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":640,"y":500,"wires":[]},{"id":"7b7ae00b.8f4c9","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Water temp-Mid","group":"bd5f5e21.d5565","order":4,"width":"2","height":"3","gtype":"gage","title":"Mid","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":640,"y":540,"wires":[]},{"id":"1dacf5e0.b675ba","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Water temp-Upper","group":"bd5f5e21.d5565","order":5,"width":"2","height":"3","gtype":"gage","title":"Surface","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":650,"y":580,"wires":[]},{"id":"13f64d0.d1457b3","type":"comment","z":"3573bb24.cde0e4","name":"Environment","info":"","x":1050,"y":20,"wires":[]},{"id":"5bd8b68f.3a7ae8","type":"sentiment","z":"3573bb24.cde0e4","name":"","property":"payload","x":1040,"y":140,"wires":[[]]},{"id":"f9b74b46.a7b178","type":"sunrise","z":"3573bb24.cde0e4","name":"Daytime","lat":"33.8396","lon":"151.2054","start":"sunrise","end":"sunset","x":100,"y":1280,"wires":[["156e13d5.58ad7c"],["d04ad4bf.9889b8"]]},{"id":"9daca87f.e85cc8","type":"ui_chart","z":"3573bb24.cde0e4","name":"Tank temperatures","group":"bd5f5e21.d5565","order":1,"width":0,"height":0,"label":"Tank Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":650,"y":620,"wires":[[]]},{"id":"70daf02a.11678","type":"function","z":"3573bb24.cde0e4","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":120,"y":620,"wires":[["71db2939.e83468","2d74d9d4.055ac6"],["71db2939.e83468","5f770aa3.6ee634"],["71db2939.e83468","ab849bb3.635f08"],["71db2939.e83468"],["74e8bdef.833794"],["7e0833ab.afdbac"],[],[],["a5d1f949.fa6f88"],["a5d1f949.fa6f88"],[],[]]},{"id":"71db2939.e83468","type":"ui_statechart","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":8,"width":0,"height":0,"name":"Moisture","label":"Moisture","series":"A,B,C,D","showvalues":true,"colorON":"#009933","colorOFF":"#999999","colorFromTheme":true,"fontColorFromTheme":true,"textoptions":"default","colorText":"#eeeeee","fontLabel":"","fontValue":"","fontSeries":"","x":840,"y":140,"wires":[]},{"id":"a5d1f949.fa6f88","type":"ui_chart","z":"3573bb24.cde0e4","name":"Soil temperatures","group":"1bc7068b.ec4089","order":4,"width":0,"height":0,"label":"Soil Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":870,"y":220,"wires":[[],[]]},{"id":"7254354d.4ac9ec","type":"mqtt out","z":"3573bb24.cde0e4","name":"sendMQTT","topic":"","qos":"","retain":"","broker":"9a25da91.8b5fe8","x":2170,"y":560,"wires":[]},{"id":"ef527871.c06cd8","type":"ui_switch","z":"3573bb24.cde0e4","name":"Screensaver","label":"Screensaver","tooltip":"","group":"bba88a3a.a55b28","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"oledDisplay/screensaver/set","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1250,"y":100,"wires":[["3ea3bfe8.6f75d","d19be662.374cd8","3e9e8eb5.340622","c6c2bb14.d82448","f6094fa3.3d322"]]},{"id":"3d4dbd41.5a2fc2","type":"comment","z":"3573bb24.cde0e4","name":"Device","info":"","x":1230,"y":20,"wires":[]},{"id":"9eacf699.c80858","type":"function","z":"3573bb24.cde0e4","name":"MCU","func":"var topic=msg.topic;\nif (topic==\"mcu/heartbeat\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/vcc\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/chipsize\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/freespace\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/ntptime\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/uptime\") {\n    // msg=msg/1000/60;     // Doesnt work !!!\n    ////var payload;\n    ////var d = new Date();\n    ////var t = d.getTime();\n    ////payload={\"time\":t,\"payload\":msg.payload,\"topic\"}\n    ////  //msg.payload=JSON.stringify(payload);\n    ////  //msg.payload=payload;\n    flow.set(\"mcu_uptime\",\"testMsg\");\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule01\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule03\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule04\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule05\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/execlog\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"$state\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/startingup\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"$localip\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"$mac\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"$name\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"$implementation\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"$homie\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg],null;\n}\nif (topic==\"$homie\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":20,"noerr":0,"x":830,"y":680,"wires":[[],["21272306.6b4aec"],["3690689c.70cf58"],["b9543fab.881cd"],["2b6e7f4a.2970e"],["b98b2c57.a8c01","dd240e01.ed055","b11ef38f.5257a"],["2673e56a.078a6a"],["9a09520c.49a03"],["f28cf69d.f9b2c8"],["eba17f06.5e3e5"],["8616d73e.f08d38"],["338ed8f0.27ba78"],["2570b2a2.e2108e","ac5bd322.0dc8a","2f13b53f.55e2da"],["a0ed4c38.7348f","ee3978c6.497f28"],["ca3d6ac7.8a2d68"],["51e2a907.5ac1d8"],["c811b2a7.d4678"],["c3854197.00e8c"],["3a629547.e921ba"],[]]},{"id":"21272306.6b4aec","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":5,"width":0,"height":0,"name":"VCC","label":"VCC","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":260,"wires":[]},{"id":"5a64d9cc.844258","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Internal Temp","group":"52c2e5e6.07afac","order":14,"width":0,"height":0,"gtype":"gage","title":"Internal temperature","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e69d00","#ca3838"],"seg1":"25","seg2":"35","x":1260,"y":860,"wires":[]},{"id":"3690689c.70cf58","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":6,"width":0,"height":0,"name":"Chipsize","label":"Chipsize","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":300,"wires":[]},{"id":"b9543fab.881cd","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":13,"width":0,"height":0,"name":"Freespace","label":"Freespace","format":"{{msg.payload}}","layout":"row-spread","x":1250,"y":340,"wires":[]},{"id":"2b6e7f4a.2970e","type":"ui_text","z":"3573bb24.cde0e4","group":"932e20f4.f548f","order":1,"width":0,"height":0,"name":"NTP time","label":"NTP time","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":380,"wires":[]},{"id":"b98b2c57.a8c01","type":"ui_text","z":"3573bb24.cde0e4","group":"932e20f4.f548f","order":2,"width":0,"height":0,"name":"Uptime","label":"Uptime (Sec)","format":"{{msg.payload}}","layout":"row-spread","x":1240,"y":420,"wires":[]},{"id":"2673e56a.078a6a","type":"ui_switch","z":"3573bb24.cde0e4","name":"TaskScheduler1","label":"TaskScheduler1","tooltip":"","group":"25f093c9.127b7c","order":1,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule01/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":580,"wires":[["f6094fa3.3d322"]]},{"id":"9a09520c.49a03","type":"ui_switch","z":"3573bb24.cde0e4","name":"TaskScheduler2","label":"TaskScheduler2","tooltip":"","group":"25f093c9.127b7c","order":3,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule02/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":620,"wires":[["f6094fa3.3d322"]]},{"id":"f28cf69d.f9b2c8","type":"ui_switch","z":"3573bb24.cde0e4","name":"TaskScheduler3","label":"TaskScheduler3","tooltip":"","group":"25f093c9.127b7c","order":6,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule03/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":660,"wires":[["f6094fa3.3d322"]]},{"id":"eba17f06.5e3e5","type":"ui_switch","z":"3573bb24.cde0e4","name":"TaskScheduler4","label":"TaskScheduler4","tooltip":"","group":"25f093c9.127b7c","order":9,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule04/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":700,"wires":[["f6094fa3.3d322"]]},{"id":"8616d73e.f08d38","type":"ui_switch","z":"3573bb24.cde0e4","name":"TaskScheduler5","label":"TaskScheduler5","tooltip":"","group":"25f093c9.127b7c","order":12,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"mcu/taskschedule05/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":740,"wires":[["f6094fa3.3d322"]]},{"id":"c235895f.41f9a8","type":"function","z":"3573bb24.cde0e4","name":"Environ","func":"var topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":11,"noerr":0,"x":120,"y":800,"wires":[["73e31905.3c7da8"],["69f7e653.ca1738"],["5756e89b.2cdec8"],["4b3ef2eb.f487cc"],["2bc36670.2b210a"],["d8a06570.e2e298"],["1fc5bfb9.708fa"],["ad42aba2.b14e78"],["e78926aa.354e88"],["2364fad4.3b4006"],["649bc383.830f1c"]]},{"id":"338ed8f0.27ba78","type":"ui_list","z":"3573bb24.cde0e4","group":"30bda10d.95d4fe","name":"ExecLog","order":2,"width":0,"height":0,"lineType":"one","actionType":"none","allowHTML":false,"outputs":0,"topic":"","x":1240,"y":780,"wires":[]},{"id":"73e31905.3c7da8","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Noise","group":"55956882.5b0c68","order":2,"width":0,"height":0,"gtype":"gage","title":"Noise levels","label":"units","format":"{{value}}","min":"49","max":"75","colors":["#3ce10e","#eec52f","#cb483a"],"seg1":"55","seg2":"65","x":1030,"y":180,"wires":[]},{"id":"69f7e653.ca1738","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":4,"width":0,"height":0,"name":"Temperature","label":"Temperature","format":"{{msg.payload}}","layout":"row-spread","x":1050,"y":220,"wires":[]},{"id":"5756e89b.2cdec8","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":6,"width":0,"height":0,"name":"Ave Temp","label":"Average Temperature","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":260,"wires":[]},{"id":"4b3ef2eb.f487cc","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":8,"width":0,"height":0,"name":"Humidity","label":"Humidity","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":300,"wires":[]},{"id":"2bc36670.2b210a","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":10,"width":0,"height":0,"name":"ABS Humid","label":"Absolute humidity","format":"{{msg.payload}}","layout":"row-spread","x":1050,"y":340,"wires":[]},{"id":"d8a06570.e2e298","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":11,"width":0,"height":0,"name":"Heat Idx","label":"Heat index","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":380,"wires":[]},{"id":"1fc5bfb9.708fa","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":12,"width":0,"height":0,"name":"Pressure","label":"Air pressure","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":420,"wires":[]},{"id":"ad42aba2.b14e78","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":13,"width":0,"height":0,"name":"Altitude","label":"Altitude","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":460,"wires":[]},{"id":"e78926aa.354e88","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":3,"width":0,"height":0,"name":"UV index","label":"UV index","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":500,"wires":[]},{"id":"2364fad4.3b4006","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":5,"width":0,"height":0,"name":"UV rating","label":"UV rating","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":540,"wires":[]},{"id":"2d74d9d4.055ac6","type":"ui_text","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":1,"width":0,"height":0,"name":"Soil 1","label":"Soil moisture 1","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":260,"wires":[]},{"id":"5f770aa3.6ee634","type":"ui_text","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":2,"width":0,"height":0,"name":"Soil 2","label":"Soil moisture 2","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":300,"wires":[]},{"id":"ab849bb3.635f08","type":"ui_text","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":3,"width":0,"height":0,"name":"Soil 3","label":"Soil moisture 3","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":340,"wires":[]},{"id":"eb5f7f5.7d8368","type":"ui_switch","z":"3573bb24.cde0e4","name":"Proximity","label":"Proximity sensors","tooltip":"","group":"3a188cbf.26d6d4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorproximity/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1340,"wires":[["f6094fa3.3d322"]]},{"id":"9379da6c.fe4f88","type":"ui_switch","z":"3573bb24.cde0e4","name":"Sound","label":"Loudness sensors","tooltip":"","group":"3a188cbf.26d6d4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorsound/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1260,"wires":[["f6094fa3.3d322"]]},{"id":"cb05b6ad.c8a628","type":"ui_switch","z":"3573bb24.cde0e4","name":"UV","label":"UV sensors","tooltip":"","group":"3a188cbf.26d6d4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensoruv/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1300,"wires":[["f6094fa3.3d322"]]},{"id":"4b99b428.80501c","type":"ui_switch","z":"3573bb24.cde0e4","name":"Moisture","label":"Soil moisture","tooltip":"","group":"6bf58d3.5e56e74","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensormoisture/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1380,"wires":[["f6094fa3.3d322"]]},{"id":"f4e360e9.09611","type":"ui_switch","z":"3573bb24.cde0e4","name":"Rainfall","label":"Rainfall sensors","tooltip":"","group":"6bf58d3.5e56e74","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorrainfall/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1420,"wires":[["f6094fa3.3d322"]]},{"id":"956fa254.94e29","type":"ui_switch","z":"3573bb24.cde0e4","name":"Light","label":"Light sensors","tooltip":"","group":"6bf58d3.5e56e74","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorlight/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1460,"wires":[["f6094fa3.3d322"]]},{"id":"76edace.bce2454","type":"ui_switch","z":"3573bb24.cde0e4","name":"Environ","label":"Environment sensors","tooltip":"","group":"6bf58d3.5e56e74","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorenviron/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1500,"wires":[["f6094fa3.3d322"]]},{"id":"238ccd63.f86d22","type":"ui_switch","z":"3573bb24.cde0e4","name":"Air","label":"Air quality","tooltip":"","group":"3a188cbf.26d6d4","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorair/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1290,"y":1540,"wires":[["f6094fa3.3d322"]]},{"id":"ca40bddd.7b2f5","type":"ui_switch","z":"3573bb24.cde0e4","name":"Vibrate","label":"Vibration sensors","tooltip":"","group":"3a188cbf.26d6d4","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorvibrate/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1300,"y":1580,"wires":[["f6094fa3.3d322"]]},{"id":"200a8d94.6d0962","type":"ui_switch","z":"3573bb24.cde0e4","name":"Hydraphone","label":"Hydraphone sensors","tooltip":"","group":"2caa5220.ee85de","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorhydraphone/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1310,"y":1620,"wires":[["f6094fa3.3d322"]]},{"id":"615fdd9.b95b724","type":"ui_switch","z":"3573bb24.cde0e4","name":"Dooropen","label":"Door open sensors","tooltip":"","group":"2caa5220.ee85de","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensordooropen/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1260,"wires":[["f6094fa3.3d322"]]},{"id":"58cb7cfe.4f73f4","type":"ui_switch","z":"3573bb24.cde0e4","name":"Fishfeed","label":"Fishfeed control","tooltip":"","group":"2caa5220.ee85de","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorfishfeed/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1300,"wires":[["f6094fa3.3d322"]]},{"id":"b09671dc.e1289","type":"ui_switch","z":"3573bb24.cde0e4","name":"Power","label":"Power sensors","tooltip":"","group":"35ed29a2.298046","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorpower/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1380,"wires":[["f6094fa3.3d322"]]},{"id":"c737fc9.4f9a5","type":"ui_switch","z":"3573bb24.cde0e4","name":"Waterlevel","label":"Waterlevel sensors","tooltip":"","group":"2caa5220.ee85de","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlevel/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1420,"wires":[["f6094fa3.3d322"]]},{"id":"68783fa9.d2675","type":"ui_switch","z":"3573bb24.cde0e4","name":"Waterflow","label":"Waterflow sensors","tooltip":"","group":"35ed29a2.298046","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlflow/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1460,"wires":[["f6094fa3.3d322"]]},{"id":"ea1bc31c.3747","type":"ui_switch","z":"3573bb24.cde0e4","name":"Thermister","label":"Water temperature sensors","tooltip":"","group":"35ed29a2.298046","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorthermister/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1540,"wires":[["f6094fa3.3d322"]]},{"id":"f3a3b4e3.8c6ef8","type":"ui_switch","z":"3573bb24.cde0e4","name":"pH","label":"pH sensors","tooltip":"","group":"2caa5220.ee85de","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorph/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1580,"wires":[["f6094fa3.3d322"]]},{"id":"2929b261.fa693e","type":"ui_switch","z":"3573bb24.cde0e4","name":"Turbidity","label":"Turbidity sensors","tooltip":"","group":"2caa5220.ee85de","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterlevel/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1480,"y":1620,"wires":[["f6094fa3.3d322"]]},{"id":"b03d2ed5.be4d","type":"ui_switch","z":"3573bb24.cde0e4","name":"Waterqual","label":"Water quality","tooltip":"","group":"2caa5220.ee85de","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorwaterqual/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1490,"y":1500,"wires":[["f6094fa3.3d322"]]},{"id":"b6efd25.e8eb63","type":"function","z":"3573bb24.cde0e4","name":"Sensor2","func":"var topic=msg.topic;\nif (topic===\"mcu/setsensordooropen\") {\nreturn [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorfishfeed\") {\nreturn [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorrelay\") {\nreturn [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorpower\") {\nreturn [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterlevel\") {\nreturn [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterflow\") {\nreturn [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic===\"mcu/setsensorwaterqual\") {\nreturn [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic===\"mcu/setsensorthermister\") {\nreturn [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic===\"mcu/setsensorph\") {\nreturn [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic===\"mcu/setsensorturbidity\") {\nreturn [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":840,"y":1520,"wires":[["615fdd9.b95b724"],["58cb7cfe.4f73f4"],["3a1ef72.e120608"],["b09671dc.e1289"],["c737fc9.4f9a5"],["68783fa9.d2675"],["b03d2ed5.be4d"],["ea1bc31c.3747"],["f3a3b4e3.8c6ef8"],["2929b261.fa693e"]]},{"id":"3a1ef72.e120608","type":"ui_switch","z":"3573bb24.cde0e4","name":"Relays","label":"Relays","tooltip":"","group":"35ed29a2.298046","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mcu/setsensorrelay/set","style":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":1470,"y":1340,"wires":[["f6094fa3.3d322"]]},{"id":"a649ab5d.673128","type":"function","z":"3573bb24.cde0e4","name":"Sensor1","func":"var topic=msg.topic;\nif (topic===\"mcu/setsensorsound\"){\n    return [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensoruv\"){\n    return [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorproximity\"){\n    return [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensormoisture\"){\n    return [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorrainfall\"){\n    return [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic===\"mcu/setsensorlight\"){\n    return [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic===\"mcu/setsensorenviron\"){\n    return [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic===\"mcu/setsensorair\"){\n    return [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic===\"mcu/setsensorvibrate\"){\n    return [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic===\"mcu/setsensorhydraphone\"){\n    return [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":840,"y":1320,"wires":[["9379da6c.fe4f88"],["cb05b6ad.c8a628"],["eb5f7f5.7d8368"],["4b99b428.80501c"],["f4e360e9.09611"],["956fa254.94e29"],["76edace.bce2454"],["238ccd63.f86d22"],["ca40bddd.7b2f5"],["200a8d94.6d0962"]]},{"id":"649bc383.830f1c","type":"function","z":"3573bb24.cde0e4","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":900,"wires":[["da723231.6605"]]},{"id":"da723231.6605","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":9,"width":"0","height":"0","name":"Led","label":"Proximity detection","format":"{{msg.status}}<font color={{msg.color}} ><i class=\"fa fa-circle\" style=\"font-size:24px;\"></i></font>","layout":"row-spread","x":1030,"y":580,"wires":[]},{"id":"ae017a22.23a828","type":"ui_button","z":"3573bb24.cde0e4","name":"Restart","group":"932e20f4.f548f","order":6,"width":0,"height":0,"passthru":false,"label":"Restart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"str","topic":"mcu/restart/set","x":1240,"y":540,"wires":[["80da606.d24caa","c6c2bb14.d82448"]]},{"id":"2570b2a2.e2108e","type":"ui_gauge","z":"3573bb24.cde0e4","name":"WiFiConnection","group":"b7dae8f3.461b28","order":2,"width":"6","height":"3","gtype":"compass","title":"Wifi","label":"","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1060,"y":620,"wires":[]},{"id":"49ad4386.6ff01c","type":"inject","z":"3573bb24.cde0e4","name":"color","topic":"color","payload":"Fire","payloadType":"str","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":1320,"wires":[["946c37f1.cf7518"]]},{"id":"946c37f1.cf7518","type":"trigger","z":"3573bb24.cde0e4","op1":"lime","op2":"white","op1type":"str","op2type":"str","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","name":"color","x":110,"y":1360,"wires":[["dd240e01.ed055","b11ef38f.5257a"]]},{"id":"dd240e01.ed055","type":"join","z":"3573bb24.cde0e4","name":"join","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"","joinerType":"str","accumulate":false,"timeout":"2","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":290,"y":1360,"wires":[["68056043.32f4e","dcb8a690.9c53b8","b204fadf.358478"]]},{"id":"68056043.32f4e","type":"ui_text","z":"3573bb24.cde0e4","group":"932e20f4.f548f","order":5,"width":0,"height":0,"name":"Heartbeat","label":"Heartbeat","format":"{{global.get(\"mcu_uptime\")}}<font color={{msg.payload.color}} ><i class=\"fa fa-circle\" style=\"font-size:24px;\"></i></font>","layout":"row-spread","x":1240,"y":500,"wires":[]},{"id":"2469c323.6d860c","type":"ui_valuetrail","z":"3573bb24.cde0e4","group":"4e8a2667.8785f8","order":5,"width":0,"height":0,"name":"Ph2","label":"","unit":"","blur":true,"minmax":false,"showvalue":false,"decimals":0,"colorLine":"#ff9900","colorFromTheme":true,"stroke":2,"property":"payload","pointcount":8,"x":610,"y":160,"wires":[]},{"id":"5e826026.7f489","type":"function","z":"3573bb24.cde0e4","name":"TrackEvents","func":"var max_duration = .1;\nvar colorArray = ['#FF6633','#4D4D4D','#5DA5DA','#FAA43A','#60BD68','#F17CB0','#B2912F','#B276B2','#DECF3F','#F15854'];\n\n// If cache was passed in, then assume it came from the perist node.\n// Set it in context to restore the chart state\nif(typeof(msg.cache) === \"object\"){\n    context.set('cache',msg.cache);\n}\n\nvar cache = context.get('cache');\nif(typeof(cache) === \"undefined\"){\n    // node.warn(\"Init cache\");\n    cache = {\n        labels: [],\n        datasets: [],\n        \n    }\n}\n\nif(typeof(msg.topic) === \"string\" && typeof(msg.payload) === \"boolean\"){\n    // Begin history tracking\n    // This topic is new so init the object and push it onto the labels and datasets arrays\n    if(cache.labels.indexOf(msg.topic) == -1){\n        // node.warn(\"create new label\");\n        cache.labels.push(msg.topic);\n        \n        cache.datasets.push({\n            label: msg.topic,\n            current: false,\n            timestamp: new Date(),\n            data: []\n        });\n    }\n\n    var thisIndex = cache.labels.indexOf(msg.topic);\n    \n    // The state has changed\n    if(msg.payload != cache.datasets[thisIndex].current){\n        cache.datasets[thisIndex].current = msg.payload;\n        cache.datasets[thisIndex].timestamp = new Date();\n        \n        // Only add a new event if the state switched from false to true\n        if(msg.payload === true){\n            // add a new start/stop event to the topics history\n            var event = [new Date(), new Date(), colorArray[thisIndex]];\n            cache.datasets[thisIndex].data.push(event);\n        }\n    }\n}\n\n\ncache.datasets.forEach(function(topic){\n    // The event is still active so\n    if(topic.current === true && topic.data.length){\n        // Update the event stop time to the current time\n        topic.data[topic.data.length - 1][1] = new Date();\n    }\n    \n\n    topic.data.forEach(function(event, index, object){\n        // cleanup old history (anything with an ending time more than max_duration hours old)\n        if(new Date() - event[1] > max_duration * 3600000){\n            // Delete the event\n            object.splice(index,1);\n        }\n    });\n});\n\n\ncontext.set('cache',cache);\n\nmsg.cache = cache;\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1200,"wires":[["a6bc59b9.08d358"]]},{"id":"a6bc59b9.08d358","type":"ui_template","z":"3573bb24.cde0e4","group":"30bda10d.95d4fe","name":"MCU Events","order":3,"width":"16","height":"9","format":"<script>\nvar ctx = document.getElementById(\"chartjs_timeline_1\").getContext(\"2d\");\n// console.log(scope);\n\n\nscope.chart = new Chart(ctx, {\n    type: 'timeLine',\n    options: {\n        animation: false,\n        responsive: true,\n        colorFunction: function(data){\n            // data is the dataset event point.\n            // The first and second entries are the start/stop date\n            //The third entry specifies the color to use\n            return (typeof data[2] === 'undefined' ? 'black' : data[2]);\n        }\n    },\n    data: {\n        labels: [],\n        datasets: []\n    }\n});\n\n    \n(function(scope){\n    scope.$watch('msg', function(msg) {\n        if(typeof(msg) !== \"object\") return;\n\n        if(typeof(msg.cache) === \"object\"){\n            scope.chart.config.data.labels = msg.cache.labels;\n            scope.chart.config.data.datasets = msg.cache.datasets;\n        }\n\n        //redraw\n        scope.chart.update();\n    });\n})(scope);\n\n</script>\n\n<div style=\"width: 100%;\">\n    <canvas id=\"chartjs_timeline_1\"></canvas>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1310,"y":1200,"wires":[[]]},{"id":"9a3a86c4.6f4c48","type":"ui_template","z":"3573bb24.cde0e4","group":"30bda10d.95d4fe","name":"ChartJS Timeline library(Non Display)","order":1,"width":0,"height":0,"format":"<script>\nconst helpers = Chart.helpers;\nconst isArray = helpers.isArray;\n\nvar time = {\n\t\tunits: [{\n\t\t\tname: 'millisecond',\n\t\t\tsteps: [1, 2, 5, 10, 20, 50, 100, 250, 500]\n\t\t}, {\n\t\t\tname: 'second',\n\t\t\tsteps: [1, 2, 5, 10, 30]\n\t\t}, {\n\t\t\tname: 'minute',\n\t\t\tsteps: [1, 2, 5, 10, 30]\n\t\t}, {\n\t\t\tname: 'hour',\n\t\t\tsteps: [1, 2, 3, 6, 12]\n\t\t}, {\n\t\t\tname: 'day',\n\t\t\tsteps: [1, 2, 3, 5]\n\t\t}, {\n\t\t\tname: 'week',\n\t\t\tmaxStep: 4\n\t\t}, {\n\t\t\tname: 'month',\n\t\t\tmaxStep: 3\n\t\t}, {\n\t\t\tname: 'quarter',\n\t\t\tmaxStep: 4\n\t\t}, {\n\t\t\tname: 'year',\n\t\t\tmaxStep: false\n\t\t}]\n};\n\nvar myConfig = {\n    myTime : {\n        redoLabels: false\n    },\n    position: 'bottom',\n\n    time: {\n        parser: false, // false == a pattern string from http://momentjs.com/docs/#/parsing/string-format/ or a custom callback that converts its argument to a moment\n        format: false, // DEPRECATED false == date objects, moment object, callback or a pattern string from http://momentjs.com/docs/#/parsing/string-format/\n        unit: false, // false == automatic or override with week, month, year, etc.\n        round: false, // none, or override with week, month, year, etc.\n        displayFormat: false, // DEPRECATED\n        isoWeekday: false, // override week start day - see http://momentjs.com/docs/#/get-set/iso-weekday/\n        minUnit: 'millisecond',\n\n        // defaults to unit's corresponding unitFormat below or override using pattern string from http://momentjs.com/docs/#/displaying/format/\n        displayFormats: {\n            millisecond: 'h:mm:ss.SSS a', // 11:20:01.123 AM,\n            second: 'h:mm:ss a', // 11:20:01 AM\n            minute: 'h:mm:ss a', // 11:20:01 AM\n            quarter: '[Q]Q - YYYY', // Q3\n            year: 'YYYY', // 2015        \n            hour: 'MMM D, hA', // Sept 4, 5PM\n            day: 'll', // Sep 4 2015\n            week: 'll', // Week 46, or maybe \"[W]WW - YYYY\" ?\n            month: 'MMM YYYY', // Sept 2015\n            }\n    },\n    ticks: {\n        autoSkip: false\n    }\n};\n\n\nvar myTimeScale = Chart.scaleService.getScaleConstructor('time').extend({\n\n    determineDataLimits: function() {\n        var me = this;\n        me.labelMoments = [];\n\n        // We parse all date labels here, for each entry we parse its initial and end date\n        var scaleLabelMoments = [];\n        if (me.chart.data.datasets && me.chart.data.datasets.length > 0) {\n            helpers.each(me.chart.data.datasets, function(datasets) {\n                var data = datasets.data;\n                var length = data.length;\n                for (var i = 0; i < length; i++) {\n                    // We consider 0 to have initial date\n                    var initialLabelMoment = me.parseTime(data[i][0]);\n                    // we consider 1 to have end date\n                    // TODO maybe add a check to see which one is bigger, but right now i don't know the\n                    // TODO implications off that check\n                    var finalLabelMoment = me.parseTime(data[i][1]);\n                    if (initialLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            initialLabelMoment.startOf(me.options.time.round);\n                        }\n                        scaleLabelMoments.push(initialLabelMoment);\n                    }\n                    if (finalLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            finalLabelMoment.startOf(me.options.time.round);\n                        }\n                        scaleLabelMoments.push(finalLabelMoment);\n                    }\n                }\n            }, me);\n\n            me.firstTick = moment.min.call(me, scaleLabelMoments);\n            me.lastTick = moment.max.call(me, scaleLabelMoments);\n        } else {\n            me.firstTick = null;\n            me.lastTick = null;\n        }\n\n        // In this case label moments are the same as scale moments because this chart only supports\n        // dates as data and not labels like normal time scale. We are doing this to keep\n        // coordination between parent(TimeScale) calls\n        me.labelMoments.push(scaleLabelMoments);\n\n        // Set these after we've done all the data\n        if (me.options.time.min) {\n            me.firstTick = me.parseTime(me.options.time.min);\n        }\n\n        if (me.options.time.max) {\n            me.lastTick = me.parseTime(me.options.time.max);\n        }\n\n        // We will modify these, so clone for later\n        me.firstTick = (me.firstTick || moment()).clone();\n        me.lastTick = (me.lastTick || moment()).clone();\n    },\n    buildLabelDiffs: function() {\n        var me = this;\n        me.labelDiffs = [];\n        var scaleLabelDiffs = [];\n        // Parse common labels once\n        if (me.chart.data.datasets && me.chart.data.datasets.length > 0) {\n            helpers.each(me.chart.data.datasets, function(datasets, datasetIndex) {\n                var data = datasets.data;\n                var length = data.length;\n                for (var i = 0; i < length; i++) {\n                    // We consider 0 to have initial date\n                    var initialLabelMoment = me.parseTime(data[i][0]);\n                    // we consider 1 to have end date\n                    // TODO maybe add a check to see which one is bigger, but right now i don't know the\n                    // TODO implications off that check\n                    var finalLabelMoment = me.parseTime(data[i][1]);\n                    var diff;\n                    if (initialLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                        }\n                        else {\n                            if (me.isInTicks(initialLabelMoment, me.tickUnit))\n                            // No floor needed since we are one of the ticks\n                                diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                            else\n                                diff = initialLabelMoment.diff(me.firstTick, me.tickUnit, true);\n                        }\n                        scaleLabelDiffs.push(diff);\n                    }\n                    if (finalLabelMoment.isValid()) {\n                        if (me.options.time.round) {\n                            // Moment doesn't round on diff anymore\n                            diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                        }\n                        else\n                        {\n                            if (me.isInTicks(finalLabelMoment, me.tickUnit))\n                            // No floor needed since we are one of the ticks\n                                diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, false);\n                            else\n                                diff = finalLabelMoment.diff(me.firstTick, me.tickUnit, true);\n                        }\n                        scaleLabelDiffs.push(diff);\n                    }\n                }\n                me.labelDiffs[datasetIndex] = scaleLabelDiffs;\n                scaleLabelDiffs = [];\n            }, me);\n        }\n\n\n    },\n\n    // This function is different from parent because the second argument of the index inside the array of dates\n    // e.g [initialDate, endDate]. Since we built the diffs in date order, which means that every 2 entries in\n    // me.labelDiffs represent one set of date with initial and end dates by order.\n    getLabelDiff: function (datasetIndex, dateIndex) {\n        var me = this;\n        if (datasetIndex === null || dateIndex === null)\n            return null;\n\n        if (me.labelDiffs === undefined)\n            me.buildLabelDiffs();\n\n        if (me.labelDiffs[datasetIndex] != undefined)\n            return me.labelDiffs[datasetIndex][dateIndex];\n\n        return null;\n    },\n\n    getPixelForValue: function(value, index, datasetIndex) {\n        var me = this;\n        var offset = null;\n        if (index !== undefined && datasetIndex !== undefined) {\n            offset = me.getLabelDiff(datasetIndex, index);\n        }\n\n        if (offset === null) {\n            if (!value || !value.isValid) {\n                // not already a moment object\n                value = me.parseTime(me.getRightValue(value));\n            }\n            if (value && value.isValid && value.isValid()) {\n                offset = value.diff(me.firstTick, me.tickUnit, false);\n            }\n        }\n\n        if (offset !== null) {\n            var decimal = offset !== 0 ? offset / me.scaleSizeInUnits : offset;\n\n            if (me.isHorizontal()) {\n                var valueOffset = (me.width * decimal);\n                return me.left + Math.round(valueOffset);\n            }\n\n            var heightOffset = (me.height * decimal);\n            return me.top + Math.round(heightOffset);\n        }\n    },\n\n    // Checks if some date object is a tickMoment\n    isInTicks: function (date, unit) {\n        var result = false;\n        var length = this.tickMoments.length;\n        var ticks = this.tickMoments;\n        for(var i = 0; i < length; i++)\n        {\n            var tick = ticks[i];\n            if (date.isSame(tick, unit))\n            {\n                result = true;\n                break;\n            }\n        }\n        return result;\n    }\n});\n\n\nChart.scaleService.registerScaleType('myTime', myTimeScale, myConfig);\n\n\n\nChart.controllers.timeLine = Chart.controllers.bar.extend({\n\n    getBarBounds : function (bar) {\n        var vm =   bar._view;\n        var x1, x2, y1, y2;\n\n        x1 = vm.x;\n        x2 = vm.x + vm.width;\n        y1 = vm.y;\n        y2 = vm.y + vm.height;\n\n        return {\n            left : x1,\n            top: y1,\n            right: x2,\n            bottom: y2\n        };\n\n    },\n\n    update: function(reset) {\n        var me = this;\n        var meta = me.getMeta();\n        helpers.each(meta.data, function(rectangle, index) {\n            me.updateElement(rectangle, index, reset);\n        }, me);\n    },\n\n    updateElement: function(rectangle, index, reset) {\n        var me = this;\n        var meta = me.getMeta();\n        var xScale = me.getScaleForId(meta.xAxisID);\n        var yScale = me.getScaleForId(meta.yAxisID);\n        var dataset = me.getDataset();\n        var data = dataset.data[index];\n        var custom = rectangle.custom || {};\n        var datasetIndex = me.index;\n        var rectangleElementOptions = me.chart.options.elements.rectangle;\n\n        rectangle._xScale = xScale;\n        rectangle._yScale = yScale;\n        rectangle._datasetIndex = me.index;\n        rectangle._index = index;\n\n        var ruler = me.getRuler(index);\n\n        if (index !== 0)\n            index = index * 2;\n\n        var x = xScale.getPixelForValue(data, index , datasetIndex);\n        index++;\n        var end = xScale.getPixelForValue(data, index, datasetIndex);\n\n        var y = yScale.getPixelForValue(data, datasetIndex, datasetIndex);\n        var width = end - x;\n        var height = me.calculateBarHeight(ruler);\n        var color = me.chart.options.colorFunction(data);\n\n        // This one has in account the size of the tick and the height of the bar, so we just\n        // divide both of them by two and subtract the height part and add the tick part\n        // to the real position of the element y. The purpose here is to place the bar\n        // in the middle of the tick.\n        var boxY = y + (ruler.tickHeight / 2) - (height / 2);\n\n        // console.log(me.chart.data.labels[index] + ' box x ' + index + ' : ' + x);\n        // console.log(me.chart.data.labels[index] + ' box y ' + index + ' : ' + boxY);\n        rectangle._model = {\n            x: reset ?  x - width : x,   // Top left of rectangle\n            y: boxY , // Top left of rectangle\n            width: width,\n            height: height,\n            base: x + width,\n            backgroundColor: color,\n            borderSkipped: custom.borderSkipped ? custom.borderSkipped : rectangleElementOptions.borderSkipped,\n            borderColor: custom.borderColor ? custom.borderColor : helpers.getValueAtIndexOrDefault(dataset.borderColor, index, rectangleElementOptions.borderColor),\n            borderWidth: custom.borderWidth ? custom.borderWidth : helpers.getValueAtIndexOrDefault(dataset.borderWidth, index, rectangleElementOptions.borderWidth),\n            // Tooltip\n            label: me.chart.data.labels[index],\n            datasetLabel: dataset.label\n        };\n\n\n\n        rectangle.draw = function() {\n            var ctx = this._chart.ctx;\n            var vm = this._view;\n            ctx.fillStyle = vm.backgroundColor;\n            ctx.lineWidth = vm.borderWidth;\n            helpers.drawRoundedRectangle(ctx, vm.x, vm.y, vm.width, vm.height, 1);\n            ctx.fill();\n        };\n\n        rectangle.inXRange = function (mouseX) {\n            var bounds = me.getBarBounds(this);\n            return mouseX >= bounds.left && mouseX <= bounds.right;\n        };\n        rectangle.tooltipPosition = function () {\n            var vm = this.getCenterPoint();\n            return {\n                x: vm.x ,\n                y: vm.y\n            };\n        };\n\n        rectangle.getCenterPoint = function () {\n            var vm = this._view;\n            var x, y;\n            x = vm.x + (vm.width / 2);\n            y = vm.y + (vm.height / 2);\n\n            return {\n                x : x,\n                y : y\n            };\n        };\n\n        rectangle.inRange = function (mouseX, mouseY) {\n            var inRange = false;\n\n            if(this._view)\n            {\n                var bounds = me.getBarBounds(this);\n                inRange = mouseX >= bounds.left && mouseX <= bounds.right &&\n                    mouseY >= bounds.top && mouseY <= bounds.bottom;\n            }\n            return inRange;\n        };\n\n        rectangle.pivot();\n    },\n\n    // From controller.bar\n    getRuler: function(index) {\n        var me = this;\n        var meta = me.getMeta();\n        var yScale = me.getScaleForId(meta.yAxisID);\n        var datasetCount = me.getBarCount();\n\n        var tickHeight;\n        if (yScale.options.type === 'category') {\n            tickHeight = yScale.getPixelForTick(index + 1) - yScale.getPixelForTick(index);\n        } else {\n            // Average width\n            tickHeight = yScale.width / yScale.ticks.length;\n        }\n        var categoryHeight = tickHeight * yScale.options.categoryPercentage;\n        var categorySpacing = (tickHeight - (tickHeight * yScale.options.categoryPercentage)) / 2;\n        var fullBarHeight = categoryHeight / datasetCount;\n\n        if (yScale.ticks.length !== me.chart.data.labels.length) {\n            var perc = yScale.ticks.length / me.chart.data.labels.length;\n            fullBarHeight = fullBarHeight * perc;\n        }\n\n        var barHeight = fullBarHeight * yScale.options.barPercentage;\n        var barSpacing = fullBarHeight - (fullBarHeight * yScale.options.barPercentage);\n\n        return {\n            datasetCount: datasetCount,\n            tickHeight: tickHeight,\n            categoryHeight: categoryHeight,\n            categorySpacing: categorySpacing,\n            fullBarHeight: fullBarHeight,\n            barHeight: barHeight,\n            barSpacing: barSpacing\n        };\n    },\n\n    // From controller.bar\n    getBarCount: function() {\n        var me = this;\n        var barCount = 0;\n        helpers.each(me.chart.data.datasets, function(dataset, datasetIndex) {\n            var meta = me.chart.getDatasetMeta(datasetIndex);\n            if (meta.bar && me.chart.isDatasetVisible(datasetIndex)) {\n                ++barCount;\n            }\n        }, me);\n        return barCount;\n    },\n\n\n    // draw\n    draw: function (ease) {\n        var easingDecimal = ease || 1;\n        var i, len;\n        var metaData = this.getMeta().data;\n        for (i = 0, len = metaData.length; i < len; i++)\n        {\n            metaData[i].transition(easingDecimal).draw();\n        }\n    },\n\n    // From controller.bar\n    calculateBarHeight: function(ruler) {\n        var me = this;\n        var yScale = me.getScaleForId(me.getMeta().yAxisID);\n        if (yScale.options.barThickness) {\n            return yScale.options.barThickness;\n        }\n        return yScale.options.stacked ? ruler.categoryHeight : ruler.barHeight;\n    },\n\n    removeHoverStyle: function(e) {\n        // TODO\n    },\n\n    setHoverStyle: function(e) {\n        // TODO: Implement this\n    }\n\n});\n\n\nChart.defaults.timeLine = {\n\n    colorFunction: function() {\n        return 'black';\n    },\n\n    layout: {\n        padding: {\n            left: 5,\n            right: 5,\n            top: 0\n        }\n    },\n\n    legend: {\n        display: false\n    },\n\n    scales: {\n        xAxes: [{\n            type: 'myTime',\n            position: 'bottom',\n            gridLines: {\n                display: true,\n                offsetGridLines: true,\n                drawBorder: true,\n                drawTicks: true\n            },\n            ticks: {\n                maxRotation: 0\n            },\n            unit: 'day'\n        }],\n        yAxes: [{\n            type: 'category',\n            position: 'left',\n            barThickness : 20,\n            gridLines: {\n                display: true,\n                offsetGridLines: true,\n                drawBorder: true,\n                drawTicks: true\n            }\n        }]\n    },\n    tooltips: {\n        mode: 'single',\n        callbacks: {\n            title: function(tooltipItems, data) {\n                return data.labels[tooltipItems[0].datasetIndex];\n            },\n            label: function(tooltipItem, data) {\n                \n                return [\"Started: \" + moment(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][0]).fromNow(),\n                    \"Duration: \" + moment(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][1]).from(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index][0], true)\n                    ]\n            }\n        }\n    }\n};\n\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":930,"y":1160,"wires":[[]]},{"id":"ac5bd322.0dc8a","type":"change","z":"3573bb24.cde0e4","name":"WiFi-Uptime","rules":[{"t":"change","p":"payload","pt":"msg","from":"ready","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"lost","fromt":"str","to":"false","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"idle","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"WiFi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1420,"wires":[["5e826026.7f489"]]},{"id":"10bcda4e.aa6c86","type":"inject","z":"3573bb24.cde0e4","name":"Redraw","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":1320,"wires":[["5e826026.7f489"]]},{"id":"a0ed4c38.7348f","type":"change","z":"3573bb24.cde0e4","name":"MCU-Startup","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"Startingup","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1460,"wires":[["5e826026.7f489","c52d1137.b27e4","6db504e6.8b62fc","4ebe6410.9d96ec","666781d7.37aea","f7da1dd4.864ba","2cc9b27b.c0c1be"]]},{"id":"2f13b53f.55e2da","type":"ui_text","z":"3573bb24.cde0e4","group":"932e20f4.f548f","order":4,"width":"0","height":"0","name":"WiFi","label":"WiFi status","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":820,"wires":[]},{"id":"d04ad4bf.9889b8","type":"ui_text","z":"3573bb24.cde0e4","group":"55956882.5b0c68","order":7,"width":0,"height":0,"name":"","label":"Daytime","format":"{{msg.payload}}","layout":"row-spread","x":280,"y":1280,"wires":[]},{"id":"156e13d5.58ad7c","type":"debug","z":"3573bb24.cde0e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":1240,"wires":[]},{"id":"47ad3f05.cb88b","type":"ui_text","z":"3573bb24.cde0e4","group":"932e20f4.f548f","order":3,"width":0,"height":0,"name":"Laststartup","label":"Last startup","format":"{{msg.payload.Datetime}}","layout":"row-spread","x":850,"y":1420,"wires":[]},{"id":"ca8fdd30.cf214","type":"inject","z":"3573bb24.cde0e4","name":"Timestamp","topic":"Datetime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1460,"wires":[["10fac47.9a68d3c"]]},{"id":"ee3978c6.497f28","type":"join","z":"3573bb24.cde0e4","name":"Join","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":290,"y":1500,"wires":[["cc7b79d1.cf2108"]]},{"id":"cc7b79d1.cf2108","type":"switch","z":"3573bb24.cde0e4","name":"Is Startup?","property":"payload.cyper/ESPloader01/mcu/startingup","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":1500,"wires":[["47ad3f05.cb88b","10172c90.ca7ce3"]]},{"id":"3ea3bfe8.6f75d","type":"change","z":"3573bb24.cde0e4","name":"Screensaver","rules":[{"t":"set","p":"topic","pt":"msg","to":"Screensaver","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1260,"wires":[["5e826026.7f489"]]},{"id":"aa27d52b.6d8ac8","type":"change","z":"3573bb24.cde0e4","name":"Heartbeat","rules":[{"t":"change","p":"payload.color","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload.color","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"Heartbeat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1580,"wires":[["1889f8eb.46ac17"]]},{"id":"dcb8a690.9c53b8","type":"change","z":"3573bb24.cde0e4","name":"chg","rules":[{"t":"change","p":"payload","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1540,"wires":[[]]},{"id":"b11ef38f.5257a","type":"switch","z":"3573bb24.cde0e4","name":"UpPing","property":"payload.cyper/ESPl12S006/mcu/uptime","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":1540,"wires":[["aa27d52b.6d8ac8"]]},{"id":"1889f8eb.46ac17","type":"change","z":"3573bb24.cde0e4","name":"Swap2Bool","rules":[{"t":"change","p":"payload","pt":"msg","from":"lime","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"white","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":1580,"wires":[["5e826026.7f489"]]},{"id":"ca3d6ac7.8a2d68","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":9,"width":0,"height":0,"name":"IP","label":"Local IP","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":660,"wires":[]},{"id":"51e2a907.5ac1d8","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":10,"width":0,"height":0,"name":"Mac","label":"MAC","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":700,"wires":[]},{"id":"c811b2a7.d4678","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":7,"width":0,"height":0,"name":"Name","label":"Name","format":"{{msg.payload}}","layout":"row-spread","x":1030,"y":740,"wires":[]},{"id":"3a629547.e921ba","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":12,"width":0,"height":0,"name":"HomieStd","label":"MQTT Standard","format":"{{msg.payload}}","layout":"row-spread","x":1040,"y":780,"wires":[]},{"id":"64f0c72d.a24328","type":"e-mail","z":"3573bb24.cde0e4","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"mhannah@cypernet.com","dname":"MH-gmail","x":2020,"y":780,"wires":[]},{"id":"1e0bb082.158fbf","type":"sum-bars","z":"3573bb24.cde0e4","name":"sum-bars","title":"Sum: Water temperature - Lower","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showSumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":1,"x":1460,"y":140,"wires":[["65f5a9aa.eabcb8"]]},{"id":"fb495d03.68e64","type":"average-bars","z":"3573bb24.cde0e4","name":"average-bars","title":"Average: Water temperature - Mid tank","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":1,"x":1470,"y":200,"wires":[["6db6bd0b.a2fc74"]]},{"id":"65f5a9aa.eabcb8","type":"ui_template","z":"3573bb24.cde0e4","group":"54c089ae.995308","name":"TankTemp-Lower","order":6,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1650,"y":140,"wires":[[]]},{"id":"6db6bd0b.a2fc74","type":"ui_template","z":"3573bb24.cde0e4","group":"54c089ae.995308","name":"TankTemp-Mid1","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":200,"wires":[[]]},{"id":"b5b1617c.2f326","type":"average-bars","z":"3573bb24.cde0e4","name":"average-bars","title":"Average: Water temperature - Mid tank2","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":30,"topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Equalizer","decimal":1,"x":1470,"y":240,"wires":[["1615639d.0f921c"]]},{"id":"1615639d.0f921c","type":"ui_template","z":"3573bb24.cde0e4","group":"54c089ae.995308","name":"TankTemp-Mid2","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":240,"wires":[[]]},{"id":"1ef2117b.8d927f","type":"comment","z":"3573bb24.cde0e4","name":"Analytics","info":"","x":1460,"y":20,"wires":[]},{"id":"c3854197.00e8c","type":"ui_text","z":"3573bb24.cde0e4","group":"52c2e5e6.07afac","order":8,"width":0,"height":0,"name":"MCU","label":"MCU","format":"{{msg.payload}}","layout":"row-spread","x":1230,"y":460,"wires":[]},{"id":"5ce2c65b.69a928","type":"ui_template","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","name":"TankTemp-Mid2","order":7,"width":"0","height":"0","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":300,"wires":[[]]},{"id":"df762a63.414cd8","type":"ui_gauge","z":"3573bb24.cde0e4","name":"","group":"bd5f5e21.d5565","order":2,"width":0,"height":0,"gtype":"wave","title":"Fish tank","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":620,"y":660,"wires":[]},{"id":"74e8bdef.833794","type":"ui_text","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":5,"width":0,"height":0,"name":"Rainresidual1","label":"RainResidual1","format":"{{msg.payload}}","layout":"row-spread","x":860,"y":380,"wires":[]},{"id":"7e0833ab.afdbac","type":"ui_text","z":"3573bb24.cde0e4","group":"1bc7068b.ec4089","order":6,"width":0,"height":0,"name":"Rainresidual2","label":"RainResidual2","format":"{{msg.payload}}","layout":"row-spread","x":860,"y":420,"wires":[]},{"id":"80da606.d24caa","type":"twitter out","z":"3573bb24.cde0e4","twitter":"","name":"Tweet","x":2010,"y":740,"wires":[]},{"id":"e88a2d3d.367cf","type":"queue","z":"3573bb24.cde0e4","name":"","connected":"^connected","connectedType":"re","disconnected":"","disconnectedType":"str","sqlite":"queue00.sqlite","x":2010,"y":560,"wires":[["7254354d.4ac9ec","da649645.840258"]]},{"id":"eeef801c.e2073","type":"status","z":"3573bb24.cde0e4","name":"","scope":["7254354d.4ac9ec"],"x":1860,"y":560,"wires":[["e88a2d3d.367cf"]]},{"id":"60e2accd.ad2314","type":"delay","z":"3573bb24.cde0e4","name":"process","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2020,"y":480,"wires":[["9330743a.e70f68","e88a2d3d.367cf"]]},{"id":"9330743a.e70f68","type":"function","z":"3573bb24.cde0e4","name":"get next","func":"node.send({topic: \"control\", payload: \"drop\"})\nmsg.topic = \"control\"\nmsg.payload = \"peek\"\nreturn msg;","outputs":1,"noerr":0,"x":2180,"y":480,"wires":[["fa658a76.ee36f8"]]},{"id":"f8547c17.1565d","type":"link in","z":"3573bb24.cde0e4","name":"","links":["fa658a76.ee36f8"],"x":2055,"y":440,"wires":[["3945d8a5.0a8428"]]},{"id":"3945d8a5.0a8428","type":"q-gate","z":"3573bb24.cde0e4","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":1850,"y":420,"wires":[["60e2accd.ad2314"]]},{"id":"fa658a76.ee36f8","type":"link out","z":"3573bb24.cde0e4","name":"","links":["f8547c17.1565d"],"x":1975,"y":440,"wires":[]},{"id":"fc3f367e.41cac8","type":"status","z":"3573bb24.cde0e4","name":"","scope":null,"x":1040,"y":860,"wires":[[]]},{"id":"1ca0d436.d8357c","type":"ui_switch","z":"3573bb24.cde0e4","name":"","label":"Enable Dimmer","tooltip":"","group":"bba88a3a.a55b28","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"oledDisplay/dim/set","style":"","onvalue":"50","onvalueType":"str","onicon":"","oncolor":"","offvalue":"false","offvalueType":"str","officon":"","offcolor":"","x":1260,"y":180,"wires":[["b53c08f0.597c08","c6c2bb14.d82448"]]},{"id":"d19be662.374cd8","type":"function","z":"3573bb24.cde0e4","name":"","func":"\nif(typeof(msg.payload) === \"boolean\"){\n    if (msg.payload === true){\n        msg.payload = false;\n    }\n    else {\n        //msg.payload = true;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":100,"wires":[[]]},{"id":"b53c08f0.597c08","type":"ui_slider","z":"3573bb24.cde0e4","name":"LCD Dim level","label":"Dimmer","tooltip":"LCD automatic dimmer level","group":"bba88a3a.a55b28","order":4,"width":0,"height":0,"passthru":true,"outs":"end","topic":"oledDisplay/dim/set","min":"25","max":"75","step":"25","x":1260,"y":220,"wires":[["c6c2bb14.d82448"]]},{"id":"3e9e8eb5.340622","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Screensaver delay","label":"Delay","tooltip":"Screen saver delay","place":"Select option","group":"bba88a3a.a55b28","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"2 Seconds","value":"2","type":"str"},{"label":"10 seconds","value":10,"type":"num"},{"label":"120 seconds","value":120,"type":"num"},{"label":"5 minutes","value":"300","type":"str"},{"label":"20 minutes","value":"1200","type":"str"},{"label":"1 hour","value":"3600","type":"str"}],"payload":"","topic":"oledDisplay/screensaverdelay/set","x":1270,"y":140,"wires":[["c6c2bb14.d82448"]]},{"id":"d1837ab4.71eed8","type":"function","z":"3573bb24.cde0e4","name":"EmailContent","func":"var Devicepath = flow.get(\"Devicepath\");\nmsg = {\n    payload: \"The email body here at Date: \" + Date().toString() + \", my explanation e.g. water level now at  \" + msg.payload + \"%\",\n    topic: \"RESTARTING: The email subject line - Devicepath: \" + Devicepath,\n    to: \"producteval@cypernet.com\",\n    cc: \"producteval@cypernet.com\",\n    bcc: \"\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":880,"wires":[["3de6c85d.d9afc8"]]},{"id":"701d293e.9137d8","type":"inject","z":"3573bb24.cde0e4","name":"TestEmail","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1700,"y":920,"wires":[["d1837ab4.71eed8"]]},{"id":"63702386.78d18c","type":"gate","z":"3573bb24.cde0e4","name":"MQTTGate","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","persist":false,"x":1870,"y":480,"wires":[["3945d8a5.0a8428"]]},{"id":"3de6c85d.d9afc8","type":"e-mail","z":"3573bb24.cde0e4","server":"mail.cypernet.com","port":"25","secure":false,"tls":false,"name":"","dname":"MH","x":2010,"y":880,"wires":[]},{"id":"c52d1137.b27e4","type":"change","z":"3573bb24.cde0e4","name":"EnableGate","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"close","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"open","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"close","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"open","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":1120,"wires":[["63702386.78d18c"]]},{"id":"da649645.840258","type":"debug","z":"3573bb24.cde0e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2170,"y":640,"wires":[]},{"id":"6db504e6.8b62fc","type":"trigger","z":"3573bb24.cde0e4","op1":"false","op2":"0","op1type":"bool","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","name":"Set low","x":1040,"y":100,"wires":[["ef527871.c06cd8"]]},{"id":"8adec27a.93379","type":"comment","z":"3573bb24.cde0e4","name":"Disable Commands till after Startup","info":"","x":1940,"y":520,"wires":[]},{"id":"c396a84a.36a3d8","type":"function","z":"3573bb24.cde0e4","name":"Light","func":"var topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n}","outputs":4,"noerr":0,"x":110,"y":960,"wires":[["e9eaa9c1.494ac8"],["9054986d.918fc8","f40fa83a.fcd0e8"],[],[]]},{"id":"4ebe6410.9d96ec","type":"function","z":"3573bb24.cde0e4","name":"ui-disable","func":"if (typeof(msg.payload) === \"boolean\"){\n    msg.enabled = !msg.payload;\n   // if (msg.payload === true){\n    //    msg.payload.enable = false;\n   // }\n    //else {\n    //    msg.enabled = true;\n    //}\n}\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":940,"wires":[["b53c08f0.597c08","ae017a22.23a828","2673e56a.078a6a","9a09520c.49a03","f28cf69d.f9b2c8","eba17f06.5e3e5","8616d73e.f08d38","1ca0d436.d8357c","3e9e8eb5.340622","666781d7.37aea","9379da6c.fe4f88","cb05b6ad.c8a628","eb5f7f5.7d8368","4b99b428.80501c","f4e360e9.09611","956fa254.94e29","76edace.bce2454","238ccd63.f86d22","ca40bddd.7b2f5","200a8d94.6d0962","615fdd9.b95b724","58cb7cfe.4f73f4","3a1ef72.e120608","b09671dc.e1289","c737fc9.4f9a5","68783fa9.d2675","b03d2ed5.be4d","ea1bc31c.3747","f3a3b4e3.8c6ef8","2929b261.fa693e","be030b2d.f7f1f8","9bbcfa4.b496b08","2a9e16b.20528ea","678501b.ce7e6","fe9ba17.602856","14841a3b.1765d6","7bbeb4c2.2a73fc","4b2afc48.d59f64","8723876f.e88be8","3dd91fe4.622ca"]]},{"id":"666781d7.37aea","type":"debug","z":"3573bb24.cde0e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1200,"y":1000,"wires":[]},{"id":"be030b2d.f7f1f8","type":"ui_numeric","z":"3573bb24.cde0e4","name":"Period_Sched1","label":"cycles every","tooltip":"Scheduler starts every","group":"25f093c9.127b7c","order":2,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule01/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":580,"wires":[["f6094fa3.3d322"]]},{"id":"9bbcfa4.b496b08","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Slice1","label":":","tooltip":"","place":"Select option","group":"25f093c9.127b7c","order":15,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule01/timeslice/set","x":1710,"y":580,"wires":[["f6094fa3.3d322"]]},{"id":"2a9e16b.20528ea","type":"ui_numeric","z":"3573bb24.cde0e4","name":"Period_Sched2","label":"cycles every","tooltip":"Scheduler starts every","group":"25f093c9.127b7c","order":4,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule02/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":620,"wires":[["f6094fa3.3d322"]]},{"id":"678501b.ce7e6","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Slice2","label":":","tooltip":"","place":"Select option","group":"25f093c9.127b7c","order":5,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule02/timeslice/set","x":1710,"y":620,"wires":[["f6094fa3.3d322"]]},{"id":"fe9ba17.602856","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Slice3","label":":","tooltip":"","place":"Select option","group":"25f093c9.127b7c","order":8,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule03/timeslice/set","x":1710,"y":660,"wires":[["f6094fa3.3d322"]]},{"id":"14841a3b.1765d6","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Slice4","label":":","tooltip":"","place":"Select option","group":"25f093c9.127b7c","order":11,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule04/timeslice/set","x":1710,"y":700,"wires":[["f6094fa3.3d322"]]},{"id":"7bbeb4c2.2a73fc","type":"ui_dropdown","z":"3573bb24.cde0e4","name":"Slice5","label":":","tooltip":"","place":"Select option","group":"25f093c9.127b7c","order":14,"width":"3","height":"1","passthru":true,"options":[{"label":"seconds","value":"sec","type":"str"},{"label":"minutes","value":"min","type":"str"},{"label":"hours","value":"hour","type":"str"}],"payload":"","topic":"mcu/taskschedule05/timeslice/set","x":1710,"y":740,"wires":[["f6094fa3.3d322"]]},{"id":"4b2afc48.d59f64","type":"ui_numeric","z":"3573bb24.cde0e4","name":"Period_Sched3","label":"cycles every","tooltip":"Scheduler starts every","group":"25f093c9.127b7c","order":7,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule03/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":660,"wires":[["f6094fa3.3d322"]]},{"id":"8723876f.e88be8","type":"ui_numeric","z":"3573bb24.cde0e4","name":"Period_Sched4","label":"cycles every","tooltip":"Scheduler starts every","group":"25f093c9.127b7c","order":10,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule04/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":700,"wires":[["f6094fa3.3d322"]]},{"id":"3dd91fe4.622ca","type":"ui_numeric","z":"3573bb24.cde0e4","name":"Period_Sched5","label":"cycles every","tooltip":"Scheduler starts every","group":"25f093c9.127b7c","order":13,"width":"4","height":"1","passthru":true,"topic":"mcu/taskschedule05/period/set","format":"{{value}}","min":"1","max":"100","step":1,"x":1520,"y":740,"wires":[["f6094fa3.3d322"]]},{"id":"cf1e4ceb.f9f3d","type":"function","z":"3573bb24.cde0e4","name":"Schedules","func":"var topic=msg.topic;\nif (topic==\"mcu/taskschedule01/period\") {\nreturn [msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02/period\") {\nreturn [null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule03/period\") {\nreturn [null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule04/period\") {\nreturn [null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule05/period\") {\nreturn [null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule01/timeslice\") {\nreturn [null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"mcu/taskschedule02/timeslice\") {\nreturn [null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"mcu/taskschedule03/timeslice\") {\nreturn [null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"mcu/taskschedule04/timeslice\") {\nreturn [null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/taskschedule05/timeslice\") {\nreturn [null,null,null,null,null,null,null,null,null,msg];\n}","outputs":10,"noerr":0,"x":630,"y":780,"wires":[["be030b2d.f7f1f8"],["2a9e16b.20528ea"],["4b2afc48.d59f64"],["8723876f.e88be8"],["3dd91fe4.622ca"],["9bbcfa4.b496b08"],["678501b.ce7e6"],["fe9ba17.602856"],["14841a3b.1765d6"],["7bbeb4c2.2a73fc"]]},{"id":"ed4efe3f.2659c","type":"ui_text","z":"3573bb24.cde0e4","group":"9cc28300.1461f","order":16,"width":"11","height":"1","name":"Note 1)","label":"1)","format":"Default settings are those most suited to this MCUs speed and available flash memory","layout":"row-left","x":1700,"y":520,"wires":[]},{"id":"604c1084.d91a7","type":"ui_text","z":"3573bb24.cde0e4","group":"9cc28300.1461f","order":16,"width":"11","height":"1","name":"Note 2)","label":"2)","format":"This ESP8266 MCU is a single threaded device, when adding additional task schedulers ensure tasks in a scheduler wil complete before the end of each cycle to ensure schedules dont overlap.","layout":"row-left","x":1700,"y":540,"wires":[]},{"id":"4ba8458e.0a330c","type":"ui_text","z":"3573bb24.cde0e4","group":"9cc28300.1461f","order":16,"width":"11","height":"1","name":"Note 3)","label":"3)","format":"After restart or updating NodeRed the MCU will take a few minutes to refresh with current operational settings.","layout":"row-left","x":1700,"y":560,"wires":[]},{"id":"4555acde.1e82b4","type":"ui_chart","z":"3573bb24.cde0e4","name":"Illuminance","group":"2ea0b9ce.170cb6","order":2,"width":0,"height":0,"label":"Illuminance","chartType":"polar-area","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":590,"y":980,"wires":[[],[]]},{"id":"e39195da.f56628","type":"ui_chart","z":"3573bb24.cde0e4","name":"AmbientLight","group":"2ea0b9ce.170cb6","order":1,"width":0,"height":0,"label":"Ambient light","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":590,"y":940,"wires":[[]]},{"id":"9054986d.918fc8","type":"delay","z":"3573bb24.cde0e4","name":"Diz","pauseType":"random","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"100","randomLast":"1200","randomUnits":"milliseconds","drop":false,"x":150,"y":1060,"wires":[["9ee32f5.4c1ecd"]]},{"id":"9ee32f5.4c1ecd","type":"change","z":"3573bb24.cde0e4","name":"Diz","rules":[{"t":"set","p":"topic","pt":"msg","to":"Dizolvation","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":980,"wires":[["4555acde.1e82b4","9d0533.4f29dad"]]},{"id":"9d0533.4f29dad","type":"ui_chart","z":"3573bb24.cde0e4","name":"Comparison","group":"2ea0b9ce.170cb6","order":2,"width":0,"height":0,"label":"Comparison","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":590,"y":1020,"wires":[[],[]]},{"id":"e9eaa9c1.494ac8","type":"change","z":"3573bb24.cde0e4","name":"A","rules":[{"t":"change","p":"topic","pt":"msg","from":"cyper/ESPloader01/light/ambientlight","fromt":"str","to":"Ambient","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":940,"wires":[["9d0533.4f29dad","e39195da.f56628","4555acde.1e82b4"]]},{"id":"f40fa83a.fcd0e8","type":"change","z":"3573bb24.cde0e4","name":"Illum","rules":[{"t":"change","p":"topic","pt":"msg","from":"cyper/ESPloader01/light/illuminance","fromt":"str","to":"Illuminance","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1020,"wires":[["4555acde.1e82b4","9d0533.4f29dad"]]},{"id":"f7da1dd4.864ba","type":"trigger","z":"3573bb24.cde0e4","op1":"true","op2":"true","op1type":"bool","op2type":"bool","duration":"0","extend":false,"units":"ms","reset":"false","bytopic":"all","name":"Notify","x":1690,"y":880,"wires":[["d1837ab4.71eed8","2cc9b27b.c0c1be","780b2ac6.143534"]]},{"id":"a2191b43.f745d8","type":"ui_template","z":"3573bb24.cde0e4","group":"67f733ab.c2ac0c","name":"Processes","order":6,"width":"24","height":"4","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1630,"y":340,"wires":[[]]},{"id":"dd622511.64b068","type":"sum-bars","z":"3573bb24.cde0e4","name":"sum-bars","title":"Activity by process","period":"topic","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showSumValue":true,"maxBar":30,"topColor":"#ffea05","bottomColor":"#0008ff","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":"0","x":1460,"y":340,"wires":[["a2191b43.f745d8"]]},{"id":"d8cc954f.965c88","type":"change","z":"3573bb24.cde0e4","name":"MoveTopics","rules":[{"t":"move","p":"payload","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1140,"wires":[["dd622511.64b068"]]},{"id":"a7f5220.9941ee","type":"split","z":"3573bb24.cde0e4","name":"splitExeclog","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":290,"y":1140,"wires":[["d8cc954f.965c88"]]},{"id":"9dc8f29f.58f03","type":"function","z":"3573bb24.cde0e4","name":"Misc","func":"var topic=msg.topic;\nif (topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n        msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n        //msg.payload = msg.payload.replace(\",\",'\\n');\n        msg.payload = msg.payload.replace(\"zzStart,\",'');\n        msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n        msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n        msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n        msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n        msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n        msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n        msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n        msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n        msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n        msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n        msg.payload = msg.payload.replace(\"BME\",'BMP280');\n        msg.payload = msg.payload.replace(/read/g,'');\nreturn [msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":110,"y":1180,"wires":[["a7f5220.9941ee","99365d15.a6b22","350f88fe.663608"],[],[],[],["d4ce128d.d8749"],["83ac13ae.32973"],["9e45d8ee.67a318"],[]]},{"id":"a025966f.84d488","type":"ui_template","z":"3573bb24.cde0e4","group":"67f733ab.c2ac0c","name":"AveProcesses","order":6,"width":"24","height":"4","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1640,"y":380,"wires":[[]]},{"id":"63a862bd.2688bc","type":"average-bars","z":"3573bb24.cde0e4","name":"average-bars","title":"","period":"hour","yMin":"auto","yMax":"auto","showBarsValue":true,"showScaleValue":true,"showLastValue":true,"showAverageValue":true,"showMinimumValue":true,"showMaximumValue":true,"maxBar":"12","topColor":"#ff0000","bottomColor":"#ffff00","unit":"","fontColor":"#aaaaaa","barStyle":"Rectangle","decimal":"0","x":1470,"y":380,"wires":[["a025966f.84d488"]]},{"id":"99365d15.a6b22","type":"function","z":"3573bb24.cde0e4","name":"Qty","func":"var count = msg.payload.length;\nmsg.topic = \"TaskCount\";\nmsg.payload = count;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1180,"wires":[["63a862bd.2688bc","350f88fe.663608"]]},{"id":"2cc9b27b.c0c1be","type":"debug","z":"3573bb24.cde0e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1870,"y":980,"wires":[]},{"id":"c6ef94e6.595358","type":"ui_chart","z":"3573bb24.cde0e4","name":"Water temp","group":"54c089ae.995308","order":3,"width":"24","height":"4","label":"Tank temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"7","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1470,"y":420,"wires":[[],[]]},{"id":"d095ea75.96dda8","type":"ui_chart","z":"3573bb24.cde0e4","name":"Restarts","group":"67f733ab.c2ac0c","order":3,"width":"24","height":"4","label":"Restarts","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"No restarts recorded at this time","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1460,"y":460,"wires":[[],[]]},{"id":"6c01b6f5.8b8518","type":"change","z":"3573bb24.cde0e4","name":"AddResetCount","rules":[{"t":"set","p":"restart_count","pt":"flow","to":"$flowContext(\"restart_count\")+1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1860,"y":820,"wires":[[]]},{"id":"fb667a8f.e98a38","type":"inject","z":"3573bb24.cde0e4","name":"15Min","topic":"Timeslot","payload":"","payloadType":"date","repeat":"900","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":1100,"wires":[["9d520e14.cdc1b"]]},{"id":"9d520e14.cdc1b","type":"change","z":"3573bb24.cde0e4","name":"SendCount","rules":[{"t":"set","p":"payload","pt":"msg","to":"restart_count","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1100,"wires":[["55935e67.f8a02","d095ea75.96dda8"]]},{"id":"55935e67.f8a02","type":"change","z":"3573bb24.cde0e4","name":"ResetCount","rules":[{"t":"set","p":"restart_count","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":1100,"wires":[[]]},{"id":"e74cce5f.34a7e","type":"inject","z":"3573bb24.cde0e4","name":"dd","topic":"dd","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1830,"y":1260,"wires":[["e06c68a5.86d728","f7da1dd4.864ba"]]},{"id":"e06c68a5.86d728","type":"trigger","z":"3573bb24.cde0e4","op1":"true","op2":"true","op1type":"bool","op2type":"bool","duration":"0","extend":false,"units":"ms","reset":"false","bytopic":"all","name":"Notify","x":1890,"y":1100,"wires":[[]]},{"id":"abae6759.71d5a8","type":"inject","z":"3573bb24.cde0e4","name":"dd","topic":"dd","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1830,"y":1320,"wires":[["e06c68a5.86d728","2fc28f63.969ca","f7da1dd4.864ba"]]},{"id":"350f88fe.663608","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1750,"y":1400,"wires":[]},{"id":"2fc28f63.969ca","type":"change","z":"3573bb24.cde0e4","name":"SendCount","rules":[{"t":"set","p":"payload","pt":"msg","to":"restart_count","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2050,"y":1180,"wires":[[]]},{"id":"780b2ac6.143534","type":"switch","z":"3573bb24.cde0e4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1710,"y":820,"wires":[["6c01b6f5.8b8518"]]},{"id":"b29233cb.04e8f","type":"comment","z":"3573bb24.cde0e4","name":"Camera","info":"","x":1990,"y":20,"wires":[]},{"id":"f5dcfc7e.95232","type":"ui_template","z":"3573bb24.cde0e4","group":"1c5fbaaa.f3c935","name":"Fish Cam-1","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8081\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2010,"y":140,"wires":[[]]},{"id":"935b85a8.977778","type":"ui_template","z":"3573bb24.cde0e4","group":"1c5fbaaa.f3c935","name":"Fish Cam-2","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8083\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2010,"y":200,"wires":[[]]},{"id":"957f3fe8.5b6b6","type":"comment","z":"3573bb24.cde0e4","name":"Light","info":"","x":570,"y":900,"wires":[]},{"id":"3704dc63.09c554","type":"ui_chart","z":"3573bb24.cde0e4","name":"Hydraphone","group":"1c5fbaaa.f3c935","order":1,"width":0,"height":0,"label":"Hydraphonic activity","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"Sensor not connected","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":2010,"y":240,"wires":[[],[]]},{"id":"addf941f.9a6db8","type":"comment","z":"3573bb24.cde0e4","name":"cyper/ESP12S007#","info":"","x":270,"y":20,"wires":[]},{"id":"c6c2bb14.d82448","type":"function","z":"3573bb24.cde0e4","name":"AddPath","func":"var Devicepath = flow.get(\"Devicepath\");\n//msg.devicepath = Devicepath;\nmsg.topic = Devicepath + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":1700,"y":420,"wires":[["3945d8a5.0a8428"]]},{"id":"f6094fa3.3d322","type":"function","z":"3573bb24.cde0e4","name":"AddPath","func":"var Devicepath = flow.get(\"Devicepath\");\n//msg.devicepath = Devicepath;\nmsg.topic = Devicepath + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":1700,"y":480,"wires":[["63702386.78d18c"]]},{"id":"b204fadf.358478","type":"bar-chart-data","z":"3573bb24.cde0e4","name":"Smpl","x_interval":"minutes","x_size":24,"unit":"","precision":2,"is_meter_reading":"False","agg_by":"sum","x":1450,"y":300,"wires":[["5ce2c65b.69a928"]]},{"id":"10fac47.9a68d3c","type":"moment","z":"3573bb24.cde0e4","name":"Datetime","topic":"Datetime","input":"payload","format":"DD/MM/YYYY kk:mm:ss","locale":"au","output":"payload","x":120,"y":1500,"wires":[["ee3978c6.497f28"]]},{"id":"31698cbe.0961f4","type":"comment","z":"591dd9ab.7a59d8","name":"Michael - DblClick here 4 Tips","info":"When going through these videos\n-------------------------------\n- Use a new Flow for each lesson/experiment\n- When start another lesson turn of Debug message \n  from prior lesson so you dont get confused\n- As I showed you , if you change the payload to see \n  entire message you see other variables that are available\n- A JSON object is really just a collection of values\n- You can add new values to this JSON object programatically\n- The best way to get started is to understand the Function\n  Node, its the key to many things\n- ","x":240,"y":120,"wires":[]},{"id":"2b3e4a18.50bf16","type":"comment","z":"591dd9ab.7a59d8","name":"1st Lesson","info":"This is an INSERT node, when deployed it sends a payload to a Debug node to display in debug console \n(on your right-->)","x":160,"y":200,"wires":[]},{"id":"ce0bbed5.bfa63","type":"debug","z":"591dd9ab.7a59d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":520,"y":302,"wires":[]},{"id":"c7db0753.cc2468","type":"comment","z":"591dd9ab.7a59d8","name":"Exercise","info":"Now change On/Off inject to send a number of String of characters","x":160,"y":440,"wires":[]},{"id":"4ca2c863.e7732","type":"inject","z":"591dd9ab.7a59d8","name":"INTEGER","topic":"aa","payload":"123","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":480,"wires":[["b0a009ae.e5dfa"]]},{"id":"b0a009ae.e5dfa","type":"debug","z":"591dd9ab.7a59d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":520,"wires":[]},{"id":"3c36bd59.a70862","type":"inject","z":"591dd9ab.7a59d8","name":"STRING","topic":"aa","payload":"Campos Coffee","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":560,"wires":[["b0a009ae.e5dfa"]]},{"id":"9918836c.aa112","type":"inject","z":"4436fe60.38ba","name":"Temperature","topic":"Temperature","payload":"9","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":260,"wires":[["57005c7.1ffbea4"]]},{"id":"57005c7.1ffbea4","type":"function","z":"4436fe60.38ba","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":260,"wires":[["8362eea5.9eed68"]]},{"id":"21579a88.7256fe","type":"debug","z":"4436fe60.38ba","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":120,"wires":[]},{"id":"8362eea5.9eed68","type":"mui_gauge","z":"4436fe60.38ba","name":"","group":"5ebc675b.e2f8f8","order":0,"width":0,"height":0,"gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"75","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":510,"y":240,"wires":[]},{"id":"6be31fac.bee868","type":"http in","z":"4436fe60.38ba","name":"","url":"/test1","method":"get","upload":false,"swaggerDoc":"","x":160,"y":360,"wires":[["1387505a.0b1e1"]]},{"id":"42b89c6a.b5185c","type":"http response","z":"4436fe60.38ba","name":"","statusCode":"","headers":{},"x":580,"y":380,"wires":[]},{"id":"1387505a.0b1e1","type":"template","z":"4436fe60.38ba","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Hello World!","output":"str","x":340,"y":360,"wires":[["42b89c6a.b5185c"]]},{"id":"eee810a3.b07ff","type":"ui_button","z":"5756a5d8.353204","name":"","group":"f58bced2.4eda2","order":1,"width":0,"height":0,"passthru":false,"label":"button","tooltip":"","color":"","bgcolor":"","icon":"","payload":"click!","payloadType":"str","topic":"","x":230,"y":220,"wires":[["d5cbd627.fca528"]]},{"id":"4e5e4d18.1c3284","type":"ui_text","z":"5756a5d8.353204","group":"f58bced2.4eda2","order":1,"width":0,"height":0,"name":"","label":"You Have Clicked:","format":"{{msg.count}}","layout":"row-spread","x":834,"y":365,"wires":[]},{"id":"d5cbd627.fca528","type":"function","z":"5756a5d8.353204","name":"Count","func":"var count = context.get('count')||0;\ncount += 1;\n// store the value back\ncontext.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":220,"wires":[["4e5e4d18.1c3284","e03a519.3e32eb"]]},{"id":"c05a6125.a23d9","type":"ui_gauge","z":"5edcaa92.ff5b64","name":"","group":"a6595861.690f48","order":3,"width":0,"height":0,"gtype":"gage","title":"Happy Meter","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":730,"y":340,"wires":[]},{"id":"82465a17.399df8","type":"ui_numeric","z":"5edcaa92.ff5b64","name":"","label":"numeric","tooltip":"","group":"a6595861.690f48","order":2,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":320,"y":360,"wires":[["c05a6125.a23d9"]]},{"id":"18b0294d.abebd7","type":"ui_text","z":"5edcaa92.ff5b64","group":"a6595861.690f48","order":2,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":240,"wires":[]},{"id":"939a79a3.3bf698","type":"json","z":"32dcba41.94bc56","name":"","property":"payload","action":"obj","pretty":false,"x":430,"y":620,"wires":[["a501d1a7.12484","cae38780.6505a8","f0a81af1.8c40e8","3bb1ac50.c26cd4"]]},{"id":"3a008b22.cb3364","type":"ui_gauge","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"degrees celsius","format":"{{msg.temp}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":970,"y":520,"wires":[]},{"id":"b11f7a9e.1bf9d8","type":"http request","z":"32dcba41.94bc56","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=London&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":250,"y":640,"wires":[["939a79a3.3bf698"]]},{"id":"a501d1a7.12484","type":"change","z":"32dcba41.94bc56","name":"","rules":[{"t":"set","p":"temp","pt":"msg","to":"msg.payload.main.temp","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":520,"wires":[["3a008b22.cb3364"]]},{"id":"cae38780.6505a8","type":"change","z":"32dcba41.94bc56","name":"","rules":[{"t":"set","p":"humidity","pt":"msg","to":"msg.payload.main.humidity","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":580,"wires":[["c84076ae.468a58"]]},{"id":"c84076ae.468a58","type":"ui_gauge","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":3,"width":0,"height":0,"gtype":"gage","title":"Humidity","label":"%","format":"{{msg.humidity}}","min":0,"max":"100","colors":["#ffa200","#00ff59","#ff7b00"],"seg1":"","seg2":"","x":980,"y":580,"wires":[]},{"id":"f0a81af1.8c40e8","type":"change","z":"32dcba41.94bc56","name":"","rules":[{"t":"set","p":"city","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":460,"wires":[["fcac293f.fc79e8"]]},{"id":"fcac293f.fc79e8","type":"ui_text","z":"32dcba41.94bc56","group":"d2957505.af9a78","order":1,"width":0,"height":0,"name":"City Name","label":"","format":"{{msg.city}}","layout":"col-center","x":970,"y":460,"wires":[]},{"id":"bda5c9ee.dc6848","type":"debug","z":"32dcba41.94bc56","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"city","targetType":"msg","x":780,"y":820,"wires":[]},{"id":"b209457.485a4b8","type":"ui_button","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":6,"width":0,"height":0,"passthru":false,"label":"Get Weather for Sydney","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":210,"y":420,"wires":[["3257866a.39a96a"]]},{"id":"3257866a.39a96a","type":"http request","z":"32dcba41.94bc56","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=Sydney&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":300,"y":500,"wires":[["939a79a3.3bf698"]]},{"id":"40c95f3f.f552a","type":"ui_button","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":7,"width":0,"height":0,"passthru":false,"label":"Get Weather for Melbourne","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":400,"y":320,"wires":[["541a72fe.8b7c4c"]]},{"id":"541a72fe.8b7c4c","type":"http request","z":"32dcba41.94bc56","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"api.openweathermap.org/data/2.5/weather?q=Melbourne&appid=dc5f2c77bdadffa93a63b26e9d48d5ed&units=metric","tls":"","proxy":"","authType":"","x":480,"y":400,"wires":[["939a79a3.3bf698"]]},{"id":"3bb1ac50.c26cd4","type":"function","z":"32dcba41.94bc56","name":"Set Comfort","func":"msg.comfort = 0;\n\n\nif (msg.payload.main.humidity <= 60 && msg.payload.main.humidity >= 30)\n    msg.comfort += 50;\nif (msg.payload.main.temp <= 27 && msg.payload.main.temp >= 20)\n    msg.comfort += 50;     \n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":640,"wires":[["3d57ad8.162ea52"]]},{"id":"3d57ad8.162ea52","type":"ui_gauge","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":4,"width":0,"height":0,"gtype":"gage","title":"Comfort","label":"units","format":"{{msg.comfort}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb5e"],"seg1":"","seg2":"","x":980,"y":640,"wires":[]},{"id":"23ca12e4.e9829e","type":"ui_text_input","z":"32dcba41.94bc56","name":"","label":"","tooltip":"","group":"d2957505.af9a78","order":0,"width":0,"height":0,"passthru":false,"mode":"text","delay":"0","topic":"","x":120,"y":800,"wires":[["7e6321ae.d06cb"]]},{"id":"7e6321ae.d06cb","type":"change","z":"32dcba41.94bc56","name":"","rules":[{"t":"set","p":"city","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":760,"wires":[["bda5c9ee.dc6848"]]},{"id":"933f059b.17d138","type":"ui_button","z":"32dcba41.94bc56","name":"","group":"d2957505.af9a78","order":6,"width":0,"height":0,"passthru":false,"label":"Get Weather for London","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":110,"y":560,"wires":[["b11f7a9e.1bf9d8"]]},{"id":"e03a519.3e32eb","type":"ui_chart","z":"5756a5d8.353204","name":"","group":"f58bced2.4eda2","order":2,"width":"3","height":"3","label":"clicks","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":860,"y":200,"wires":[[]]},{"id":"fa1804ca.c41688","type":"function","z":"b21b19bd.f3c808","name":"","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":500,"wires":[["76da8985.666ce8","4eac74bf.f83e6c","16a0c308.e1148d"]]},{"id":"4eac74bf.f83e6c","type":"function","z":"b21b19bd.f3c808","name":"Power","func":"var topic=msg.topic\n/*\nvar nullArray = [null,null,null,null,null,null,null,null]\nvar topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"]\n\nif (topic in topicArray) {\n    nullArray[topicArray.findIndex(topic)] = msg\n    return nullArray\n}\n*/   \n  \n    \n\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n} \n","outputs":8,"noerr":0,"x":630,"y":620,"wires":[["e0dbe1b1.79257","59bc38f9.fe9a18","b39118c9.953258"],[],[],[],["efa84255.8d53c"],["bf1f7ceb.36aa2"],[],["25cdbf68.736b1"]]},{"id":"76da8985.666ce8","type":"debug","z":"b21b19bd.f3c808","name":"All topics","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":860,"y":420,"wires":[]},{"id":"e0dbe1b1.79257","type":"ui_gauge","z":"b21b19bd.f3c808","name":"Voltage","group":"cf797beb.e118e8","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":880,"y":560,"wires":[]},{"id":"25cdbf68.736b1","type":"ui_chart","z":"b21b19bd.f3c808","name":"CurrentMa","group":"cf797beb.e118e8","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":600,"wires":[[]]},{"id":"efa84255.8d53c","type":"ui_chart","z":"b21b19bd.f3c808","name":"Power","group":"cf797beb.e118e8","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":640,"wires":[[]]},{"id":"bf1f7ceb.36aa2","type":"ui_chart","z":"b21b19bd.f3c808","name":"Power(mW)","group":"cf797beb.e118e8","order":5,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":680,"wires":[[]]},{"id":"9722b852.fe8958","type":"function","z":"3573bb24.cde0e4","name":"","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["5bc03ca0.6a47f4","ffe0184e.43a468","70daf02a.11678","c396a84a.36a3d8","9dc8f29f.58f03"]]},{"id":"83018ae0.f085b8","type":"mqtt in","z":"3573bb24.cde0e4","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":70,"y":20,"wires":[["9722b852.fe8958","c235895f.41f9a8","cc7b79d1.cf2108"]]},{"id":"5bc03ca0.6a47f4","type":"debug","z":"3573bb24.cde0e4","name":"All topics","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":560,"y":120,"wires":[]},{"id":"ffe0184e.43a468","type":"function","z":"3573bb24.cde0e4","name":"Power","func":"var topic=msg.topic;\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":130,"y":120,"wires":[["baf20c3d.ea037","c2978c4c.3a5ce"],[],[],[],["26ffbac8.b41866"],["855d8433.1b9bf8"],[],["ab662e11.dd1bf"]]},{"id":"baf20c3d.ea037","type":"ui_gauge","z":"3573bb24.cde0e4","name":"Voltage","group":"cd57739c.7b72b","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":440,"y":80,"wires":[]},{"id":"26ffbac8.b41866","type":"ui_chart","z":"3573bb24.cde0e4","name":"Power","group":"4e8a2667.8785f8","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":430,"y":160,"wires":[[],[]]},{"id":"855d8433.1b9bf8","type":"ui_chart","z":"3573bb24.cde0e4","name":"Power(mW)","group":"4e8a2667.8785f8","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":450,"y":200,"wires":[[],[]]},{"id":"ab662e11.dd1bf","type":"ui_chart","z":"3573bb24.cde0e4","name":"CurrentMa","group":"4e8a2667.8785f8","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":450,"y":120,"wires":[[]]},{"id":"c2978c4c.3a5ce","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":740,"y":100,"wires":[]},{"id":"2a970e3a.5719a2","type":"mqtt in","z":"b21b19bd.f3c808","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":390,"y":460,"wires":[["fa1804ca.c41688"]]},{"id":"16a0c308.e1148d","type":"function","z":"b21b19bd.f3c808","name":"Water","func":"var topic=msg.topic;\n\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"]\n\n\nif (topic in topicArray) \n    return nullArray[topicArray.findIndex(topic)] = msg;\n/*\nif (topic==\"waterquality/ph\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n}*/","outputs":22,"noerr":0,"x":630,"y":880,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],["9474ff4e.07f5f"],["9474ff4e.07f5f"],["9474ff4e.07f5f"],["9474ff4e.07f5f"],["9474ff4e.07f5f"]]},{"id":"9474ff4e.07f5f","type":"ui_chart","z":"b21b19bd.f3c808","name":"Tank temperatures","group":"cf797beb.e118e8","order":4,"width":0,"height":0,"label":"Tank Temperatures","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1270,"y":980,"wires":[[]]},{"id":"3fae0827.edd1a8","type":"ui_template","z":"b21b19bd.f3c808","group":"cf797beb.e118e8","name":"Fish Cam-2","order":6,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8083\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1310,"y":360,"wires":[[]]},{"id":"472f49fd.c5d9f8","type":"ui_template","z":"b21b19bd.f3c808","group":"cf797beb.e118e8","name":"Fish Cam-1","order":7,"width":"6","height":"4","format":"<iframe id=\"fr0\" style=\"\n        width: 100%; \n        height: 100%; \n        overflow: hidden;\n        margin: auto;\n        border: 1px solid grey;\"\n        frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\"\n        src=\"http://10.0.0.71:8081\"\n        >\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1310,"y":320,"wires":[[]]},{"id":"59bc38f9.fe9a18","type":"debug","z":"b21b19bd.f3c808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1090,"y":420,"wires":[]},{"id":"20855d93.026e32","type":"ui_level","z":"b21b19bd.f3c808","group":"cd57739c.7b72b","order":1,"width":0,"height":0,"name":"","label":"","colorHi":"#e60000","colorWarn":"#ff9900","colorNormal":"#00b33c","colorOff":"#595959","min":0,"max":100,"segWarn":"","segHigh":"","unit":"","layout":"sh","channelA":"","channelB":"","decimals":0,"animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#eeeeee","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"textAnimations":false,"hideValue":false,"tickmode":"off","peakmode":false,"peaktime":3000,"x":1190,"y":880,"wires":[]},{"id":"b39118c9.953258","type":"debug","z":"b21b19bd.f3c808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":700,"wires":[]},{"id":"6f6649fa.c752a8","type":"comment","z":"b21b19bd.f3c808","name":"Reboot & Email","info":"","x":1540,"y":420,"wires":[]},{"id":"df4f10c6.0486b","type":"ui_numeric","z":"b21b19bd.f3c808","name":"","label":"Reboots before Email Sent","tooltip":"","group":"d408e358.dd5f7","order":3,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":1820,"y":340,"wires":[["291288da.082a88"]]},{"id":"291288da.082a88","type":"change","z":"b21b19bd.f3c808","name":"","rules":[{"t":"set","p":"emailCount","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1940,"y":420,"wires":[[]]},{"id":"55f93b92.cf7654","type":"inject","z":"b21b19bd.f3c808","name":"TestEmail","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1960,"y":960,"wires":[["61b28be7.cca874"]]},{"id":"61b28be7.cca874","type":"function","z":"b21b19bd.f3c808","name":"EmailContent","func":"var Devicepath = flow.get(\"Devicepath\");\nmsg = {\n    payload: \"The email body here at Date: \" + Date().toString() + \", my explanation e.g. water level now at  \" + msg.payload + \"%\",\n    topic: \"RESTARTING: The email subject line - Devicepath: \" + Devicepath,\n    to: \"michaelthompson@mail.com\",\n    cc: \"\",\n    bcc: \"\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":2120,"y":921,"wires":[["58f67e4c.edb26"]]},{"id":"58f67e4c.edb26","type":"e-mail","z":"b21b19bd.f3c808","server":"mail.cypernet.com","port":"25","secure":false,"tls":false,"name":"michaelthompson@mail.com","dname":"MH","x":2270,"y":920,"wires":[]},{"id":"b26b3b2f.e832f8","type":"inject","z":"b21b19bd.f3c808","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1160,"y":600,"wires":[["ad7282c3.1f423"]]},{"id":"ad7282c3.1f423","type":"random","z":"b21b19bd.f3c808","name":"","low":"0","high":"3","inte":"true","property":"payload","x":1340,"y":600,"wires":[[]]},{"id":"91d0055d.b93728","type":"switch","z":"b21b19bd.f3c808","name":"Is Startup?","property":"payload.cyper/ESPloader01/mcu/startingup","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1350,"y":480,"wires":[[]]},{"id":"522a5db0.fe5f84","type":"inject","z":"b21b19bd.f3c808","name":"Timestamp","topic":"Datetime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":460,"wires":[["91d0055d.b93728"]]},{"id":"fc21544b.d0bbd8","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":280,"y":560,"wires":[]},{"id":"a1205af1.0271e8","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":300,"y":260,"wires":[]},{"id":"83ac13ae.32973","type":"ui_lineargauge","z":"3573bb24.cde0e4","group":"f81c0809.59ef18","order":1,"width":0,"height":0,"name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"C","x":2530,"y":1200,"wires":[]},{"id":"9e45d8ee.67a318","type":"ui_lineargauge","z":"3573bb24.cde0e4","group":"6285c1ce.77a89","order":1,"width":0,"height":0,"name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"C","x":2530,"y":1240,"wires":[]},{"id":"422cc187.4da9a","type":"ui_lineargauge","z":"3573bb24.cde0e4","group":"f676e381.0c13b","order":1,"width":"0","height":"0","name":"","colorLowArea":"#ffffc0","colorMidArea":"#99ff99","colorHighArea":"#ff8080","unit":"C","x":2530,"y":1160,"wires":[]},{"id":"d4ce128d.d8749","type":"change","z":"3573bb24.cde0e4","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1160,"wires":[["422cc187.4da9a"]]},{"id":"33a2ec6b.78f6c4","type":"change","z":"3573bb24.cde0e4","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1240,"wires":[[]]},{"id":"a9641cae.56c3f","type":"change","z":"3573bb24.cde0e4","name":"","rules":[{"t":"set","p":"highlimit","pt":"msg","to":"25","tot":"num"},{"t":"set","p":"lowlimit","pt":"msg","to":"11","tot":"num"},{"t":"set","p":"setpoint","pt":"msg","to":"18","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":1200,"wires":[[]]},{"id":"dedd6922.696548","type":"comment","z":"3573bb24.cde0e4","name":"Tank Temperatures","info":"","x":2550,"y":20,"wires":[]},{"id":"6f8c3639.c1b248","type":"ui_chart","z":"3573bb24.cde0e4","name":"","group":"d408e358.dd5f7","order":3,"width":0,"height":0,"label":"Today's Reboots","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":3450,"y":1580,"wires":[[]]},{"id":"291b1d.faf1c4e4","type":"change","z":"3573bb24.cde0e4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"rebootCount","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3240,"y":1520,"wires":[["6f8c3639.c1b248"]]},{"id":"57d35671.94c5a8","type":"function","z":"3573bb24.cde0e4","name":"Count Reboots","func":"var rebootCount = global.get('rebootCount')||0;\n\n// reset rebootCount at midnight\nif (msg.time == \"0:0:0\" || global.rebootCount === 0)\n    rebootCount = 0;\nelse\n    rebootCount += 1;\n// store the value back\nglobal.set('rebootCount',rebootCount);\n// make it part of the outgoing msg object\nmsg.rebootCount = rebootCount;\nreturn msg;","outputs":1,"noerr":0,"x":2700,"y":1360,"wires":[["660abc44.37bff4","956be5c7.573048","1399f3c2.de0dac","291b1d.faf1c4e4"]]},{"id":"10172c90.ca7ce3","type":"function","z":"3573bb24.cde0e4","name":"Get Datetime","func":"var today = new Date();\n\nvar hours = today.getHours() + 11\nmsg.time = hours + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2690,"y":1300,"wires":[["57d35671.94c5a8","bbe1a87a.6c1858"]]},{"id":"660abc44.37bff4","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"rebootCount","targetType":"msg","x":2860,"y":1460,"wires":[]},{"id":"956be5c7.573048","type":"function","z":"3573bb24.cde0e4","name":"Check Count","func":"var emailCount = global.get('emailCount')||1;\n\nif (msg.rebootCount == emailCount)\n    return msg;","outputs":1,"noerr":0,"x":2970,"y":1360,"wires":[["b6acfe3d.f3362","534270bc.cafe7"]]},{"id":"1399f3c2.de0dac","type":"ui_text","z":"3573bb24.cde0e4","group":"d408e358.dd5f7","order":1,"width":0,"height":0,"name":"","label":"Today","format":"{{msg.rebootCount}}","layout":"col-center","x":3090,"y":1580,"wires":[]},{"id":"bbe1a87a.6c1858","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"time","targetType":"msg","x":2860,"y":1300,"wires":[]},{"id":"b6acfe3d.f3362","type":"e-mail","z":"3573bb24.cde0e4","server":"{{msg.server}}","port":"{{msg.port}}","secure":true,"tls":true,"name":"{{msg.recipient}}","dname":"Send Email","x":3350,"y":1420,"wires":[]},{"id":"534270bc.cafe7","type":"debug","z":"3573bb24.cde0e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"\"out\"","targetType":"jsonata","x":3140,"y":1300,"wires":[]},{"id":"6e0bfb18.5c02e4","type":"change","z":"3573bb24.cde0e4","name":"Reset rebootCount","rules":[{"t":"set","p":"rebootCount","pt":"global","to":"0","tot":"num"},{"t":"set","p":"rebootCount","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2810,"y":1560,"wires":[["1399f3c2.de0dac"]]},{"id":"175c4855.145e38","type":"ui_button","z":"3573bb24.cde0e4","name":"","group":"d408e358.dd5f7","order":3,"width":0,"height":0,"passthru":false,"label":"Reset for the day","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":2570,"y":1540,"wires":[["6e0bfb18.5c02e4"]]},{"id":"eb25b4f9.4b06a8","type":"mqtt in","z":"7cea9793.8d27e8","name":"ESP12S007","topic":"cyper/ESP12S007/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":90,"y":100,"wires":[["ea9dd5d7.012758"]]},{"id":"ea9dd5d7.012758","type":"function","z":"7cea9793.8d27e8","name":"Split Topic","func":"// Authored by Martin Hannah\n\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":100,"wires":[["e4c80d41.739b2"]]},{"id":"c69d1d8e.845b6","type":"function","z":"7cea9793.8d27e8","name":"Power","func":"// Authored by Michael Thompson on 30/12/2020\nconst topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\n    flow.set(\"power/voltage\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\n    flow.set(\"power/amp\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\n    flow.set(\"power/mA\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\n    flow.set(\"power/loadvoltage\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\n    flow.set(\"power/loadpower\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\n    flow.set(\"power/loadpowermw\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\n    flow.set(\"power/loadamps\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\n    flow.set(\"power/loadmA\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg];\n} \n*/\n","outputs":8,"noerr":0,"x":270,"y":3980,"wires":[[],[],[],[],[],[],[],[]]},{"id":"49aef17d.134a","type":"influxdb out","z":"5a8764a8.7ffba4","influxdb":null,"name":"","measurement":"TANK_MEASURE","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1240,"y":280,"wires":[]},{"id":"416a24f3.c2028c","type":"function","z":"5a8764a8.7ffba4","name":"condition","func":"var sensor = msg.sensor;\nif (sensor >= 5) {\n    msg.payload =\n    {\n        numValue:  sensor,\n        strValue:  \"high\",\n        valveCond: 0\n    }\n}\n\nelse {\n    msg.payload =\n    {\n        numValue:  sensor,\n        strValue:  \"low\",\n        valveCond: 1\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":340,"wires":[["49aef17d.134a","f9a3920f.797a6"]]},{"id":"f5398f53.2a21c","type":"random","z":"5a8764a8.7ffba4","name":"","low":"1","high":"10","inte":"true","property":"sensor","x":660,"y":340,"wires":[["416a24f3.c2028c"]]},{"id":"f9a3920f.797a6","type":"debug","z":"5a8764a8.7ffba4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":340,"wires":[]},{"id":"c2a3a1a2.9371b","type":"inject","z":"5a8764a8.7ffba4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":340,"wires":[["f5398f53.2a21c"]]},{"id":"629000b4.e02ac","type":"inject","z":"7cea9793.8d27e8","name":"Inject every second","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"0.1","x":800,"y":100,"wires":[["957c9ab8.411618"]]},{"id":"bc928701.06f828","type":"function","z":"7cea9793.8d27e8","name":"Water","func":"// Authored by Michael Thompson on 30/12/2020\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n\n\n\n\n/*\n// Martin Hannah Code\nif (topic==\"waterquality/ph\") {\n    flow.set(\"waterquality/ph\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\n    flow.set(\"waterquality/phrating\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\n    flow.set(\"waterquality/turbidity\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\n    flow.set(\"waterquality/turbidityvolts\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\n    flow.set(\"waterflow/tankwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\n    flow.set(\"watertemp00/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\n    flow.set(\"waterflow/gardenwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\n    flow.set(\"watertemp01/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\n    flow.set(\"waterlevel/fishtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\n    flow.set(\"waterlevel/2ndtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\n    flow.set(\"waterlevel/3rdtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\n    flow.set(\"waterlevel/fishtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\n    flow.set(\"waterlevel/2ndtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\n    flow.set(\"waterlevel/3rdtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\n    flow.set(\"waterlevel/fishtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\n    flow.set(\"waterlevel/2ndtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\n    flow.set(\"waterlevel/3rdtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\n    flow.set(\"temperature00/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\n    flow.set(\"temperature01/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\n    flow.set(\"temperature02/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\n    flow.set(\"temperature03/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\n    flow.set(\"temperature04/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":22,"noerr":0,"x":270,"y":4220,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"e3e3798e.47e3a8","type":"comment","z":"7cea9793.8d27e8","name":"Get Sensor Data","info":"","x":100,"y":40,"wires":[]},{"id":"7fc4c122.50b9a","type":"comment","z":"7cea9793.8d27e8","name":"Interpret Sensor Data","info":"https://run.mocky.io/v3/b4b2d93d-896c-4d37-b019-5228a61e2338\n\n\nhttps://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb\n\n\nhttps://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","x":440,"y":40,"wires":[]},{"id":"5ca576e1.7fe328","type":"comment","z":"7cea9793.8d27e8","name":"Send to InfluxDB","info":"","x":780,"y":40,"wires":[]},{"id":"fbfcaf94.84b2b","type":"function","z":"7cea9793.8d27e8","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":280,"y":4480,"wires":[[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"93334dfe.1eb4a","type":"function","z":"7cea9793.8d27e8","name":"Environ","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null,null,null,null,null,null,null,null];\nconst topicArray = \n[\"sound/loadness\",\n\"environment/temperature\",\n\"environment/avetemperature\",\n\"environment/humidity\",\n\"environment/abshumidity\",\n\"environment/heatindex\",\n\"environment/pressure\",\n\"environment/altitude\",\n\"uvindex/uvindex\",\n\"uvindex/uvrating\",\n\"proximity/movement\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\nvar topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":11,"noerr":0,"x":280,"y":4660,"wires":[[],[],[],[],[],[],[],[],[],[],["c6c9515c.46459"]]},{"id":"c6c9515c.46459","type":"function","z":"7cea9793.8d27e8","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":4760,"wires":[[]]},{"id":"90b1338b.055a9","type":"function","z":"7cea9793.8d27e8","name":"Light","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null];\nconst topicArray = [\"light/ambientlight\",\"light/illuminance\",\"light/illuminance/01\",\"light/illuminance/02\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null]\nreturn nullArray;\n\n\n/*\nvar topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n} */","outputs":4,"noerr":0,"x":270,"y":4820,"wires":[[],[],[],[]]},{"id":"13211e8b.9f8d61","type":"function","z":"7cea9793.8d27e8","name":"Misc","func":"// ASK ABOUT DUPLICATE TOPICS\n\n// Authored by Michael Thompson on 30/12/2020\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\n/*\"waterquality/phrating\"\n\"waterquality/turbidity\"\n\"waterquality/voltage\"\n\"temperature00/degrees\"\n\"temperature01/degrees\"\n\"temperature03/degrees\"\n\"mcu/heartbeat\"*/\nif (msg.topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n    msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n    //msg.payload = msg.payload.replace(\",\",'\\n');\n    msg.payload = msg.payload.replace(\"zzStart,\",'');\n    msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n    msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n    msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n    msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n    msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n    msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n    msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n    msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n    msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n    msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n    msg.payload = msg.payload.replace(\"BME\",'BMP280');\n    msg.payload = msg.payload.replace(/read/g,'');\n    return [msg,null,null,null,null,null,null,null];\n}\n\nelse {\n    // Get index of topic in array\n    var index = topicArray.findIndex(topic => topic === msg.topic);\n    \n    // If the topic is in the topicArray, assign it to the same index in nullArray and create\n    // a flow variable\n    if (index != -1) {\n        nullArray[index] = msg;\n        flow.set(msg.topic,parseFloat(msg.payload));\n    }\n    \n    // eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\n    return nullArray;    \n    \n    \n}\n\n\n\n\n\n\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":270,"y":4920,"wires":[[],[],[],[],[],[],[],[]]},{"id":"e4c80d41.739b2","type":"function","z":"7cea9793.8d27e8","name":"Update Topic Flow Variable ","func":"// Authored by Michael Thompson on 30/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\n// Updates flow array containing all topics\n// May or may not be necessary // \nconst topicArray = flow.get(\"topicArray\") || [];\nif ((topicArray.includes(msg.topic))===false)\n    topicArray.push(msg.topic);\nflow.set(\"topicArray\", topicArray);\n\n\nvar group = flow.get('Devicepath');\n\n// Updates flow containing for groups\nconst groups = flow.get(\"groups\") || [];\nif (!(groups.includes(group)))\n    groups.push(group);\nflow.set(\"groups\", groups);\n\n// Updates flow containing for topics within current group\nconst groupArray = flow.get(group+\"Array\") || [];\nif (!(groupArray.includes(msg.topic)) && !msg.topic.includes(\"$\"))\n    groupArray.push(msg.topic);\nflow.set(group+\"Array\",groupArray);\n\n// Updates flow variable for current group and topic\nflow.set(group+msg.topic,\n        // WILL NEED TO PARSE OTHER DATATYPES\n        // PARSING FLOAT BECAUSE FIRMWARE SENDS ALL DATA AS STRINGS\n        // WHICH CAUSES ERRORS WITH INFLUXDB TYPES\n        {\"value\":parseFloat(msg.payload),\n        // Bool for if data is new\n         \"new\":true\n        });\n\n","outputs":1,"noerr":0,"x":460,"y":160,"wires":[["51a85b1d.42f354"]]},{"id":"23b7c590.32cd5a","type":"ui_gauge","z":"7cea9793.8d27e8","name":"Voltage","group":"cd57739c.7b72b","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":960,"y":320,"wires":[]},{"id":"35da4f86.1162a","type":"ui_chart","z":"7cea9793.8d27e8","name":"CurrentMa","group":"4e8a2667.8785f8","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":970,"y":360,"wires":[[]]},{"id":"35da1848.3958c8","type":"ui_chart","z":"7cea9793.8d27e8","name":"Power","group":"4e8a2667.8785f8","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":950,"y":400,"wires":[[],[]]},{"id":"9aa6014.4ac55","type":"ui_chart","z":"7cea9793.8d27e8","name":"Power(mW)","group":"4e8a2667.8785f8","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":970,"y":440,"wires":[[],[]]},{"id":"c2cf24ac.7e9e38","type":"function","z":"7cea9793.8d27e8","name":"Output","func":"\nreturn msg;","outputs":8,"noerr":0,"x":750,"y":380,"wires":[["23b7c590.32cd5a"],["35da4f86.1162a"],["35da1848.3958c8"],["9aa6014.4ac55"],[],[],[],[]]},{"id":"aba74d2d.09fa","type":"comment","z":"7cea9793.8d27e8","name":"Node-Red Dashboard","info":"","x":800,"y":280,"wires":[]},{"id":"91d59b6e.e0c778","type":"function","z":"7cea9793.8d27e8","name":"Set topicArrays","func":"// Authored by Michael Thompson on 4/1/21\n\nvar topics = msg.payload['topics'];\nvar topicArray = [];\n\nfor (var key in topics) {\n    topicArray.push(topics[key]);\n}\n\n// Instead of this, each array will contain a list of sensors associated with a \"group\" \n// and a MQTT device\nflow.set(\"topicArray\",topicArray);\n\nflow.set(\"powerArray\",topics['power']);\nflow.set(\"waterArray\",topics['water']);\n\n\nreturn msg;\n\n/*\nconst topicArray = [\n    // POWER\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\",\n    // WATER\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"]; \n\nconst powerArray = [\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\"];\n    \nconst waterArray = [\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"];\n\nconst miscArray = [];\n\n\n\nflow.set(\"powerArray\",powerArray);\nflow.set(\"waterArray\",waterArray);\nflow.set(\"miscArray\",miscArray); */","outputs":1,"noerr":0,"x":520,"y":3800,"wires":[[]]},{"id":"e7cb311b.a11ba","type":"http request","z":"7cea9793.8d27e8","name":"GET topicArrays","method":"GET","ret":"obj","paytoqs":false,"url":"https://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","tls":"","proxy":"","authType":"","x":280,"y":3800,"wires":[["91d59b6e.e0c778"]]},{"id":"327e8c42.6f0a44","type":"mqtt in","z":"7cea9793.8d27e8","name":"ESP12S008","topic":"cyper/ESP12S008/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":90,"y":160,"wires":[["ea9dd5d7.012758"]]},{"id":"4cfe4aa0.48f204","type":"mqtt in","z":"7cea9793.8d27e8","name":"ESP12S009","topic":"cyper/ESP12S009/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":90,"y":220,"wires":[["ea9dd5d7.012758"]]},{"id":"3e5677e8.ff3d68","type":"mqtt in","z":"7cea9793.8d27e8","name":"ESP12S010","topic":"cyper/ESP12S010/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":90,"y":280,"wires":[["ea9dd5d7.012758"]]},{"id":"f8d77c75.512fe","type":"function","z":"7cea9793.8d27e8","name":"Send New Group Data","func":"// Authored by Michael Thompson on 29/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\nvar group = flow.get(\"groups\")[msg.index];\n\n// Array of Sensor Values\nvalueArr = flow.get(group+\"Array\");\n\njsonData = {};\n\n// InfluxDB measurement set to group name as defined by loop over groups array\nmsg.measurement = group;\n\n// For each sensor value, if the value is not set to \"undefined\" and contains new data, it is updated\n// in the JSON object\nvar value;\nvar send = false;\nfor (value of valueArr) \n    if (flow.get(group+value) !== undefined && !(isNaN(flow.get(group+value)[\"value\"])) && flow.get(group+value)[\"new\"] === true) {\n        // NOTICE how field for influxDB (jsonData[value]) does not need to contain group\n        jsonData[value] = flow.get(group+value)[\"value\"];\n        flow.set(group+value,{\"value\":flow.get(group+value)[\"value\"],\"new\":false});\n        send = true;\n    }\n// JSON object of most up-to-date sensor values returned\nif (send === true) {\n    msg.payload = jsonData;\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":220,"wires":[["111ea84c.502a28","fca7a276.a6c9b","957c9ab8.411618"]]},{"id":"111ea84c.502a28","type":"influxdb out","z":"7cea9793.8d27e8","influxdb":"e6905514.164d48","name":"Update Measurement","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1100,"y":100,"wires":[]},{"id":"fca7a276.a6c9b","type":"debug","z":"7cea9793.8d27e8","name":"Debug InfluxDB","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1080,"y":200,"wires":[]},{"id":"88f15f18.32c88","type":"comment","z":"7cea9793.8d27e8","name":"OLD API implementation","info":"","x":310,"y":3700,"wires":[]},{"id":"1ef12d42.a9c653","type":"comment","z":"7cea9793.8d27e8","name":"Add more devices here as necessary","info":"","x":160,"y":340,"wires":[]},{"id":"957c9ab8.411618","type":"array-loop","z":"7cea9793.8d27e8","name":"Loop over Groups","key":"index","keyType":"msg","reset":true,"resetValue":"value-null","array":"groups","arrayType":"flow","x":790,"y":160,"wires":[[],["f8d77c75.512fe"]]},{"id":"c4cb4a76.0faa88","type":"mqtt in","z":"25e1fd8d.6907c2","name":"ESP12S007","topic":"cyper/ESP12S007/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":190,"y":300,"wires":[["69ca6ea9.52c54","f8931e06.546b7"]]},{"id":"69ca6ea9.52c54","type":"function","z":"25e1fd8d.6907c2","name":"Topic Splitter","func":"\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":300,"wires":[["95cd349.b1e53c8"]]},{"id":"95cd349.b1e53c8","type":"function","z":"25e1fd8d.6907c2","name":"Power","func":"var topic=msg.topic;\nvar array = [\"power/voltage\", \"power/amp\", \"power/mA\", \"power/loadvoltage\", \"power/loadpower\", \"power/loadpowermw\", \"power/loadamps\", \"power/loadmA\" ];\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nvar nullArray = [null,null,null,null,null,null,null,null];\n\n\nfor (var [i, element] of array.entries()) { \n    if (topic == element) {\n        nullArray[i] = msg;\n        return nullArray;\n    }\n}\n/*\nif (topic==\"power/voltage\") {\nreturn [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\nreturn [null,null,null,null,null,null,null,msg];\n}\n*/","outputs":8,"noerr":0,"x":590,"y":300,"wires":[["cb609b58.20cd58"],["e07dd53a.d2fda"],[],[],["352a7f37.68398"],["ff741b5e.b52658"],[],["6504014f.0b4cf"]]},{"id":"cb609b58.20cd58","type":"ui_gauge","z":"25e1fd8d.6907c2","name":"Voltage","group":"9f6e013a.cea21","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"V","format":"{{value}}","min":0,"max":"5","colors":["#00b500","#e6e600","#ca3838"],"seg1":"1.7","seg2":"3.4","x":920,"y":260,"wires":[]},{"id":"6504014f.0b4cf","type":"ui_chart","z":"25e1fd8d.6907c2","name":"CurrentMa","group":"9f6e013a.cea21","order":5,"width":0,"height":0,"label":"Current","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#88b9c7","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":870,"y":440,"wires":[[]]},{"id":"352a7f37.68398","type":"ui_chart","z":"25e1fd8d.6907c2","name":"Power","group":"9f6e013a.cea21","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#51b43d","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":360,"wires":[[]]},{"id":"ff741b5e.b52658","type":"ui_chart","z":"25e1fd8d.6907c2","name":"PowerMW","group":"9f6e013a.cea21","order":4,"width":0,"height":0,"label":"Power","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#e7af19","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":400,"wires":[[]]},{"id":"3d45ef8d.fda7f","type":"comment","z":"25e1fd8d.6907c2","name":"1) ","info":"Have a look through the nodes and ask\nquestions if you have any\n\nUse a debug node on the mqtt node to observe incoming data\nWhat is its topic is? Topic is a string describing what is being measured\nWhat is its payload? Payload is a string. A quantitative measure.\nWhat is the datatype? (Are they all the same?)","x":450,"y":60,"wires":[]},{"id":"277bcbdb.08eac4","type":"comment","z":"25e1fd8d.6907c2","name":"2) ","info":"Go to 10.0.0.211:32783/ui/ and click on Lachlan tab\nLook at the gauges\nSet the units for each gauge and adjust the gradient and range","x":450,"y":100,"wires":[]},{"id":"c8b269b8.ccbef8","type":"comment","z":"25e1fd8d.6907c2","name":"3)","info":"Add a node to display power/amp as a linear gauge","x":450,"y":140,"wires":[]},{"id":"836d27c.9d859d8","type":"comment","z":"25e1fd8d.6907c2","name":"4) HARD","info":"4) Create a function to store each incoming \n   topic as a flow variable with attributes: value\n   and category.\n\n   Example: \"power/amp\"\n            flow.get(\"power/amp\") should return:\n            {\n                \"value\": 3.14,\n                \"category\": \"power\"\n            }\n   \n   NOTE:\n        You may need to research JSON objects\n        https://www.w3schools.com/js/js_json_objects.asp\n        \n        Use a debug node with msg.payload set to a flow variable\n        to test\n   ","x":460,"y":180,"wires":[]},{"id":"d6160ba8.a472b8","type":"comment","z":"25e1fd8d.6907c2","name":"5) ","info":"Optimise the Power function","x":450,"y":220,"wires":[]},{"id":"3c165a5a.a80a16","type":"debug","z":"7cea9793.8d27e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":560,"wires":[]},{"id":"51a85b1d.42f354","type":"function","z":"7cea9793.8d27e8","name":"","func":"msg.payload = flow.get(\"cyper/ESP12S007/Array\")\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":360,"wires":[["3c165a5a.a80a16"]]},{"id":"3710d490.e4007c","type":"inject","z":"7cea9793.8d27e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":460,"wires":[["51a85b1d.42f354"]]},{"id":"e07dd53a.d2fda","type":"ui_gauge","z":"25e1fd8d.6907c2","name":"PowerAmp","group":"9f6e013a.cea21","order":2,"width":0,"height":0,"gtype":"gage","title":"PowerAmp","label":"A","format":"{{value}}","min":"-20","max":"0","colors":["#00b500","#e6e600","#ca3838"],"seg1":"-3.4","seg2":"-1.7","x":920,"y":320,"wires":[]},{"id":"f8931e06.546b7","type":"function","z":"25e1fd8d.6907c2","name":"New Variable","func":"// Creates new variable with value as message payload and category as\n// the device path variable from the topic splitter.\nvar newV;\nnewV = {\"value\":msg.payload, \"category\":flow.get(\"Devicepath\")};\n// Sets msg.topic as recently created ariable newV.\nflow.set(msg.topic, newV);\n// Accesses message topic variable.\nmsg.payload = flow.get(msg.topic);\nreturn msg;\n","outputs":1,"noerr":0,"x":410,"y":440,"wires":[["84d835ab.743db8"]]},{"id":"84d835ab.743db8","type":"debug","z":"25e1fd8d.6907c2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":520,"wires":[]},{"id":"f6e8db37.8e3888","type":"function","z":"44490660.8eedd8","name":"Power","func":"// Authored by Michael Thompson on 30/12/2020\nconst topicArray = [\"power/voltage\",\"power/amp\",\"power/mA\",\"power/loadvoltage\",\"power/loadpower\",\"power/loadpowermw\",\"power/loadamps\",\"power/loadmA\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\n// voltage is a mux pin reading 0-25VAC/DC using sensor board\nif (topic==\"power/voltage\") {\n    flow.set(\"power/voltage\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null];\n}\n// ACR is the amp mamp topics\nif (topic==\"power/amp\") {\n    flow.set(\"power/amp\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"power/mA\") {\n    flow.set(\"power/mA\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null];\n}\n// INA219 is the loadxxx topics\nif (topic==\"power/loadvoltage\") {\n    flow.set(\"power/loadvoltage\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null];\n}\nif (topic==\"power/loadpower\") {\n    flow.set(\"power/loadpower\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"power/loadpowermw\") {\n    flow.set(\"power/loadpowermw\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"power/loadamps\") {\n    flow.set(\"power/loadamps\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"power/loadmA\") {\n    flow.set(\"power/loadmA\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg];\n} \n*/\n","outputs":8,"noerr":0,"x":270,"y":3980,"wires":[[],[],[],[],[],[],[],[]]},{"id":"fccf8dbd.c9404","type":"inject","z":"44490660.8eedd8","name":"Inject every second","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"0.1","x":660,"y":100,"wires":[["e974240a.1e5538"]]},{"id":"741e1cfc.fe8094","type":"function","z":"44490660.8eedd8","name":"Water","func":"// Authored by Michael Thompson on 30/12/2020\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\nconst nullArray = new Array(topicArray.length).fill(null);\n\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n\n\n\n\n/*\n// Martin Hannah Code\nif (topic==\"waterquality/ph\") {\n    flow.set(\"waterquality/ph\",parseFloat(msg.payload));\n    return [msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/phrating\") {\n    flow.set(\"waterquality/phrating\",parseFloat(msg.payload));\n    return [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\n    flow.set(\"waterquality/turbidity\",parseFloat(msg.payload));\n    return [null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidityvolts\") {\n    flow.set(\"waterquality/turbidityvolts\",parseFloat(msg.payload));\n    return [null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/tankwaterinlet\") {\n    flow.set(\"waterflow/tankwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp00/temperature\") {\n    flow.set(\"watertemp00/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterflow/gardenwaterinlet\") {\n    flow.set(\"waterflow/gardenwaterinlet\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"watertemp01/temperature\") {\n    flow.set(\"watertemp01/temperature\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/level\") {\n    flow.set(\"waterlevel/fishtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/level\") {\n    flow.set(\"waterlevel/2ndtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/level\") {\n    flow.set(\"waterlevel/3rdtank/level\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/percentagefull\") {\n    flow.set(\"waterlevel/fishtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/percentagefull\") {\n    flow.set(\"waterlevel/2ndtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/percentagefull\") {\n    flow.set(\"waterlevel/3rdtank/percentagefull\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/fishtank/volume\") {\n    flow.set(\"waterlevel/fishtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/2ndtank/volume\") {\n    flow.set(\"waterlevel/2ndtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterlevel/3rdtank/volume\") {\n    flow.set(\"waterlevel/3rdtank/volume\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null,null];\n}\n\n// Add additional Tank temperature sensors (Potentually up to 12 Dallas Temperature sensors)\nif (topic==\"temperature00/degrees\") {\n    flow.set(\"temperature00/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\n    flow.set(\"temperature01/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature02/degrees\") {\n    flow.set(\"temperature02/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\n    flow.set(\"temperature03/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"temperature04/degrees\") {\n    flow.set(\"temperature04/degrees\",parseFloat(msg.payload));\n    return [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":22,"noerr":0,"x":270,"y":4220,"wires":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"db1d30b.b25a9d","type":"comment","z":"44490660.8eedd8","name":"Get Sensor Data","info":"","x":100,"y":40,"wires":[]},{"id":"2ee788af.620f88","type":"comment","z":"44490660.8eedd8","name":"Interpret Sensor Data","info":"https://run.mocky.io/v3/b4b2d93d-896c-4d37-b019-5228a61e2338\n\n\nhttps://run.mocky.io/v3/a70af699-0e98-4fe0-9142-7e4c0618f3fb\n\n\nhttps://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","x":340,"y":40,"wires":[]},{"id":"eb4d0790.4b4e18","type":"comment","z":"44490660.8eedd8","name":"Send to InfluxDB 2.0","info":"","x":650,"y":40,"wires":[]},{"id":"78764f7c.40cf","type":"function","z":"44490660.8eedd8","name":"Rain/Soil","func":"var topic=msg.topic;\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/0\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/1\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/2\") {\nreturn [null,null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/moisture/3\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/0\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/1\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/2\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/rainfall/residualmoisture/3\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/0\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"cyper/ESP12S006/soilcondition/temperature/1\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"soilcondition/temperature/2\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"soilcondition/temperature/3\") {\nreturn [null,null,null,null,null,null,null,null,null,null,null,msg];\n}","outputs":12,"noerr":0,"x":280,"y":4480,"wires":[[],[],[],[],[],[],[],[],[],[],[],[]]},{"id":"4df6fdbe.4e02a4","type":"function","z":"44490660.8eedd8","name":"Environ","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null,null,null,null,null,null,null,null];\nconst topicArray = \n[\"sound/loadness\",\n\"environment/temperature\",\n\"environment/avetemperature\",\n\"environment/humidity\",\n\"environment/abshumidity\",\n\"environment/heatindex\",\n\"environment/pressure\",\n\"environment/altitude\",\n\"uvindex/uvindex\",\n\"uvindex/uvrating\",\n\"proximity/movement\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null,null,null,null,null,null,null,null]\nreturn nullArray;\n\n/*\n// Martin Hannah Code\nvar topic=msg.topic;\nif (topic==\"sound/loadness\") {\nreturn [msg,null,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/temperature\") {\nreturn [null,msg,null,null,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/avetemperature\") {\nreturn [null,null,msg,null,null,null],null,null,null,null,null;\n}\nif (topic==\"environment/humidity\") {\nreturn [null,null,null,msg,null,null,null,null,null,null,null];\n}\nif (topic==\"environment/abshumidity\") {\nreturn [null,null,null,null,msg,null,null,null,null,null,null];\n}\nif (topic==\"environment/heatindex\") {\nreturn [null,null,null,null,null,msg,null,null,null,null,null];\n}\nif (topic==\"environment/pressure\") {\nreturn [null,null,null,null,null,null,msg,null,null,null,null];\n}\nif (topic==\"environment/altitude\") {\nreturn [null,null,null,null,null,null,null,msg,null,null,null];\n}\nif (topic==\"uvindex/uvindex\") {\nreturn [null,null,null,null,null,null,null,null,msg,null,null];\n}\nif (topic==\"uvindex/uvrating\") {\nreturn [null,null,null,null,null,null,null,null,null,msg,null];\n}\nif (topic==\"proximity/movement\") {\nreturn [null,null,null,null,null,null,null,null,null,null,msg];\n} */","outputs":11,"noerr":0,"x":280,"y":4660,"wires":[[],[],[],[],[],[],[],[],[],[],["7a246c9f.cf64a4"]]},{"id":"7a246c9f.cf64a4","type":"function","z":"44490660.8eedd8","name":"Movement","func":"msg.color  = (msg.payload === \"true\")?\"orange\":\"white\";\nmsg.status = (msg.payload === \"true\")?\"\":\"idle\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":4760,"wires":[[]]},{"id":"188cca5f.a3f446","type":"function","z":"44490660.8eedd8","name":"Light","func":"// Authored by Michael Thompson on 30/12/2020\nconst nullArray = [null,null,null,null];\nconst topicArray = [\"light/ambientlight\",\"light/illuminance\",\"light/illuminance/01\",\"light/illuminance/02\"];\n// Get index of topic in array\nvar index = topicArray.findIndex(topic => topic === msg.topic);\n\n// If the topic is in the topicArray, assign it to the same index in nullArray and create\n// a flow variable\nif (index != -1) {\n    nullArray[index] = msg;\n    flow.set(msg.topic,parseFloat(msg.payload));\n}\n\n// eg [msg,null,null,null]\nreturn nullArray;\n\n\n/*\nvar topic=msg.topic;\nif (topic==\"light/ambientlight\") {\nreturn [msg,null,null,null];\n}\nif (topic==\"light/illuminance\") {\nreturn [null,msg,null,null];\n}\n// These two are spare slots filled with sample ..illuminence/01\nif (topic==\"light/illuminance/01\") {\nreturn [null,null,msg,null];\n}\nif (topic==\"light/illuminance/02\") {\nreturn [null,null,null,msg];\n} */","outputs":4,"noerr":0,"x":270,"y":4820,"wires":[[],[],[],[]]},{"id":"7dc3ee3f.592f6","type":"function","z":"44490660.8eedd8","name":"Misc","func":"// ASK ABOUT DUPLICATE TOPICS\n\n// Authored by Michael Thompson on 30/12/2020\nvar nullArray = [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];\nvar topicArray = [\"waterquality/ph\",\"waterquality/phrating\",\"waterquality/turbidity\",\"waterquality/turbidityvolts\",\"waterquality/turbidityvolts\",\"waterflow/tankwaterinlet\",\"watertemp00/temperature\",\"waterflow/gardenwaterinlet\",\"watertemp01/temperature\",\"waterlevel/fishtank/level\",\"waterlevel/2ndtank/level\",\"waterlevel/3rdtank/level\",\"waterlevel/fishtank/percentagefull\",\"waterlevel/2ndtank/percentagefull\",\"waterlevel/3rdtank/percentagefull\",\"waterlevel/fishtank/volume\",\"waterlevel/2ndtank/volume\",\"waterlevel/3rdtank/volume\",\"temperature00/degrees\",\"temperature01/degrees\",\"temperature03/degrees\",\"temperature03/degrees\",\"temperature04/degrees\"];\n/*\"waterquality/phrating\"\n\"waterquality/turbidity\"\n\"waterquality/voltage\"\n\"temperature00/degrees\"\n\"temperature01/degrees\"\n\"temperature03/degrees\"\n\"mcu/heartbeat\"*/\nif (msg.topic==\"mcu/execlog\") {\n    msg.topic   = \"ExecutionLog\";\n    msg.payload = \"zzStart\" + msg.payload + \"\\n\";\n    //msg.payload = msg.payload.replace(\",\",'\\n');\n    msg.payload = msg.payload.replace(\"zzStart,\",'');\n    msg.payload = msg.payload.replace(\"OLEDnextPanel\",'OLED');\n    msg.payload = msg.payload.replace(\"hourlyScheduler\",'HourlySched');\n    msg.payload = msg.payload.replace(\"primaryScheduler\",'PrimarySched');\n    msg.payload = msg.payload.replace(\"Task1Scheduler\",'Sched1');\n    msg.payload = msg.payload.replace(\"Task2Scheduler\",'Sched2');\n    msg.payload = msg.payload.replace(\"Task3Scheduler\",'Sched3');\n    msg.payload = msg.payload.replace(\"Task4Scheduler\",'Sched4');\n    msg.payload = msg.payload.replace(\"Task5Scheduler\",'Sched5');\n    msg.payload = msg.payload.replace(\"pollProximity\",'Proximity');\n    msg.payload = msg.payload.replace(\"setRelay\",'Relays');\n    msg.payload = msg.payload.replace(\"BME\",'BMP280');\n    msg.payload = msg.payload.replace(/read/g,'');\n    return [msg,null,null,null,null,null,null,null];\n}\n\nelse {\n    // Get index of topic in array\n    var index = topicArray.findIndex(topic => topic === msg.topic);\n    \n    // If the topic is in the topicArray, assign it to the same index in nullArray and create\n    // a flow variable\n    if (index != -1) {\n        nullArray[index] = msg;\n        flow.set(msg.topic,parseFloat(msg.payload));\n    }\n    \n    // eg [null,msg,null,null,null,null,null,null,null,null,null,null,null,null,null]\n    return nullArray;    \n    \n    \n}\n\n\n\n\n\n\nif (topic==\"waterquality/phrating\") {\nreturn [null,msg,null,null,null,null,null,null];\n}\nif (topic==\"waterquality/turbidity\") {\nreturn [null,null,msg,null,null,null,null,null];\n}\nif (topic==\"waterquality/voltage\") {\nreturn [null,null,null,msg,null,null,null,null];\n}\n\nif (topic==\"temperature00/degrees\") {\nreturn [null,null,null,null,msg,null,null,null];\n}\nif (topic==\"temperature01/degrees\") {\nreturn [null,null,null,null,null,msg,null,null];\n}\nif (topic==\"temperature03/degrees\") {\nreturn [null,null,null,null,null,null,msg,null];\n}\nif (topic==\"mcu/heartbeat\") {\nreturn [null,null,null,null,null,null,null,msg];\n}","outputs":8,"noerr":0,"x":270,"y":4920,"wires":[[],[],[],[],[],[],[],[]]},{"id":"4babd4bc.49ff8c","type":"ui_gauge","z":"44490660.8eedd8","name":"Voltage","group":"cd57739c.7b72b","order":1,"width":0,"height":0,"gtype":"gage","title":"Voltage","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"3.4","seg2":"3.8","x":820,"y":320,"wires":[]},{"id":"8eeb115e.3578c","type":"ui_chart","z":"44490660.8eedd8","name":"CurrentMa","group":"4e8a2667.8785f8","order":2,"width":0,"height":0,"label":"Current(mA)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":830,"y":360,"wires":[[]]},{"id":"fad7787f.34e6b8","type":"ui_chart","z":"44490660.8eedd8","name":"Power","group":"4e8a2667.8785f8","order":3,"width":0,"height":0,"label":"Power","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":810,"y":400,"wires":[[],[]]},{"id":"47b6d267.cd4bec","type":"ui_chart","z":"44490660.8eedd8","name":"Power(mW)","group":"4e8a2667.8785f8","order":4,"width":0,"height":0,"label":"Power(mW)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":830,"y":440,"wires":[[],[]]},{"id":"ddd65ec1.917e9","type":"function","z":"44490660.8eedd8","name":"Output","func":"\nreturn msg;","outputs":8,"noerr":0,"x":610,"y":380,"wires":[["4babd4bc.49ff8c"],["8eeb115e.3578c"],["fad7787f.34e6b8"],["47b6d267.cd4bec"],[],[],[],[]]},{"id":"5b3c940.a05d66c","type":"comment","z":"44490660.8eedd8","name":"Node-Red Dashboard","info":"","x":660,"y":280,"wires":[]},{"id":"757c135a.be550c","type":"function","z":"44490660.8eedd8","name":"Set topicArrays","func":"// Authored by Michael Thompson on 4/1/21\n\nvar topics = msg.payload['topics'];\nvar topicArray = [];\n\nfor (var key in topics) {\n    topicArray.push(topics[key]);\n}\n\n// Instead of this, each array will contain a list of sensors associated with a \"group\" \n// and a MQTT device\nflow.set(\"topicArray\",topicArray);\n\nflow.set(\"powerArray\",topics['power']);\nflow.set(\"waterArray\",topics['water']);\n\n\nreturn msg;\n\n/*\nconst topicArray = [\n    // POWER\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\",\n    // WATER\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"]; \n\nconst powerArray = [\n    \"power/voltage\",\n    \"power/amp\",\n    \"power/mA\",\n    \"power/loadvoltage\",\n    \"power/loadpower\",\n    \"power/loadpowermw\",\n    \"power/loadamps\",\n    \"power/loadmA\"];\n    \nconst waterArray = [\n    \"waterquality/ph\",\n    \"waterquality/phrating\",\n    \"waterquality/turbidity\",\n    \"waterquality/turbidityvolts\",\n    \"waterquality/turbidityvolts\",\n    \"waterflow/tankwaterinlet\",\n    \"watertemp00/temperature\",\n    \"waterflow/gardenwaterinlet\",\n    \"watertemp01/temperature\",\n    \"waterlevel/fishtank/level\",\n    \"waterlevel/2ndtank/level\",\n    \"waterlevel/3rdtank/level\",\n    \"waterlevel/fishtank/percentagefull\",\n    \"waterlevel/2ndtank/percentagefull\",\n    \"waterlevel/3rdtank/percentagefull\",\n    \"waterlevel/fishtank/volume\",\n    \"waterlevel/2ndtank/volume\",\n    \"waterlevel/3rdtank/volume\",\n    \"temperature00/degrees\",\n    \"temperature01/degrees\",\n    \"temperature03/degrees\",\n    \"temperature03/degrees\",\n    \"temperature04/degrees\"];\n\nconst miscArray = [];\n\n\n\nflow.set(\"powerArray\",powerArray);\nflow.set(\"waterArray\",waterArray);\nflow.set(\"miscArray\",miscArray); */","outputs":1,"noerr":0,"x":520,"y":3800,"wires":[[]]},{"id":"a95907b3.847248","type":"http request","z":"44490660.8eedd8","name":"GET topicArrays","method":"GET","ret":"obj","paytoqs":false,"url":"https://run.mocky.io/v3/3bb9ba80-d57a-4200-a80b-72d37021e190","tls":"","proxy":"","authType":"","x":280,"y":3800,"wires":[["757c135a.be550c"]]},{"id":"ec4d9046.c3782","type":"function","z":"44490660.8eedd8","name":"Send New Group Data","func":"// Authored by Michael Thompson on 29/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\nvar group = msg.payload;//flow.get(\"groups\")[msg.index];\n\nmsg.payload = [];\n\n// Array of Sensor Values\nvalueArr = flow.get(group+\"Array\");\n\ndata = \"\";\n\n// InfluxDB measurement set to group name as defined by loop over groups array\nmsg.measurement = group;\n\n// For each sensor value, if the value is not set to \"undefined\" and contains new data, it is updated\n// in the JSON object\nvar value;\nvar send = false;\nfor (value of valueArr) \n    if (flow.get(group+value) !== undefined && !(isNaN(flow.get(group+value)[\"value\"])) && flow.get(group+value)[\"new\"] === true) {\n        // NOTE doesnt currently sent timestamp\n        // Lachlan: Configure host to contain details for device, \n        // OR find a way to omit host and still possess relevant information on Grafana dashboard.\n        data += \"\\n\"+group+\",host=host1 \"+value+\"=\"+flow.get(group+value)[\"value\"];\n        flow.set(group+value,{\"value\":flow.get(group+value)[\"value\"],\"new\":false});\n        //send = true;\n    }\n// String of most up-to-date sensor values seperated by new lines returned\nmsg.payload = data;\n/*\nif (send === true) {\n    msg.payload = data;\n    return msg;\n} */\n\n\n\n\n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":660,"y":220,"wires":[["57276377.c31ccc","e974240a.1e5538","690e8e46.9d5fb"]]},{"id":"57276377.c31ccc","type":"debug","z":"44490660.8eedd8","name":"Debug InfluxDB","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":900,"y":220,"wires":[]},{"id":"a6a671e3.2695c","type":"comment","z":"44490660.8eedd8","name":"OLD API implementation","info":"","x":310,"y":3700,"wires":[]},{"id":"4ad1c777.568848","type":"comment","z":"44490660.8eedd8","name":"Add more devices here as necessary","info":"","x":160,"y":340,"wires":[]},{"id":"e974240a.1e5538","type":"array-loop","z":"44490660.8eedd8","name":"Loop over Groups","key":"index","keyType":"msg","reset":true,"resetValue":"value-null","array":"groups","arrayType":"flow","x":650,"y":160,"wires":[[],["ec4d9046.c3782"]]},{"id":"7cc5ece8.facf74","type":"inject","z":"cd6480e9.36b42","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":200,"wires":[["9be625a9.8858a8"]]},{"id":"9be625a9.8858a8","type":"function","z":"cd6480e9.36b42","name":"Fields and Tags","func":"msg.payload = [{\n    intValue: '10i',\n    numValue: 12,\n    randomValue: Math.random()*10,\n    strValue: \"message2\"\n},\n{\n    tag1:\"sensor1\",\n    tag2:\"device2\"\n}];\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":200,"wires":[["e67cd602.d85d08"]]},{"id":"e67cd602.d85d08","type":"influxdb out","z":"cd6480e9.36b42","influxdb":"9e2bcdf4.5d27c","name":"","measurement":"test","precision":"ms","retentionPolicy":"","database":"test","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"my-org","bucket":"test","x":550,"y":200,"wires":[]},{"id":"e819105c.a641","type":"http request","z":"44490660.8eedd8","name":"","method":"use","ret":"txt","paytoqs":true,"url":"","tls":"","proxy":"","authType":"","x":910,"y":160,"wires":[["eb757acd.5b9a98"]]},{"id":"eb757acd.5b9a98","type":"debug","z":"44490660.8eedd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":160,"wires":[]},{"id":"690e8e46.9d5fb","type":"function","z":"44490660.8eedd8","name":"API Setup","func":"\ntoken = \"tG5EUmZxMguPu2yEpfaMTcICCQhdjgyIQKZBOe8JU6AF-C08BsFoDJvprRmerz2X6jD6iPzGISJLdmCdIOwHFQ==\"; \naddress = \"http://10.0.0.211:19086/api/v2/write\";\norganisation = \"cypernex\";\nbucket = \"cyperbucket\";\nprecision = \"s\";\n\nmsg.headers = {};\nmsg.method = \"POST\";\nmsg.url = address+\"?org=\"+organisation+\"&bucket=\"+bucket+\"&precision=\"+precision;\nmsg.headers = {\"Authorization\" : \"Token \" + token}\n\n//msg.payload = \"cyper/ESP12S008/,host=host1 mcu/taskschedule05/period=60\";\n//msg.payload = \"testhead,host=host1 meat_percent=64.43234543 1556896326\";\n\nif (msg.payload != [])\n    return msg;\n\nreturn;","outputs":1,"noerr":0,"x":900,"y":100,"wires":[["e819105c.a641"]]},{"id":"caa590bb.97b54","type":"debug","z":"4436fe60.38ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":970,"y":320,"wires":[]},{"id":"a469624f.415e6","type":"http request","z":"4436fe60.38ba","name":"","method":"use","ret":"txt","paytoqs":true,"url":"","tls":"","proxy":"","authType":"","x":931,"y":260,"wires":[["caa590bb.97b54"]]},{"id":"8dcf49c6.7949a8","type":"function","z":"4436fe60.38ba","name":"","func":"\ntoken = \"9JU8UymVL1iZVv2RSclumX8nqk8J85xurNL4_SFzJ00DaNfHItwOlZNyquV4J9yTuUKM-zpDeUAdfsmAulD5oA==\"; \n\nmsg.headers = {};\nmsg.method = \"POST\";\nmsg.url = \"http://10.0.0.211:19086/api/v2/write?org=cypernet&bucket=cyperbucket&precision=s\";\nmsg.headers = {\"Authorization\" : \"Token \" + token}\n\n\nmsg.payload = \"testhead,host=host1 meat_percent=64.43234543 1556896326\";\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":750,"y":280,"wires":[["a469624f.415e6"]]},{"id":"d5d6e7f9.0bda18","type":"inject","z":"4436fe60.38ba","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":790,"y":140,"wires":[["8dcf49c6.7949a8"]]},{"id":"d4c4404c.8e6c3","type":"function","z":"44490660.8eedd8","name":"Split Topic","func":"// Authored by Martin Hannah\n\n// split the topic into two parts\nvar parts = msg.topic.split('/');\nvar topic = '';\nvar base = '';\nvar n    = 0;\nfor (var i of parts) {\n    if (n > 1) {\n        topic = topic + i ;\n        if (i !== parts.length[i] ) {\n            topic = topic + '/';\n        }\n    }\n    n++;\n}\nbase = parts[0] + '/' + parts[1] + '/' ;\n\nflow.set('Devicepath', base);\nmsg.topic = topic.substring(0,topic.length - 1);\nmsg.base  = base;\n//msg.parts  = parts;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":100,"wires":[["6ba2e41e.70429c"]]},{"id":"6ba2e41e.70429c","type":"function","z":"44490660.8eedd8","name":"Update Topic Flow Variable ","func":"// Authored by Michael Thompson on 30/12/2020\n// Last updated by Michael Thompson on 5/1/2021\n\n// Updates flow array containing all topics\n// May or may not be necessary // \nconst topicArray = flow.get(\"topicArray\") || [];\nif ((topicArray.includes(msg.topic))===false)\n    topicArray.push(msg.topic);\nflow.set(\"topicArray\", topicArray);\n\n\nvar group = flow.get('Devicepath');\n\n// Updates flow containing for groups\nconst groups = flow.get(\"groups\") || [];\nif (!(groups.includes(group)))\n    groups.push(group);\nflow.set(\"groups\", groups);\n\n// Updates flow containing for topics within current group\nconst groupArray = flow.get(group+\"Array\") || [];\nif (!(groupArray.includes(msg.topic)) && !msg.topic.includes(\"$\"))\n    groupArray.push(msg.topic);\nflow.set(group+\"Array\",groupArray);\n\n// Updates flow variable for current group and topic\nflow.set(group+msg.topic,\n        // WILL NEED TO PARSE OTHER DATATYPES\n        // PARSING FLOAT BECAUSE FIRMWARE SENDS ALL DATA AS STRINGS\n        // WHICH CAUSES ERRORS WITH INFLUXDB TYPES\n        {\"value\":parseFloat(msg.payload),\n        // Bool for if data is new\n         \"new\":true\n        });\n\n","outputs":1,"noerr":0,"x":360,"y":160,"wires":[[]]},{"id":"9ac843eb.cc2ff","type":"mqtt in","z":"44490660.8eedd8","name":"ESP","topic":"cyper/#","qos":"2","datatype":"auto","broker":"9a25da91.8b5fe8","x":70,"y":100,"wires":[["d4c4404c.8e6c3","e202f9e8.618c58"]]},{"id":"e202f9e8.618c58","type":"debug","z":"44490660.8eedd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":140,"y":260,"wires":[]},{"id":"7a089de5.01b0e4","type":"comment","z":"44490660.8eedd8","name":"Diagnostic: Check for Invalid Code","info":"","x":1340,"y":180,"wires":[]},{"id":"5099ccbe.d716cc","type":"comment","z":"44490660.8eedd8","name":"Diagnostic: Check for Invalid Code","info":"","x":1340,"y":220,"wires":[]},{"id":"cad5dcc8.8aa168","type":"comment","z":"44490660.8eedd8","name":"Lachlan Suggestions","info":"","x":1300,"y":140,"wires":[]}]